"use strict";(this.webpackChunkexcalidraw_app=this.webpackChunkexcalidraw_app||[]).push([[530],{7125:function(e,t,n){n.r(t),n.d(t,{appState:function(){return oe},default:function(){return re}});var o=n(3433),r=n(1413),a=n(9439),i=n(4519),l=n(5204),c=n(4975),s=n(4925),u=["type","x","y","strokeColor","backgroundColor","fillStyle","strokeWidth","strokeStyle","width","height","angle","points"],d=function(e){var t=e.type,n=e.x,o=e.y,a=e.strokeColor,i=e.backgroundColor,c=e.fillStyle,d=e.strokeWidth,f=void 0===d?3:d,v=e.strokeStyle,h=e.width,m=void 0===h?0:h,g=e.height,p=void 0===g?0:g,x=e.angle,y=void 0===x?0:x,w=e.points,k=void 0===w?[]:w,S=(0,s.Z)(e,u);return(0,r.Z)({id:(0,l.kb)(),type:t,x:n,y:o,width:m,height:p,strokeColor:a,backgroundColor:i,fillStyle:c,strokeWidth:f,strokeStyle:v,angle:y,isDeleted:!1,points:k},S)},f=function(e){var t=e.elementType,n=e.pointerDownState,o=e.appState;return d("freedraw"===t?{type:t,x:n.origin.x,y:n.origin.y,points:[[n.origin.x,n.origin.y]],strokeColor:o.currentItemStrokeColor,backgroundColor:o.currentItemBackgroundColor,fillStyle:o.currentItemFillStyle,strokeWidth:o.currentItemStrokeWidth,strokeStyle:(0,l.B8)()}:{type:t,x:n.origin.x,y:n.origin.y,strokeColor:o.currentItemStrokeColor,backgroundColor:o.currentItemBackgroundColor,fillStyle:o.currentItemFillStyle,strokeWidth:o.currentItemStrokeWidth,strokeStyle:(0,l.B8)()})},v=function(e){return d((0,r.Z)({type:"text",text:e.text,fontSize:e.fontSize,fontFamily:e.fontFamily,textAlign:e.textAlign,verticalAlign:e.verticalAlign,originalText:e.text},e))},h=function(e,t){return Number((Math.random()*(t-e)+e).toFixed(5))},m=function(e,t,n){for(var o,r=[],a=0;a<e;a++){var i=h(-n.scrollX,n.canvasWidth-n.scrollX),c=h(-n.scrollY,n.canvasHeight-n.scrollY);if(o=f({elementType:t,pointerDownState:{origin:{x:i,y:c}},appState:n}),"rectangle"===t){var s=Math.abs(h(-n.scrollX-i,n.canvasWidth-n.scrollX-i))+2,u=Math.abs(h(-n.scrollY-c,n.canvasHeight-n.scrollY-c))+2;o.width=s,o.height=u}else if("freedraw"===t)for(var d=h(20,100),m=0;m<d;m++)i=h(i,i+10),c=h(c,c+10),o.points.push([i,c]);else if("text"===t){var g="".concat(i,", ").concat(c);o=v({x:i,y:c,strokeColor:(0,l.B8)(),backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid",text:g,width:20*g.length,height:25,fontSize:20,fontFamily:"Virgil",textAlign:"left",verticalAlign:"top"})}r.push(o)}return r},g=new WeakMap,p=function(e){g.delete(e)},x=function(e,t){var n=g.get(e);if(n&&!t.notUseCache)return n;var o=k(e,t.zoom,t);return t.notUseCache||g.set(e,o),o},y="object"===typeof document,w=y&&document.getElementById("placeholder"),k=function(e,t,n){var o=y?window.devicePixelRatio:n.devicePixelRatio,r=document.createElement("canvas"),i=r.getContext("2d"),c=C(e);!w&&y&&(w=document.getElementById("placeholder")),r;if("freedraw"===e.type){var s,u,d=(0,l.qf)(e),f=(0,a.Z)(d,4),v=f[0],h=f[1],m=f[2],g=f[3];r.width=(0,l.TE)(v,m)*o*t.value+c*t.value*2,r.height=(0,l.TE)(h,g)*o*t.value+c*t.value*2,s=e.x>v?(0,l.TE)(e.x,v)*o*t.value:0,u=e.y>h?(0,l.TE)(e.y,h)*t.value*o:0,i.translate(s,u)}else r.width=e.width*o*t.value+c*t.value*2,r.height=e.height*o*t.value+c*t.value*2;return i.save(),i.translate(c*t.value,c*t.value),i.scale(o*t.value,o*t.value),S(e,i,n),i.restore(),{element:e,canvas:r,theme:n.theme,canvasZoom:t,canvasOffsetX:0,canvasOffsetY:0}},S=function(e,t,n){switch(t.globalAlpha=e.opacity/100,e.type){case"rectangle":t.lineJoin="round",t.lineCap="round",t.lineWidth=e.strokeWidth,t.strokeStyle=n.strokeStyle||e.strokeStyle,t.strokeRect(0,0,e.width,e.height);break;case"text":t.font=(0,l.mO)(e),t.fillStyle=n.fillStyle||e.strokeColor,t.textAlign=e.textAlign;var o=e.text.split("\n"),r=o.length?e.height/o.length:18;t.textBaseline="bottom";for(var i=0;i<o.length;i++)t.fillText(o[i],0,(i+1)*r);break;case"freedraw":t.save(),t.lineWidth=e.strokeWidth,t.strokeStyle=n.strokeStyle||e.strokeStyle,e.points.forEach((function(n,o){var r=(0,a.Z)(n,2),i=r[0],l=r[1];i-=e.x,l-=e.y,o?t.lineTo(i,l):t.moveTo(i,l)})),t.stroke(),t.restore()}t.globalAlpha=1},C=function(e){return"freedraw"===e.type?12*e.strokeWidth:20},E=function(e,t,n){var o=y?window.devicePixelRatio:n.devicePixelRatio,r=e.element,i=C(r),c=(0,l.qf)(r),s=(0,a.Z)(c,4),u=s[0],d=s[1],f=s[2],v=s[3];if("freedraw"===r.type){var h=(0,l.qf)(r),m=(0,a.Z)(h,4);u=m[0],d=m[1],f=m[2],v=m[3]}var g=((u+f)/2+n.scrollX)*o,p=((d+v)/2+n.scrollY)*o;t.save(),t.scale(1/o,1/o),t.translate(g,p),t.drawImage(e.canvas,-(f-u)/2*o-i*e.canvasZoom.value/e.canvasZoom.value,-(v-d)/2*o-i*e.canvasZoom.value/e.canvasZoom.value,e.canvas.width/e.canvasZoom.value,e.canvas.height/e.canvasZoom.value),t.restore()},j=function(e){var t=e.elements,n=e.appState,o=e.scale,r=e.canvas,i=e.renderConfig,c=r.getContext("2d");c.save(),c.scale(o,o);var s=r.width/o,u=r.height/o;if(c.clearRect(0,0,s,u),c.save(),c.scale(i.zoom.value,i.zoom.value),i.isExport&&t||function(e,t){var n=t.scrollX,o=t.scrollY,r=t.zoom;e.save();var a=100,i=100,l=e.canvas;e.strokeStyle="red",e.fillStyle="red",e.beginPath(),e.lineWidth=2,e.textBaseline="middle",e.save(),e.translate(0,o);for(var c=0;c<o/a;c++)e.moveTo(0,-c*a),e.lineTo(8,-c*a),e.font="10px Arial",e.fillText(-c,0,-c*a+10);for(var s=1;s<(l.height-o*r.value)/(a*r.value);s++)e.moveTo(0,s*a),e.lineTo(8,s*a),e.font="10px Arial",e.fillText(s,0,s*a+10);e.restore(),e.save(),e.translate(n,0);for(var u=0;u<n/i;u++)e.moveTo(-u*i,0),e.lineTo(-u*i,8),e.font="10px Arial",e.fillText(-u,-u*i+5,5);for(var d=1;d<(l.width-n*r.value)/(i*r.value);d++)e.moveTo(d*i,0),e.lineTo(d*i,8),e.font="10px Arial",e.fillText(d,d*i+5,5);e.restore(),e.stroke(),e.restore()}(c,i),t){var d=t.filter((function(e){return function(e,t,n,o){var r=(0,l.Pi)(e),i=(0,a.Z)(r,4),c=i[0],s=i[1],u=i[2],d=i[3],f=(0,l.dE)({clientX:o.offsetLeft,clientY:o.offsetTop},o),v=(0,l.dE)({clientX:o.offsetLeft+t,clientY:o.offsetTop+n},o);return f.x<=u&&f.y<=d&&v.x>=c&&v.y>=s}(e,s,u,{zoom:i.zoom,offsetLeft:n.offsetLeft,offsetTop:n.offsetTop,scrollX:i.scrollX,scrollY:i.scrollY})}));document.getElementById("canvas-total").innerText="\u603b\u5143\u7d20\u6570\uff1a".concat(t.length,"   \u5b9e\u9645\u7ed8\u5236\u5143\u7d20\u603b\u6570\uff1a").concat(d.length),d.forEach((function(e){!function(e,t,n,o){var r=x(e,n);E(r,t,n)}(e,c,i)}))}c.restore(),c.restore(),t&&localStorage.setItem("elements",JSON.stringify(t)),localStorage.setItem("appState",JSON.stringify(n))},T=n(2121);var Z=new function(){return new Worker(n.p+"static/js/file.worker.e450a597.worker.js")},b=[];Z.onmessage=function(e){b.forEach((function(t){return t(e.data)}))};var M={tools:"index_tools__F11CL",item:"index_item__qZvQR",selected:"index_selected__e5hcZ"},R=n(2556),z=["width","height","mirror","style"],_=function(e,t){var n="number"===typeof t?{width:t}:t,o=n.width,a=void 0===o?512:o,i=n.height,l=void 0===i?a:i,c=(n.mirror,n.style),u=(0,s.Z)(n,z);return(0,R.jsx)("svg",(0,r.Z)((0,r.Z)({"aria-hidden":"true",focusable:"false",role:"img",viewBox:"0 0 ".concat(a," ").concat(l),style:c},u),{},{children:"string"===typeof e?(0,R.jsx)("path",{fill:"currentColor",d:e}):e}))},X=_((0,R.jsxs)("g",{strokeWidth:"1.5",children:[(0,R.jsx)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),(0,R.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"})]}),{width:24,height:24,fill:"none",strokeWidth:2,stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),Y=_((0,R.jsxs)("g",{strokeWidth:"1.25",children:[(0,R.jsx)("path",{clipRule:"evenodd",d:"m7.643 15.69 7.774-7.773a2.357 2.357 0 1 0-3.334-3.334L4.31 12.357a3.333 3.333 0 0 0-.977 2.357v1.953h1.953c.884 0 1.732-.352 2.357-.977Z"}),(0,R.jsx)("path",{d:"m11.25 5.417 3.333 3.333"})]}),{width:20,height:20,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),L=_((0,R.jsxs)("g",{strokeWidth:"1.25",children:[(0,R.jsx)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),(0,R.jsx)("path",{d:"M15 8h.01"}),(0,R.jsx)("path",{d:"M12 20h-5a3 3 0 0 1 -3 -3v-10a3 3 0 0 1 3 -3h10a3 3 0 0 1 3 3v5"}),(0,R.jsx)("path",{d:"M4 15l4 -4c.928 -.893 2.072 -.893 3 0l4 4"}),(0,R.jsx)("path",{d:"M14 14l1 -1c.617 -.593 1.328 -.793 2.009 -.598"}),(0,R.jsx)("path",{d:"M19 16v6"}),(0,R.jsx)("path",{d:"M22 19l-3 3l-3 -3"})]}),{width:24,height:24,fill:"none",strokeWidth:2,stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W={width:20,height:20,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"},I=_((0,R.jsx)("path",{strokeWidth:"1.25",d:"M10 4.167v11.666M4.167 10h11.666"}),W),A=_((0,R.jsx)("path",{d:"M5 10h10",strokeWidth:"1.25"}),W),P=n(5671),B=n(3144),N=function(){function e(){(0,P.Z)(this,e);var t=JSON.parse(localStorage.getItem("elements"));this.elements=t||[]}return(0,B.Z)(e,[{key:"getElementsIncludingDeleted",value:function(){return this.elements}},{key:"replaceAllElements",value:function(e){this.elements=e}}]),e}(),D=new N,F=[{type:"rectangle",icon:X},{type:"freedraw",icon:Y}],O=(0,i.memo)((function(e){var t=e.activeTool,n=e.onActiveToolChange;return(0,R.jsxs)("div",{className:M.tools,children:[(0,R.jsx)("span",{className:[M.item].join(" "),onClick:function(){(0,T.aF)({renderScene:j,elements:D.getElementsIncludingDeleted(),appState:oe})},children:L}),F.map((function(e){var o=t.type===e.type;return(0,R.jsx)("span",{className:[M.item,o&&M.selected].join(" "),onClick:function(){return n({type:o?"":e.type})},children:e.icon},e.type)}))]})})),U={scale:"index_scale__Xgs3R",item:"index_item__jlc7V",value:"index_value__9glOL"},H=(0,i.memo)((function(e){var t=e.appState,n=e.onZoomChange,o="".concat((100*t.zoom.value).toFixed(0),"%");return(0,R.jsxs)("div",{className:U.scale,children:[(0,R.jsx)("span",{className:[U.item].join(" "),onClick:function(){return n((0,c.j)(t.zoom.value-.1))},children:A}),(0,R.jsx)("span",{className:U.value,onClick:function(){return n((0,c.j)(1))},children:o}),(0,R.jsx)("span",{className:[U.item].join(" "),onClick:function(){return n((0,c.j)(t.zoom.value+.1))},children:I})]})})),q=H,K="index_layer__n2wKC",J="index_ball_red__487Jk",V="index_boundceBall__ulji4",$="index_shadowball__HLlgs",Q=(0,i.memo)((function(e){var t=e.activeTool,n=e.onActiveToolChange,o=e.appState,r=e.onZoomChange;return(0,R.jsxs)("div",{className:K,children:[(0,R.jsx)(q,{appState:o,onZoomChange:r}),(0,R.jsx)(O,{activeTool:t,onActiveToolChange:n}),(0,R.jsxs)("div",{className:V,children:[(0,R.jsx)("div",{className:J}),(0,R.jsx)("div",{className:$})]})]})})),G=Q,ee={textarea:"index_textarea__Z5y--",textarea_copy:"index_textarea_copy__PICl+"},te=(0,i.forwardRef)((function(e,t){var n=e.renderStaticCanvas,r=(0,i.useRef)(null),c=(0,i.useState)(""),s=(0,a.Z)(c,2),u=s[0],d=s[1];return(0,i.useImperativeHandle)(t,(function(){return{startEditText:function(e){e.preventDefault(),e.stopPropagation();var t=(0,l.dE)(e,oe),n=t.x,o=t.y,a=v({x:n,y:o,strokeColor:(0,l.B8)(),backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid",text:"",fontSize:20,fontFamily:"Virgil",textAlign:"left",verticalAlign:"top"});oe.draggingElement=a;var i=r.current;i.focus();var c=e.clientX-oe.offsetLeft,s=e.clientY-oe.offsetTop,u={font:(0,l.mO)(a),left:"".concat(c,"px"),top:"".concat(s,"px"),opacity:1,color:a.strokeColor,fontSize:a.fontSize};Object.assign(i.style,u);var d=document.getElementById("copyText");Object.assign(d.style,u);var f=oe.canvasWidth-c;Object.assign(i.style,{zIndex:1,maxWidth:"".concat(f,"px"),width:"".concat(a.fontSize,"px"),height:"".concat(1.2*a.fontSize,"px")})}}})),(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("textarea",{onChange:function(e){var t=e.target.value,n=r.current,o=parseFloat(n.style.maxWidth),a=document.getElementById("copyText");a.innerText=t;var i=a.getBoundingClientRect().width;if(i>o)if(i-o<30)console.log("\u6b63\u5e38\u7684\u8f93\u5165"),t=a.innerText=t.slice(0,t.length-1)+"\n"+t.slice(t.length-1);else{console.log("\u7c98\u8d34\u8fdb\u6765\u7684\u6587\u672c");var l=t.split("\n"),c=[];l.forEach((function(e){if(a.innerText=e,a.getBoundingClientRect().width<=o)c.push(e);else for(var t=0,n=1;n<e.length;n++){var r=e.slice(t,n);a.innerText=r,a.getBoundingClientRect().width>o?(c.push(e.slice(t,n-1)),t=n-1):n===e.length-1&&c.push(e.slice(t,n))}})),console.log("splitResult..",c),t=c.join("\n"),a.innerText=t}d(t);var s=a.getBoundingClientRect(),u=s.width,f=s.height;n.style.width="".concat(u+30,"px"),n.style.height="".concat(f,"px"),oe.draggingElement.text=t},onBlur:function(){var e=oe.draggingElement,t=r.current,a=document.getElementById("copyText");e.text&&(e.width=a.offsetWidth,e.height=a.offsetHeight,p(oe.draggingElement),D.replaceAllElements([].concat((0,o.Z)(D.getElementsIncludingDeleted()),[oe.draggingElement])),n(),setTimeout((function(){a.innerText="",d("")}),200)),Object.assign(t.style,{left:"0px",top:"0px",zIndex:-1,opacity:0})},value:u,className:ee.textarea,ref:r}),(0,R.jsx)("div",{style:{background:"grey"},id:"copyText",contentEditable:!0,className:[ee.textarea,ee.textarea_copy].join(" ")})]})})),ne=(0,i.memo)(te),oe=JSON.parse(localStorage.getItem("appState"))||{zoom:{value:1},scrollX:0,scrollY:0,offsetLeft:0,offsetTop:0,draggingElement:null,canvasWidth:0,canvasHeight:0},re=(0,i.memo)((function(){var e=(0,i.useRef)(null),t=(0,i.useRef)(null),n=(0,i.useRef)(null),s=(0,i.useRef)({}),u=(0,i.useRef)(null),d=(0,i.useRef)(null),v=(0,i.useRef)({}),x=(0,i.useState)(!1),y=(0,a.Z)(x,2),w=y[0],k=y[1],S=(0,i.useState)({type:""}),C=(0,a.Z)(S,2),E=C[0],M=C[1],z=(0,i.useState)({count:"",type:"rectangle"}),_=(0,a.Z)(z,2),X=_[0],Y=_[1],L=(0,i.useState)(!1),W=(0,a.Z)(L,2),I=W[0],A=W[1],P=(0,i.useRef)(),B=(0,i.useRef)(),N=(0,i.useRef)(),F=(0,i.useRef)({}),O=function(){k(!w)};(0,i.useEffect)((function(){var t=function(e){e.width=r*window.devicePixelRatio,e.height=a*window.devicePixelRatio},o=e.current,r=o.offsetWidth,a=o.offsetHeight;t(o),t(n.current);var i=o.getBoundingClientRect(),l=i.x,c=i.y;oe.offsetLeft=l,oe.offsetTop=c,oe.canvasWidth=r,oe.canvasHeight=a,H()}),[]),(0,i.useEffect)((function(){var n=t.current,o=function(e){e.preventDefault()};n.addEventListener("wheel",o,{passive:!1});var r=function(e){s.current={cursorX:e.clientX,cursorY:e.clientY}},a=function(e){e.preventDefault()},i=e.current;return i.addEventListener("touchstart",a),document.addEventListener("mousemove",r),function(){i.removeEventListener("touchstart",a),n.removeEventListener("wheel",o),document.removeEventListener("mousemove",r)}}),[]),(0,i.useEffect)((function(){var e=0,t=Date.now();!function n(){var o=Date.now();if(e++,o>1e3+t){var r=Math.round(1e3*e/(o-t));d.current.innerText="FPS\uff1a".concat(r),e=0,t=o}requestAnimationFrame(n)}()}),[]);var U=function(){j({appState:oe,scale:window.devicePixelRatio,canvas:n.current,renderConfig:{selectionColor:"#6965db",scrollX:oe.scrollX,scrollY:oe.scrollY,viewBackgroundColor:"#ffffff",zoom:oe.zoom}});var e=F.current,t=e.minX,o=e.minY,r=e.width,a=e.height;e.base64;Object.assign(N.current.style,{transform:"translate(".concat((t+oe.scrollX)*oe.zoom.value,"px, ").concat((o+oe.scrollY)*oe.zoom.value,"px)"),width:"".concat(r*oe.zoom.value,"px"),height:"".concat(a*oe.zoom.value,"px")})},H=function(){!function(e){var t=e.isExport,n=e.notUseCache,o=e.elements,r=e.appState,i=e.cb,l=(0,T.Sp)(o,0),c=(0,a.Z)(l,4),s=c[0],u=c[1],d=c[2],f=c[3];console.log("export...",s,u,d,f);var v=document.createElement("canvas");v.style.width="".concat(d,"px"),v.style.height="".concat(f,"px"),v.width=d*window.devicePixelRatio,v.height=f*window.devicePixelRatio;var h=v.transferControlToOffscreen();Z.postMessage({elements:o,canvasWorker:h,isExport:t,notUseCache:n,exportPadding:0,type:"render",minX:s,minY:u,width:d,height:f,devicePixelRatio:window.devicePixelRatio,appState:r},[h]),(b=[]).push((function e(t){b=b.filter((function(t){return t!==e})),console.log("\u63a5\u6536worker\u6d88\u606f\u3002\u3002",t);var n=document.createElement("canvas"),o=r.canvasWidth,a=r.canvasHeight;console.log("\u63a5\u6536worker...",o,a),n.style.width="".concat(o,"px"),n.style.height="".concat(a,"px"),n.width=o*window.devicePixelRatio,n.height=a*window.devicePixelRatio;var l=n.getContext("2d");l.scale(window.devicePixelRatio,window.devicePixelRatio),l.drawImage(t.imageBitmap,0,0),i(n,s,u,d,f)}))}({renderScene:j,isExport:!0,staticCanvas:n.current,notUseCache:!0,exportPadding:0,elements:D.getElementsIncludingDeleted(),appState:(0,r.Z)({},oe),cb:function(e,t,n,o,r){F.current.minX=t,F.current.minY=n,F.current.width=o,F.current.height=r,N.current.src=e.toDataURL(),U()}}),U()},q=function(){U(),v.current.zoomTimerId&&clearTimeout(v.current.zoomTimerId),v.current.zoomTimerId=setTimeout((function(){g=new WeakMap,H()}),300)},K=function(t){return(0,l.$9)((function(n){var o=(0,l.dE)(n,oe);if(t.lastCoords.x=o.x,t.lastCoords.y=o.y,"freedraw"===E.type)oe.draggingElement.points.push([o.x,o.y]);else{var r=t.lastCoords,a=t.origin.x,i=t.origin.y,c=r.x,s=r.y,u=(0,l.TE)(t.origin.x,r.x),d=(0,l.TE)(t.origin.y,r.y),f=c<a?a-u:a,v=s<i?i-d:i;oe.draggingElement.x=f,oe.draggingElement.y=v,oe.draggingElement.width=u,oe.draggingElement.height=d}p(oe.draggingElement),j({elements:[oe.draggingElement],appState:oe,scale:window.devicePixelRatio,canvas:e.current,renderConfig:{selectionColor:"#6965db",scrollX:oe.scrollX,scrollY:oe.scrollY,viewBackgroundColor:"#ffffff",zoom:oe.zoom}})}))},J=function(t){return function(n){D.replaceAllElements([].concat((0,o.Z)(D.getElementsIncludingDeleted()),[oe.draggingElement])),console.log("pointer up appState...",oe);var r=e.current;r.getContext("2d").clearRect(0,0,r.width,r.height),H(),window.removeEventListener("pointermove",t.eventListeners.onMove),window.removeEventListener("pointerup",t.eventListeners.onUp)}},V=function(e){var t=(0,l.dE)(e,oe);return{origin:t,lastCoords:(0,r.Z)({},t),eventListeners:{onMove:null,onUp:null,onKeyUp:null,onKeyDown:null}}};return(0,R.jsxs)("div",{className:"performance-transform",ref:t,children:[(0,R.jsxs)("div",{ref:B,className:"container wrap",children:[(0,R.jsx)("img",{ref:N,className:"img",src:"",alt:""}),(0,R.jsx)("canvas",{ref:n,className:"canvas",children:"\u9759\u6001canvas"}),(0,R.jsx)("canvas",{ref:e,className:"canvas draw",onWheel:function(e){var t=e.deltaX,n=e.deltaY;if(e.metaKey||e.ctrlKey){var o=Math.sign(n),a=Math.abs(n),i=n;a>10&&(i=10*o);var l=oe.zoom.value-i/100;l+=Math.log10(Math.max(1,oe.zoom.value))*-o*Math.min(1,a/20);var u=(0,c.j)(l);return Object.assign(oe,(0,r.Z)({},(0,c.E)({viewportX:s.current.cursorX,viewportY:s.current.cursorY,nextZoom:u},oe))),O(),void q()}oe.scrollX=oe.scrollX-t,oe.scrollY=oe.scrollY-n,U()},onPointerDown:function(e){if(E.type){var t=V(e),n=f({elementType:E.type,pointerDownState:t,appState:oe});oe.draggingElement=n,p(n);var o=K(t),r=J(t);window.addEventListener("pointermove",o),window.addEventListener("pointerup",r),t.eventListeners.onMove=o,t.eventListeners.onUp=r}},onDoubleClick:function(e){E.type||u.current.startEditText(e)},children:"\u52a8\u6001canvas"}),(0,R.jsx)(G,{activeTool:E,onZoomChange:function(e){oe.zoom.value!==e&&(Object.assign(oe,(0,r.Z)({},(0,c.E)({viewportX:oe.canvasWidth/2+oe.offsetLeft,viewportY:oe.canvasHeight/2+oe.offsetTop,nextZoom:e},oe))),O(),q())},appState:(0,r.Z)({},oe),onActiveToolChange:function(e){M(e)}}),(0,R.jsx)(ne,{ref:u,renderStaticCanvas:H})]}),(0,R.jsxs)("div",{children:[(0,R.jsx)("span",{ref:d,children:"FPS\uff1a--"}),(0,R.jsx)("span",{className:"total",id:"canvas-total"})]}),(0,R.jsxs)("div",{className:"row",children:[(0,R.jsx)("input",{type:"number",value:X.count,onChange:function(e){return Y((0,r.Z)((0,r.Z)({},X),{},{count:e.target.value}))}}),(0,R.jsxs)("select",{value:X.type,onChange:function(e){return Y((0,r.Z)((0,r.Z)({},X),{},{type:e.target.value}))},children:[(0,R.jsx)("option",{value:"freedraw",children:"freedraw"}),(0,R.jsx)("option",{value:"rectangle",children:"rectangle"}),(0,R.jsx)("option",{value:"text",children:"text"})]}),(0,R.jsx)("button",{onClick:function(){var e=m(Number(X.count),X.type,oe);D.replaceAllElements([].concat((0,o.Z)(D.getElementsIncludingDeleted()),(0,o.Z)(e))),H()},children:"\u751f\u6210"}),(0,R.jsx)("button",{onClick:function(){if(A(!I),P.current&&cancelAnimationFrame(P.current),!I){var e=Date.now();P.current=requestAnimationFrame((function t(){var o=Date.now();if(o-e>=100){e=o;var r=function(e,t){return e.forEach((function(e){var n=h(-t.scrollX,t.canvasWidth-t.scrollX),o=h(-t.scrollY,t.canvasHeight-t.scrollY);e.x=n,e.y=o})),e}(D.getElementsIncludingDeleted(),oe);j({elements:r,appState:oe,scale:window.devicePixelRatio,canvas:n.current,renderConfig:{selectionColor:"#6965db",scrollX:oe.scrollX,scrollY:oe.scrollY,viewBackgroundColor:"#ffffff",zoom:oe.zoom}})}P.current=requestAnimationFrame(t)}))}},children:I?"\u505c\u6b62\u52a8\u753b":"\u52a8\u753b"})]}),(0,R.jsx)("div",{id:"placeholder"})]})}))},2121:function(e,t,n){n.d(t,{Sp:function(){return i},aF:function(){return l}});var o=n(1413),r=n(9439),a=n(5204),i=function(e,t){var n=(0,a.KP)(e),o=(0,r.Z)(n,4),i=o[0],l=o[1],c=o[2],s=o[3];return[i,l,(0,a.TE)(i,c)+2*t,(0,a.TE)(l,s)+t+t]},l=function(e){var t=e.renderScene,n=e.isExport,a=void 0===n||n,l=e.notUseCache,c=function(e){var t=e.renderScene,n=e.isExport,a=e.notUseCache,l=e.elements,c=e.appState,s=i(l,10),u=(0,r.Z)(s,4),d=u[0],f=u[1],v=u[2],h=u[3];console.log("export...",d,f,v,h);var m=document.createElement("canvas");return m.width=v*window.devicePixelRatio,m.height=h*window.devicePixelRatio,t({elements:l,appState:(0,o.Z)((0,o.Z)({},c),{},{scrollX:10-d,scrollY:10-f}),scale:window.devicePixelRatio,canvas:m,renderConfig:{selectionColor:"#6965db",scrollX:10-d,scrollY:10-f,viewBackgroundColor:"#ffffff",zoom:{value:1},isExport:n,notUseCache:a}}),m.toDataURL()}({renderScene:t,isExport:a,notUseCache:void 0===l||l,elements:e.elements,appState:e.appState}),s=document.createElement("a");s.href=c,s.download="canvas.png",s.click()}},5204:function(e,t,n){n.d(t,{$9:function(){return s},B8:function(){return c},KP:function(){return v},Pi:function(){return f},TE:function(){return m},dE:function(){return l},kb:function(){return p},mO:function(){return x},qf:function(){return h}});var o=n(9439),r=n(7762),a=n(3433),i=n(4453),l=function(e,t){var n=e.clientX,o=e.clientY,r=t.zoom,a=t.offsetLeft,i=t.offsetTop,l=t.scrollX,c=t.scrollY,s=r?r.value:1;return{x:(n-a)/s-l,y:(o-i)/s-c}},c=function(){var e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),n=Math.floor(256*Math.random());return"rgb(".concat(e,",").concat(t,",").concat(n,")")},s=function(e){return function(e,t){var n=null,o=null,r=null,i=function t(i){n=window.requestAnimationFrame((function(){n=null,e.apply(void 0,(0,a.Z)(i)),o=null,r&&(o=r,r=null,t(o))}))},l=function(){for(var e=arguments.length,a=new Array(e),l=0;l<e;l++)a[l]=arguments[l];o=a,null===n?i(o):null!==t&&void 0!==t&&t.trailing&&(r=a)};return l.flush=function(){null!==n&&(cancelAnimationFrame(n),n=null),o&&(e.apply(void 0,(0,a.Z)(r||o)),o=r=null)},l.cancel=function(){o=r=null,null!==n&&(cancelAnimationFrame(n),n=null)},l}((function(t){(0,i.unstable_batchedUpdates)(e,t)}))},u=function(e){var t=1/0,n=1/0,a=-1/0,i=-1/0,l=e.points;"freedraw"===e.type&&(l=e.points.map((function(t){return[t[0]-e.x,t[1]-e.y]})));var c,s=(0,r.Z)(l);try{for(s.s();!(c=s.n()).done;){var u=(0,o.Z)(c.value,2),d=u[0],f=u[1];t=Math.min(t,d),n=Math.min(n,f),a=Math.max(a,d),i=Math.max(i,f)}}catch(v){s.e(v)}finally{s.f()}return[t,n,a,i]},d=function(e,t,n,o,r){return[(e-n)*Math.cos(r)-(t-o)*Math.sin(r)+n,(e-n)*Math.sin(r)+(t-o)*Math.cos(r)+o]},f=function(e){var t=h(e),n=(0,o.Z)(t,6),r=n[0],a=n[1],i=n[2],l=n[3],c=n[4],s=n[5];if("freedraw"===e.type){var f=u(e),v=(0,o.Z)(f,4),m=v[0],g=v[1],p=v[2],x=v[3];return[m+e.x,g+e.y,p+e.x,x+e.y]}var y=d(r,a,c,s,e.angle),w=(0,o.Z)(y,2),k=w[0],S=w[1],C=d(r,l,c,s,e.angle),E=(0,o.Z)(C,2),j=E[0],T=E[1],Z=d(i,l,c,s,e.angle),b=(0,o.Z)(Z,2),M=b[0],R=b[1],z=d(i,a,c,s,e.angle),_=(0,o.Z)(z,2),X=_[0],Y=_[1];return[Math.min(k,j,M,X),Math.min(S,T,R,Y),Math.max(k,j,M,X),Math.max(S,T,R,Y)]},v=function(e){if(!e.length)return[0,0,0,0];var t=1/0,n=-1/0,r=1/0,a=-1/0;return e.forEach((function(e){var i=f(e),l=(0,o.Z)(i,4),c=l[0],s=l[1],u=l[2],d=l[3];t=Math.min(t,c),r=Math.min(r,s),n=Math.max(n,u),a=Math.max(a,d)})),[t,r,n,a]},h=function(e){if("freedraw"===e.type){var t=u(e),n=(0,o.Z)(t,4),r=n[0],a=n[1],i=n[2],l=n[3],c=r+e.x,s=a+e.y,d=i+e.x,f=l+e.y;return[c,s,d,f,(c+d)/2,(s+f)/2]}return[e.x,e.y,e.x+e.width,e.y+e.height,e.x+e.width/2,e.y+e.height/2]},m=function(e,t){return Math.abs(e-t)},g=0,p=function(){return"id".concat(g++)},x=function(e){var t=e.fontSize,n=e.fontFamily;return"".concat(t,"px ").concat(n,", Segoe UI Emoji")}},4975:function(e,t,n){n.d(t,{E:function(){return r},j:function(){return o}});var o=function(e){return Math.max(.1,Math.min(e,30))},r=function(e,t){var n=e.viewportX,o=e.viewportY,r=e.nextZoom,a=n-t.offsetLeft,i=o-t.offsetTop,l=t.zoom.value;return{scrollX:t.scrollX+a/r-a/l,scrollY:t.scrollY+i/r-i/l,zoom:{value:r}}}}}]);
//# sourceMappingURL=OffscreenCanvas.dfe1f8b8.chunk.js.map