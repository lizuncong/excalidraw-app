"use strict";(self.webpackChunkexcalidraw_app=self.webpackChunkexcalidraw_app||[]).push([[343],{9040:function(e,t,n){n.r(t),n.d(t,{default:function(){return b}});var o=n(1413),r=n(3433),i=n(2791),l=function(e,t){var n=e.clientX,o=e.clientY,r=t.offsetLeft,i=t.offsetTop;return{x:n-r-t.scrollX,y:o-i-t.scrollY}},a=function(e,t){return Math.abs(e-t)},s=0,c=n(4925),d=["type","x","y","strokeColor","backgroundColor","fillStyle","strokeWidth","strokeStyle","roughness","opacity","width","height","angle","groupIds","roundness","boundElements","link","locked"],u=new WeakMap,v=new WeakMap,f=function(e){var t=u.get(e);if(void 0===t){if(v.delete(e),"rectangle"!==e.type)throw new Error("Unimplemented type ".concat(e.type));e.roundness,y(e,t)}},h=function(e,t){var n=t.zoom||1,o=v.get(e);return o||w(e,n,t)},g=document.getElementsByClassName("right")[0],m=null,w=function(e,t,n){var o=document.createElement("canvas"),r=o.getContext("2d"),i=k(e);m&&g.removeChild(m),m=o,g.appendChild(m);return o.width=e.width*window.devicePixelRatio*t+i*t*2,o.height=e.height*window.devicePixelRatio*t+i*t*2,r.save(),r.translate(i*t,i*t),r.scale(window.devicePixelRatio*t,window.devicePixelRatio*t),p(e,r,n),r.restore(),{element:e,canvas:o,theme:n.theme,canvasZoom:t,canvasOffsetX:0,canvasOffsetY:0}},p=function(e,t,n){if(t.globalAlpha=e.opacity/100,"rectangle"===e.type)t.lineJoin="round",t.lineCap="round",t.strokeStyle="red",t.strokeRect(0,0,e.width,e.height);t.globalAlpha=1},y=function(e,t){return u.set(e,t)},k=function(e){return"freedraw"===e.type?12*e.strokeWidth:20},x=function(e,t,n){var o=e.element,r=k(o),i=[o.x,o.y,o.x+o.width,o.y+o.height],l=i[0],a=i[1],s=i[2],c=i[3],d=((l+s)/2+n.scrollX)*window.devicePixelRatio,u=((a+c)/2+n.scrollY)*window.devicePixelRatio;t.save(),t.scale(1/window.devicePixelRatio,1/window.devicePixelRatio),t.translate(d,u),t.drawImage(e.canvas,-(s-l)/2*window.devicePixelRatio-r*e.canvasZoom/e.canvasZoom,-(c-a)/2*window.devicePixelRatio-r*e.canvasZoom/e.canvasZoom,e.canvas.width/e.canvasZoom,e.canvas.height/e.canvasZoom),t.restore()},C=function(e){var t=e.elements,n=(e.appState,e.scale),o=e.canvas,r=e.renderConfig,i=o.getContext("2d");i.setTransform(1,0,0,1,0,0),i.save(),i.scale(n,n);var l=o.width/n,a=o.height/n;r.viewBackgroundColor&&(i.save(),i.fillStyle=r.viewBackgroundColor,i.fillRect(0,0,l,a),i.restore()),i.save(),i.scale(r.zoom,r.zoom),t.forEach((function(e){!function(e,t,n,o){if("rectangle"!==e.type)throw new Error("Unimplemented type ".concat(e.type));f(e);var r=h(e,n);x(r,t,n)}(e,i,r)})),i.restore(),i.restore()},E=n(5671),S=n(3144),I=function(){function e(){(0,E.Z)(this,e),this.elements=[]}return(0,S.Z)(e,[{key:"getElementsIncludingDeleted",value:function(){return this.elements}},{key:"replaceAllElements",value:function(e){this.elements=e}}]),e}(),T=n(184),R=new I,L={scrollX:0,scrollY:0,offsetLeft:0,offsetTop:0,draggingElement:null,currentItemStrokeColor:"#000000",currentItemBackgroundColor:"transparent",currentItemFillStyle:"hachure",currentItemStrokeWidth:1,currentItemStrokeStyle:"solid",currentItemRoughness:1,currentItemOpacity:100},P=(0,i.memo)((function(){var e=(0,i.useRef)(null),t=(0,i.useRef)(null);(0,i.useEffect)((function(){var t=e.current,n=t.getContext("2d"),o=t.offsetWidth,r=t.offsetHeight,i=t.offsetLeft,l=t.offsetTop;t.width=o*window.devicePixelRatio,t.height=r*window.devicePixelRatio,L.offsetLeft=i,L.offsetTop=l,function(e,t){var n=e.canvas;e.clearRect(0,0,n.width,n.height),function(e,t){var n=t.scrollX,o=t.scrollY;e.save();var r=100,i=100,l=e.canvas;e.translate(n,o),e.strokeStyle="red",e.fillStyle="red",e.save(),e.beginPath(),e.setLineDash([10,10]),e.moveTo(0,-o),e.lineTo(0,l.height-o),e.moveTo(-n,0),e.lineTo(l.width-n,0),e.stroke(),e.restore(),e.beginPath(),e.lineWidth=2,e.textBaseline="middle";for(var a=0;a<o/r;a++)e.moveTo(0,-a*r),e.lineTo(8,-a*r),e.font="20px Arial",e.fillText(-a,-25,-a*r);for(var s=0;s<(l.height-o)/r;s++)e.moveTo(0,s*r),e.lineTo(8,s*r),e.font="20px Arial",e.fillText(s,-25,s*r);for(var c=1;c<n/i;c++)e.moveTo(-c*i,0),e.lineTo(-c*i,8),e.font="20px Arial",e.fillText(-c,-c*i-10,-15);for(var d=1;d<(l.width-n)/i;d++)e.moveTo(d*i,0),e.lineTo(d*i,8),e.font="20px Arial",e.fillText(d,d*i-5,-15);e.stroke(),e.restore()}(e,t)}(n,L)}),[]),(0,i.useEffect)((function(){var e=t.current,n=function(e){e.preventDefault()};return e.addEventListener("wheel",n,{passive:!1}),function(){e.removeEventListener("wheel",n)}}),[]);var n=function(e,t){var n=function(e){var t,n=e.type,o=e.x,r=e.y,i=e.strokeColor,l=e.backgroundColor,a=e.fillStyle,u=e.strokeWidth,v=e.strokeStyle,f=e.roughness,h=e.opacity,g=e.width,m=void 0===g?0:g,w=e.height,p=void 0===w?0:w,y=e.angle,k=void 0===y?0:y,x=e.groupIds,C=void 0===x?[]:x,E=e.roundness,S=void 0===E?null:E,I=e.boundElements,T=void 0===I?null:I,R=e.link,L=void 0===R?null:R,P=e.locked,b=(0,c.Z)(e,d);return{id:"id".concat(s++),type:n,x:o,y:r,width:m,height:p,angle:k,strokeColor:i,backgroundColor:l,fillStyle:a,strokeWidth:u,strokeStyle:v,roughness:f,opacity:h,groupIds:C,roundness:S,version:b.version||1,versionNonce:null!==(t=b.versionNonce)&&void 0!==t?t:0,isDeleted:!1,boundElements:T,updated:Date.now(),link:L,locked:P}}({type:e,x:t.origin.x,y:t.origin.y,strokeColor:L.currentItemStrokeColor,backgroundColor:L.currentItemBackgroundColor,fillStyle:L.currentItemFillStyle,strokeWidth:L.currentItemStrokeWidth,strokeStyle:L.currentItemStrokeStyle,roughness:L.currentItemRoughness,opacity:L.currentItemOpacity,roundness:null,locked:!1});R.replaceAllElements([].concat((0,r.Z)(R.getElementsIncludingDeleted()),[n])),L.draggingElement=n},u=function(e){return function(t){window.removeEventListener("pointermove",e.eventListeners.onMove),window.removeEventListener("pointerup",e.eventListeners.onUp)}},v=function(t){return function(n){var o=l(n,L);t.lastCoords.x=o.x,t.lastCoords.y=o.y,f(t,n),C({elements:R.getElementsIncludingDeleted(),appState:L,scale:window.devicePixelRatio,canvas:e.current,renderConfig:{selectionColor:"#6965db",scrollX:L.scrollX,scrollY:L.scrollY,viewBackgroundColor:"#ffffff",zoom:1}})}},f=function(e,t){var n=e.lastCoords;!function(e,t,n,o,r,i,l,a,s,c,d){0!==l&&0!==a&&function(e,t){for(var n in t){var o=t[n];"undefined"!==typeof o&&(e[n]=o)}}(e,{x:r<n?n-l:n,y:i<o?o-a:o,width:l,height:a})}(L.draggingElement,0,e.origin.x,e.origin.y,n.x,n.y,a(e.origin.x,n.x),a(e.origin.y,n.y))},h=function(e){var t=l(e,L);return{origin:t,lastCoords:(0,o.Z)({},t),eventListeners:{onMove:null,onUp:null,onKeyUp:null,onKeyDown:null}}};return(0,T.jsx)("div",{ref:t,children:(0,T.jsx)("canvas",{onWheel:function(e){var t=e.deltaX,n=e.deltaY;L.scrollX=L.scrollX-t,L.scrollY=L.scrollY-n,console.log("wheel",L.scrollX,L.scrollY)},onPointerDown:function(e){var t=h(e);n("rectangle",t);var o=v(t),r=u(t);window.addEventListener("pointermove",o),window.addEventListener("pointerup",r),t.eventListeners.onMove=o,t.eventListeners.onUp=r},ref:e,className:"canvas",children:"\u7ed8\u5236canvas"})})})),b=P}}]);
//# sourceMappingURL=Canvas.f2af895b.chunk.js.map