"use strict";(this.webpackChunkexcalidraw_app=this.webpackChunkexcalidraw_app||[]).push([[408],{98225:function(e,t,n){n.r(t),n.d(t,{default:function(){return m},elements:function(){return f}});var o=n(1413),r=n(4519),i=function(e,t){var n=e.getContext("2d");n.clearRect(0,0,e.width,e.height),function(e,t){var n=t.zoom,o=t.scrollX,r=t.scrollY;e.save();var i=100*n.value,l=100*n.value,a=8*n.value,s=e.canvas,c=o*n.value,u=r*n.value;e.translate(c,u),e.strokeStyle="red",e.fillStyle="red",e.save(),e.beginPath(),e.setLineDash([10,10]),e.moveTo(0,-u),e.lineTo(0,s.height-u),e.moveTo(-c,0),e.lineTo(s.width-c,0),e.stroke(),e.restore(),e.beginPath(),e.lineWidth=2,e.textBaseline="middle";for(var v=0;v<u/i;v++)e.moveTo(0,-v*i),e.lineTo(a,-v*i),e.font="".concat(20*n.value,"px Arial"),e.fillText(-v,-25,-v*i);for(var f=0;f<(s.height-u)/i;f++)e.moveTo(0,f*i),e.lineTo(a,f*i),e.font="".concat(20*n.value,"px Arial"),e.fillText(f,-25,f*i);for(var d=1;d<c/l;d++)e.moveTo(-d*l,0),e.lineTo(-d*l,a),e.font="".concat(20*n.value,"px Arial"),e.fillText(-d,-d*l-10,-15);for(var h=1;h<(s.width-c)/l;h++)e.moveTo(h*l,0),e.lineTo(h*l,a),e.font="".concat(20*n.value,"px Arial"),e.fillText(h,h*l-5,-15);e.stroke(),e.restore()}(n,t),function(e,t){f.forEach((function(n){e.save(),e.scale(t.zoom.value,t.zoom.value),e.translate(n.x+t.scrollX,n.y+t.scrollY),e.strokeStyle=n.strokeStyle,e.strokeColor=n.strokeColor,e.strokeRect(0,0,n.width,n.height),e.restore()}))}(n,t)},l=n(5909),a=n(44975),s={pointers:new Map,lastCenter:null,initialDistance:null,initialScale:null},c=function(e,t){(0,r.useEffect)((function(){var t=e.current,n=function(e){e.touches.length||s.pointers.clear()};return t.addEventListener("touchend",n),function(){t.removeEventListener("touchend",n)}}),[e]);return{gesture:s,removePointer:function(e){s.pointers.delete(e.pointerId)},updateGestureOnPointerDown:function(e){s.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),2===s.pointers.size&&(s.lastCenter=(0,l.q)(s.pointers),s.initialScale=t.zoom.value,s.initialDistance=(0,l.S)(Array.from(s.pointers.values())))},handleCanvasPointerMove:function(e,n){s.pointers.has(e.pointerId)&&s.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY});var o=s.initialScale;if(2===s.pointers.size&&s.lastCenter&&o&&s.initialDistance){var r=(0,l.q)(s.pointers),i=r.x-s.lastCenter.x,c=r.y-s.lastCenter.y;s.lastCenter=r;var u=(0,l.S)(Array.from(s.pointers.values()))/s.initialDistance,v=u?(0,a.j)(o*u):t.zoom.value,f=(0,a.E)({viewportX:r.x,viewportY:r.y,nextZoom:v},t);Object.assign(t,{zoom:f.zoom,scrollX:f.scrollX+i/v,scrollY:f.scrollY+c/v}),n()}else s.lastCenter=s.initialDistance=s.initialScale=null}}},u=n(2556),v={zoom:{value:1},offsetLeft:0,offsetTop:0,scrollX:0,scrollY:0,draggingElement:null},f=[],d=function(e,t){var n=e.clientX,o=e.clientY,r=t.zoom,i=t.offsetLeft,l=t.offsetTop,a=t.scrollX,s=t.scrollY;return{x:(n-i)/r.value-a,y:(o-l)/r.value-s}},h=(0,r.memo)((function(){var e=(0,r.useRef)(null),t=(0,r.useRef)(null),n=(0,r.useRef)({}),l=(0,r.useRef)();(0,r.useEffect)((function(){var t=function(){var t=e.current,n=t.getContext("2d"),o=t.offsetWidth,r=t.offsetHeight,l=t.offsetLeft,a=t.offsetTop;t.width=o*window.devicePixelRatio,t.height=r*window.devicePixelRatio,n.scale(window.devicePixelRatio,window.devicePixelRatio),v.offsetLeft=l,v.offsetTop=a,i(t,v)};t();var n=function(){t()};return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}}),[]),(0,r.useEffect)((function(){var e=t.current,o=function(e){e.preventDefault()};e.addEventListener("wheel",o,{passive:!1});var r=function(e){n.current={cursorX:e.clientX,cursorY:e.clientY}};return document.addEventListener("mousemove",r),function(){e.removeEventListener("wheel",o),document.removeEventListener("mousemove",r)}}),[]);var a=c(e,v),s=a.updateGestureOnPointerDown,h=a.handleCanvasPointerMove,m=a.removePointer,p=a.gesture,x=function(e){return function(t){m(t),window.removeEventListener("pointermove",e.eventListeners.onMove),window.removeEventListener("pointerup",e.eventListeners.onUp)}},w=function(t){return function(n){var o=d(n,v);t.lastCoords.x=o.x,t.lastCoords.y=o.y,v.draggingElement.width=o.x-t.origin.x,v.draggingElement.height=o.y-t.origin.y,i(e.current,v)}};return(0,u.jsxs)("div",{className:"gesture",children:[(0,u.jsx)("div",{ref:t,children:(0,u.jsx)("canvas",{ref:e,className:"canvas",onPointerDown:function(e){if(s(e),!(p.pointers.size>1)){var t=d(e,v),n={origin:t,lastCoords:(0,o.Z)({},t),eventListeners:{onMove:null,onUp:null}},r={x:n.origin.x,y:n.origin.y,width:0,height:0,strokeColor:"#000000",backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid"};v.draggingElement=r,f.push(r);var i=w(n),l=x(n);window.addEventListener("pointermove",i),window.addEventListener("pointerup",l),n.eventListeners.onMove=i,n.eventListeners.onUp=l}},onPointerCancel:m,onPointerMove:function(t){h(t,(function(){i(e.current,v)}))},onWheel:function(t){var r=t.deltaX,a=t.deltaY;if(t.metaKey||t.ctrlKey){var s=Math.sign(a),c=Math.abs(a),u=a;c>10&&(u=10*s);var f=v.zoom.value-u/100,d=function(e){return Math.max(.1,Math.min(e,30))}(f+=Math.log10(Math.max(1,v.zoom.value))*-s*Math.min(1,c/20));return Object.assign(v,(0,o.Z)({},function(e,t){var n=e.viewportX,o=e.viewportY,r=e.nextZoom,i=n-t.offsetLeft,l=o-t.offsetTop,a=t.zoom.value;return{scrollX:t.scrollX+i/r-i/a,scrollY:t.scrollY+l/r-l/a,zoom:{value:r}}}({viewportX:n.current.cursorX,viewportY:n.current.cursorY,nextZoom:d},v))),l.current.innerText="".concat((100*d).toFixed(0),"%"),void i(e.current,v)}v.scrollX=v.scrollX-r/v.zoom.value,v.scrollY=v.scrollY-a/v.zoom.value,i(e.current,v)},children:"\u7ed8\u5236canvas"})}),(0,u.jsx)("div",{children:(0,u.jsx)("button",{onClick:function(){var e=1/0,t=-1/0,n=1/0,r=-1/0;f.forEach((function(o){var i=[o.x,o.y,o.x+o.width,o.y+o.height],l=i[0],a=i[1],s=i[2],c=i[3];e=Math.min(e,l),n=Math.min(n,a),t=Math.max(t,s),r=Math.max(r,c)}));var l=document.createElement("canvas");l.width=(t-e+20)*window.devicePixelRatio,l.height=(r-n+20)*window.devicePixelRatio,l.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio),i(l,(0,o.Z)((0,o.Z)({},v),{},{scrollX:10-e,scrollY:10-n}));var a=document.createElement("a");a.href=l.toDataURL(),a.download="canvas.png",a.click()},children:"\u5bfc\u51faPNG"})}),(0,u.jsx)("div",{ref:l})]})})),m=h},5909:function(e,t,n){n.d(t,{S:function(){return i},q:function(){return r}});var o=n(29439),r=function(e){var t=Array.from(e.values());return{x:l(t,(function(e){return e.x}))/t.length,y:l(t,(function(e){return e.y}))/t.length}},i=function(e){var t=(0,o.Z)(e,2),n=t[0],r=t[1];return Math.hypot(n.x-r.x,n.y-r.y)},l=function(e,t){return e.reduce((function(e,n){return e+t(n)}),0)}},44975:function(e,t,n){n.d(t,{E:function(){return r},j:function(){return o}});var o=function(e){return Math.max(.1,Math.min(e,30))},r=function(e,t){var n=e.viewportX,o=e.viewportY,r=e.nextZoom,i=n-t.offsetLeft,l=o-t.offsetTop,a=t.zoom.value;return{scrollX:t.scrollX+i/r-i/a,scrollY:t.scrollY+l/r-l/a,zoom:{value:r}}}}}]);
//# sourceMappingURL=Gesture.eb60c23a.chunk.js.map