"use strict";(self.webpackChunkexcalidraw_app=self.webpackChunkexcalidraw_app||[]).push([[343],{5466:function(e,t,n){n.r(t),n.d(t,{default:function(){return y}});var o=n(1413),r=n(3433),l=n(2791),i=function(e,t){var n=e.clientX,o=e.clientY,r=t.offsetLeft,l=t.offsetTop;return{x:n-r-t.scrollX,y:o-l-t.scrollY}},s=function(e,t){return Math.abs(e-t)},c=0,u=n(4925),a=["type","x","y","strokeColor","backgroundColor","fillStyle","strokeWidth","strokeStyle","roughness","opacity","width","height","angle","groupIds","roundness","boundElements","link","locked"],d=n(5671),f=n(3144),v=function(){function e(){(0,d.Z)(this,e),this.elements=[]}return(0,f.Z)(e,[{key:"getElementsIncludingDeleted",value:function(){return this.elements}},{key:"replaceAllElements",value:function(e){this.elements=e}}]),e}(),h=n(184),g=new v,p={scrollX:0,scrollY:0,offsetLeft:0,offsetTop:0,draggingElement:null,currentItemStrokeColor:"#000000",currentItemBackgroundColor:"transparent",currentItemFillStyle:"hachure",currentItemStrokeWidth:1,currentItemStrokeStyle:"solid",currentItemRoughness:1,currentItemOpacity:100},m=(0,l.memo)((function(){var e=(0,l.useRef)(null),t=(0,l.useRef)(null);(0,l.useEffect)((function(){var t=e.current,n=t.getContext("2d"),o=t.offsetWidth,r=t.offsetHeight,l=t.offsetLeft,i=t.offsetTop;t.width=o*window.devicePixelRatio,t.height=r*window.devicePixelRatio,p.offsetLeft=l,p.offsetTop=i,function(e,t){var n=e.canvas;e.clearRect(0,0,n.width,n.height),function(e,t){var n=t.scrollX,o=t.scrollY;e.save();var r=100,l=100,i=e.canvas;e.translate(n,o),e.strokeStyle="red",e.fillStyle="red",e.save(),e.beginPath(),e.setLineDash([10,10]),e.moveTo(0,-o),e.lineTo(0,i.height-o),e.moveTo(-n,0),e.lineTo(i.width-n,0),e.stroke(),e.restore(),e.beginPath(),e.lineWidth=2,e.textBaseline="middle";for(var s=0;s<o/r;s++)e.moveTo(0,-s*r),e.lineTo(8,-s*r),e.font="20px Arial",e.fillText(-s,-25,-s*r);for(var c=0;c<(i.height-o)/r;c++)e.moveTo(0,c*r),e.lineTo(8,c*r),e.font="20px Arial",e.fillText(c,-25,c*r);for(var u=1;u<n/l;u++)e.moveTo(-u*l,0),e.lineTo(-u*l,8),e.font="20px Arial",e.fillText(-u,-u*l-10,-15);for(var a=1;a<(i.width-n)/l;a++)e.moveTo(a*l,0),e.lineTo(a*l,8),e.font="20px Arial",e.fillText(a,a*l-5,-15);e.stroke(),e.restore()}(e,t),function(e,t){var n=t.scrollX,o=t.scrollY;e.save(),e.translate(20+n,20+o),e.fillStyle="rgba(0, 0, 200, 0.04)",e.fillRect(0,0,200,200),e.lineWidth=1,e.strokeStyle="rgb(105, 101, 219)",e.strokeRect(0,0,200,200),e.restore()}(e,t)}(n,p)}),[]),(0,l.useEffect)((function(){var e=t.current,n=function(e){e.preventDefault()};return e.addEventListener("wheel",n,{passive:!1}),function(){e.removeEventListener("wheel",n)}}),[]);var n=function(e,t){var n=function(e){var t,n=e.type,o=e.x,r=e.y,l=e.strokeColor,i=e.backgroundColor,s=e.fillStyle,d=e.strokeWidth,f=e.strokeStyle,v=e.roughness,h=e.opacity,g=e.width,p=void 0===g?0:g,m=e.height,y=void 0===m?0:m,k=e.angle,w=void 0===k?0:k,x=e.groupIds,S=void 0===x?[]:x,I=e.roundness,T=void 0===I?null:I,C=e.boundElements,E=void 0===C?null:C,L=e.link,b=void 0===L?null:L,W=e.locked,D=(0,u.Z)(e,a);return{id:"id".concat(c++),type:n,x:o,y:r,width:p,height:y,angle:w,strokeColor:l,backgroundColor:i,fillStyle:s,strokeWidth:d,strokeStyle:f,roughness:v,opacity:h,groupIds:S,roundness:T,version:D.version||1,versionNonce:null!==(t=D.versionNonce)&&void 0!==t?t:0,isDeleted:!1,boundElements:E,updated:Date.now(),link:b,locked:W}}({type:e,x:t.origin.x,y:t.origin.y,strokeColor:p.currentItemStrokeColor,backgroundColor:p.currentItemBackgroundColor,fillStyle:p.currentItemFillStyle,strokeWidth:p.currentItemStrokeWidth,strokeStyle:p.currentItemStrokeStyle,roughness:p.currentItemRoughness,opacity:p.currentItemOpacity,roundness:null,locked:!1});g.replaceAllElements([].concat((0,r.Z)(g.getElementsIncludingDeleted()),[n])),p.draggingElement=n},d=function(e){return function(t){window.removeEventListener("pointermove",e.eventListeners.onMove),window.removeEventListener("pointerup",e.eventListeners.onUp)}},f=function(e){return function(t){var n=i(t,p);e.lastCoords.x=n.x,e.lastCoords.y=n.y,v(e,t),console.log("elements....",g.getElementsIncludingDeleted())}},v=function(e,t){var n=e.lastCoords;!function(e,t,n,o,r,l,i,s,c,u,a){0!==i&&0!==s&&function(e,t){for(var n in t){var o=t[n];"undefined"!==typeof o&&(e[n]=o)}}(e,{x:r<n?n-i:n,y:l<o?o-s:o,width:i,height:s})}(p.draggingElement,0,e.origin.x,e.origin.y,n.x,n.y,s(e.origin.x,n.x),s(e.origin.y,n.y))},m=function(e){var t=i(e,p);return{origin:t,lastCoords:(0,o.Z)({},t),eventListeners:{onMove:null,onUp:null,onKeyUp:null,onKeyDown:null}}};return(0,h.jsx)("div",{ref:t,children:(0,h.jsx)("canvas",{onWheel:function(e){var t=e.deltaX,n=e.deltaY;p.scrollX=p.scrollX-t,p.scrollY=p.scrollY-n,console.log("wheel",p.scrollX,p.scrollY)},onPointerDown:function(e){var t=m(e);n("rectangle",t);var o=f(t),r=d(t);window.addEventListener("pointermove",o),window.addEventListener("pointerup",r),t.eventListeners.onMove=o,t.eventListeners.onUp=r},ref:e,className:"canvas",children:"\u7ed8\u5236canvas"})})})),y=m}}]);
//# sourceMappingURL=Canvas.ae3b38e1.chunk.js.map