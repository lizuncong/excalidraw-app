"use strict";(self.webpackChunkexcalidraw_app=self.webpackChunkexcalidraw_app||[]).push([[804],{9418:function(e,o,t){t.r(o),t.d(o,{default:function(){return v},elements:function(){return s}});var n=t(1413),r=t(2791),i=function(e,o){var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),function(e,o){var t=o.zoom,n=o.scrollX,r=o.scrollY;e.save();var i=100*t.value,l=100*t.value,a=8*t.value,s=e.canvas,c=n*t.value,v=r*t.value;e.translate(c,v),e.strokeStyle="red",e.fillStyle="red",e.save(),e.beginPath(),e.setLineDash([10,10]),e.moveTo(0,-v),e.lineTo(0,s.height-v),e.moveTo(-c,0),e.lineTo(s.width-c,0),e.stroke(),e.restore(),e.beginPath(),e.lineWidth=2,e.textBaseline="middle";for(var u=0;u<v/i;u++)e.moveTo(0,-u*i),e.lineTo(a,-u*i),e.font="".concat(20*t.value,"px Arial"),e.fillText(-u,-25,-u*i);for(var f=0;f<(s.height-v)/i;f++)e.moveTo(0,f*i),e.lineTo(a,f*i),e.font="".concat(20*t.value,"px Arial"),e.fillText(f,-25,f*i);for(var d=1;d<c/l;d++)e.moveTo(-d*l,0),e.lineTo(-d*l,a),e.font="".concat(20*t.value,"px Arial"),e.fillText(-d,-d*l-10,-15);for(var h=1;h<(s.width-c)/l;h++)e.moveTo(h*l,0),e.lineTo(h*l,a),e.font="".concat(20*t.value,"px Arial"),e.fillText(h,h*l-5,-15);e.stroke(),e.restore()}(t,o),function(e,o){s.forEach((function(t){e.save(),console.log("appStsate...",o.scrollX),e.translate((t.x+o.scrollX)*o.zoom.value,(t.y+o.scrollY)*o.zoom.value),e.scale(o.zoom.value,o.zoom.value),e.strokeStyle=t.strokeStyle,e.strokeColor=t.strokeColor,e.strokeRect(0,0,t.width,t.height),e.restore()}))}(t,o)},l=t(184),a={zoom:{value:1},offsetLeft:0,offsetTop:0,scrollX:0,scrollY:0,draggingElement:null},s=[],c=function(e,o){var t=e.clientX,n=e.clientY,r=o.zoom,i=o.offsetLeft,l=o.offsetTop,a=o.scrollX,s=o.scrollY;return{x:(t-i)/r.value-a,y:(n-l)/r.value-s}},v=(0,r.memo)((function(){var e=(0,r.useRef)(null),o=(0,r.useRef)(null),t=(0,r.useRef)({}),v=(0,r.useRef)();(0,r.useEffect)((function(){var o=function(){var o=e.current,t=o.getContext("2d"),n=o.offsetWidth,r=o.offsetHeight,l=o.offsetLeft,s=o.offsetTop;o.width=n*window.devicePixelRatio,o.height=r*window.devicePixelRatio,t.scale(window.devicePixelRatio,window.devicePixelRatio),a.offsetLeft=l,a.offsetTop=s,i(o,a)};o();var t=function(){o()};return window.addEventListener("resize",t),function(){window.removeEventListener("resize",t)}}),[]),(0,r.useEffect)((function(){var e=o.current,n=function(e){e.preventDefault()};e.addEventListener("wheel",n,{passive:!1});var r=function(e){t.current={cursorX:e.clientX,cursorY:e.clientY}};return document.addEventListener("mousemove",r),function(){e.removeEventListener("wheel",n),document.removeEventListener("mousemove",r)}}),[]);var u=function(e){return function(o){window.removeEventListener("pointermove",e.eventListeners.onMove),window.removeEventListener("pointerup",e.eventListeners.onUp)}},f=function(o){return function(t){var n=c(t,a);o.lastCoords.x=n.x,o.lastCoords.y=n.y,a.draggingElement.width=n.x-o.origin.x,a.draggingElement.height=n.y-o.origin.y,i(e.current,a)}};return(0,l.jsxs)("div",{className:"infinite-canvas",children:[(0,l.jsx)("div",{ref:o,children:(0,l.jsx)("canvas",{ref:e,className:"canvas",onPointerDown:function(e){var o=c(e,a);console.log("origin...",a,o);var t={origin:o,lastCoords:(0,n.Z)({},o),eventListeners:{onMove:null,onUp:null}},r={x:t.origin.x,y:t.origin.y,width:0,height:0,strokeColor:"#000000",backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid"};a.draggingElement=r,s.push(r);var i=f(t),l=u(t);window.addEventListener("pointermove",i),window.addEventListener("pointerup",l),t.eventListeners.onMove=i,t.eventListeners.onUp=l},onWheel:function(o){var r,l=o.deltaX,s=o.deltaY;if(o.metaKey||o.ctrlKey){var c=Math.sign(s),u=Math.abs(s),f=s;u>10&&(f=10*c);var d=a.zoom.value-f/100;d+=Math.log10(Math.max(1,a.zoom.value))*-c*Math.min(1,u/20);var h=(r=d,Math.max(.1,Math.min(r,30)));return Object.assign(a,(0,n.Z)({},function(e,o){var t=e.viewportX,n=e.viewportY,r=e.nextZoom,i=t-o.offsetLeft,l=n-o.offsetTop,a=o.zoom.value;return{scrollX:o.scrollX+i/r-i/a,scrollY:o.scrollY+l/r-l/a,zoom:{value:r}}}({viewportX:t.current.cursorX,viewportY:t.current.cursorY,nextZoom:h},a))),v.current.innerText="".concat((100*h).toFixed(0),"%"),void i(e.current,a)}a.scrollX=a.scrollX-l/a.zoom.value,a.scrollY=a.scrollY-s/a.zoom.value,i(e.current,a)},children:"\u7ed8\u5236canvas"})}),(0,l.jsx)("div",{children:(0,l.jsx)("button",{onClick:function(){var e=1/0,o=-1/0,t=1/0,r=-1/0;s.forEach((function(n){var i=[n.x,n.y,n.x+n.width,n.y+n.height],l=i[0],a=i[1],s=i[2],c=i[3];e=Math.min(e,l),t=Math.min(t,a),o=Math.max(o,s),r=Math.max(r,c)}));var l=document.createElement("canvas");l.width=(o-e+20)*window.devicePixelRatio,l.height=(r-t+20)*window.devicePixelRatio,l.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio),i(l,(0,n.Z)((0,n.Z)({},a),{},{scrollX:10-e,scrollY:10-t})),console.log("\u5bfc\u51fa",s);var c=document.createElement("a");c.href=l.toDataURL(),c.download="canvas.png",c.click()},children:"\u5bfc\u51faPNG"})}),(0,l.jsx)("div",{ref:v})]})}))}}]);
//# sourceMappingURL=Scale.13701486.chunk.js.map