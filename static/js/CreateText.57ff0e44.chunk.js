"use strict";(this.webpackChunkexcalidraw_app=this.webpackChunkexcalidraw_app||[]).push([[465],{5650:function(e,t,n){n.d(t,{Z:function(){return h}});var i=n(1413),o=n(4925),a=n(9439),r=n(4519),l=n(9149),c=n(9410),u=n(8106),s=n(1695),f=(n(9011),n(2556)),d=["node","inline","className","children"];var h=function(e){var t=e.src,n=(0,r.useState)(""),h=(0,a.Z)(n,2),g=h[0],x=h[1];return(0,r.useEffect)((function(){fetch(t).then((function(e){return e.text()})).then((function(e){x(e)}))}),[t]),(0,f.jsx)("div",{className:"markdown-body",children:(0,f.jsx)(l.D,{children:g,rehypePlugins:[s.Z],remarkPlugins:[c.Z],components:{code:function(e){e.node;var t=e.inline,n=e.className,a=e.children,r=(0,o.Z)(e,d),l=/language-(\w+)/.exec(n||"");return!t&&l?(0,f.jsx)(u.Z,(0,i.Z)({children:String(a).replace(/\n$/,""),language:l[1],className:"my-code",PreTag:"div"},r)):(0,f.jsx)("code",(0,i.Z)((0,i.Z)({className:n},r),{},{children:a}))}}})})}},2487:function(e,t,n){n.r(t),n.d(t,{default:function(){return w},elements:function(){return p}});var i=n(9439),o=n(4519),a=n(5204),r=n(5650),l=n(6818),c=n(1413),u=n(4925),s=["x","y","strokeColor","backgroundColor","fillStyle","strokeWidth","strokeStyle","roughness","opacity","width","height","angle"],f=function(e){var t=function(e){return e.replace(/\t/g,"        ").replace(/\r?\n|\r/g,"\n")}(e.text);return(0,c.Z)((0,c.Z)({},function(e,t){var n=t.x,i=t.y,o=t.strokeColor,r=t.backgroundColor,l=t.fillStyle,c=t.strokeWidth,f=t.strokeStyle,d=t.roughness,h=t.opacity,g=t.width,x=void 0===g?0:g,v=t.height,m=void 0===v?0:v,p=t.angle,y=void 0===p?0:p;return(0,u.Z)(t,s),{id:(0,a.kb)(),type:e,x:n,y:i,width:x,height:m,angle:y,strokeColor:o,backgroundColor:r,fillStyle:l,strokeWidth:c,strokeStyle:f,roughness:d,opacity:h}}("text",e)),{},{text:t,fontSize:e.fontSize,fontFamily:e.fontFamily,textAlign:e.textAlign,verticalAlign:e.verticalAlign,containerId:e.containerId||null,originalText:t})},d=function(e){var t=e.fontSize,n=e.fontFamily;return"".concat(t,"px ").concat(n,", Segoe UI Emoji")},h="text-elements",g=new WeakMap,x=function(e,t){p.forEach((function(n){var o=function(e){var t=g.get(e);if(t)return t;var n=document.createElement("canvas"),i=n.getContext("2d");n.width=e.width*window.devicePixelRatio+40,n.height=e.height*window.devicePixelRatio+40,i.save(),i.translate(20,20),i.scale(window.devicePixelRatio,window.devicePixelRatio),i.font=d(e),i.fillStyle=e.strokeColor,i.textAlign=e.textAlign;var o=e.text.split("\n"),a=o.length?e.height/o.length:18;i.textBaseline="bottom";for(var r=0;r<o.length;r++)i.fillText(o[r],0,(r+1)*a);return i.restore(),g.set(e,n),n}(n),r=(0,a.qf)(n),l=(0,i.Z)(r,4),c=l[0],u=l[1],s=l[2],f=l[3],h=((c+s)/2+t.scrollX)*window.devicePixelRatio,x=((u+f)/2+t.scrollY)*window.devicePixelRatio;e.save(),e.scale(1/window.devicePixelRatio,1/window.devicePixelRatio),e.translate(h,x),console.log(),e.drawImage(o,-(s-c)/2*window.devicePixelRatio-20,-(f-u)/2*window.devicePixelRatio-20,o.width,o.height),e.restore()}))},v=function(e,t){var n=e.getContext("2d");n.clearRect(0,0,e.width,e.height),x(n,t),localStorage.setItem(h,JSON.stringify(p))},m=n(2556),p=JSON.parse(localStorage.getItem(h))||[],y={offsetLeft:0,offsetTop:0,scrollX:0,scrollY:0,canvasWidth:0,canvasHeight:0,draggingElement:null},w=(0,o.memo)((function(){var e=(0,o.useRef)(null),t=(0,o.useRef)(null),n=(0,o.useRef)(null),c=(0,o.useRef)(null),u=(0,o.useState)(""),s=(0,i.Z)(u,2),h=s[0],x=s[1];(0,o.useEffect)((function(){var i=function(e){var t=e.getContext("2d");e.width=a*window.devicePixelRatio,e.height=r*window.devicePixelRatio,t.scale(window.devicePixelRatio,window.devicePixelRatio)},o=e.current,a=o.offsetWidth,r=o.offsetHeight;i(o),i(n.current);var l=o.getBoundingClientRect(),c=l.x,u=l.y;y.offsetLeft=c,y.offsetTop=u,y.canvasWidth=a,y.canvasHeight=r,v(n.current,y);var s=t.current,f=function(e){e.preventDefault()};return s.addEventListener("wheel",f,{passive:!1}),function(){s.removeEventListener("wheel",f)}}),[]);return(0,m.jsxs)("div",{className:"create-text",children:[(0,m.jsxs)("div",{className:"container wrap",ref:t,children:[(0,m.jsx)("canvas",{ref:n,className:"canvas",children:"\u9759\u6001canvas"}),(0,m.jsx)("canvas",{ref:e,className:"canvas draw",onDoubleClick:function(e){e.preventDefault(),e.stopPropagation();var t=(0,a.dE)(e,y),n=t.x,i=t.y,o=f({x:n,y:i,strokeColor:(0,a.B8)(),backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid",text:"",fontSize:20,fontFamily:"Virgil",textAlign:"left",verticalAlign:"top"});y.draggingElement=o;var r=c.current;r.focus();var l={font:d(o),left:"".concat(n,"px"),top:"".concat(i,"px"),opacity:1,color:o.strokeColor,fontSize:o.fontSize};Object.assign(r.style,l);var u=document.getElementById("copyText");Object.assign(u.style,l);var s=y.canvasWidth-n;r.style.maxWidth="".concat(s,"px"),r.style.width="".concat(o.fontSize,"px"),r.style.height="".concat(1.2*o.fontSize,"px")},children:"\u52a8\u6001canvas"}),(0,m.jsx)("textarea",{onChange:function(e){var t=e.target.value,n=c.current,i=parseFloat(n.style.maxWidth),o=document.getElementById("copyText");o.innerText=t;var a=o.getBoundingClientRect().width;if(a>i)if(a-i<30)console.log("\u6b63\u5e38\u7684\u8f93\u5165"),t=o.innerText=t.slice(0,t.length-1)+"\n"+t.slice(t.length-1);else{console.log("\u7c98\u8d34\u8fdb\u6765\u7684\u6587\u672c");var r=t.split("\n"),l=[];r.forEach((function(e){if(o.innerText=e,o.getBoundingClientRect().width<=i)l.push(e);else for(var t=0,n=1;n<e.length;n++){var a=e.slice(t,n);o.innerText=a,o.getBoundingClientRect().width>i?(l.push(e.slice(t,n-1)),t=n-1):n===e.length-1&&l.push(e.slice(t,n))}})),console.log("splitResult..",l),t=l.join("\n"),o.innerText=t}x(t);var u=o.getBoundingClientRect(),s=u.width,f=u.height;n.style.width="".concat(s+30,"px"),n.style.height="".concat(f,"px"),y.draggingElement.text=t},onBlur:function(){var e=y.draggingElement,t=c.current,i=document.getElementById("copyText");e.text&&(e.width=i.offsetWidth,e.height=i.offsetHeight,function(e){g.delete(e)}(y.draggingElement),p.push(y.draggingElement),v(n.current,y),setTimeout((function(){i.innerText="",x("")}),200)),Object.assign(t.style,{left:"0px",top:"0px",width:"20px",height:"30px",opacity:0})},value:h,className:"textarea",ref:c})]}),(0,m.jsx)("div",{id:"offscreen"}),(0,m.jsx)(r.Z,{src:l}),(0,m.jsx)("div",{style:{background:"grey"},id:"copyText",contentEditable:!0,className:"textarea textarea_copy"})]})}))},5204:function(e,t,n){n.d(t,{$9:function(){return u},B8:function(){return c},KP:function(){return h},Pi:function(){return d},TE:function(){return x},dE:function(){return l},kb:function(){return m},mO:function(){return p},qf:function(){return g}});var i=n(9439),o=n(7762),a=n(3433),r=n(4453),l=function(e,t){var n=e.clientX,i=e.clientY,o=t.zoom,a=t.offsetLeft,r=t.offsetTop,l=t.scrollX,c=t.scrollY,u=o?o.value:1;return{x:(n-a)/u-l,y:(i-r)/u-c}},c=function(){var e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),n=Math.floor(256*Math.random());return"rgb(".concat(e,",").concat(t,",").concat(n,")")},u=function(e){return function(e,t){var n=null,i=null,o=null,r=function t(r){n=window.requestAnimationFrame((function(){n=null,e.apply(void 0,(0,a.Z)(r)),i=null,o&&(i=o,o=null,t(i))}))},l=function(){for(var e=arguments.length,a=new Array(e),l=0;l<e;l++)a[l]=arguments[l];i=a,null===n?r(i):null!==t&&void 0!==t&&t.trailing&&(o=a)};return l.flush=function(){null!==n&&(cancelAnimationFrame(n),n=null),i&&(e.apply(void 0,(0,a.Z)(o||i)),i=o=null)},l.cancel=function(){i=o=null,null!==n&&(cancelAnimationFrame(n),n=null)},l}((function(t){(0,r.unstable_batchedUpdates)(e,t)}))},s=function(e){var t=1/0,n=1/0,a=-1/0,r=-1/0,l=e.points;"freedraw"===e.type&&(l=e.points.map((function(t){return[t[0]-e.x,t[1]-e.y]})));var c,u=(0,o.Z)(l);try{for(u.s();!(c=u.n()).done;){var s=(0,i.Z)(c.value,2),f=s[0],d=s[1];t=Math.min(t,f),n=Math.min(n,d),a=Math.max(a,f),r=Math.max(r,d)}}catch(h){u.e(h)}finally{u.f()}return[t,n,a,r]},f=function(e,t,n,i,o){return[(e-n)*Math.cos(o)-(t-i)*Math.sin(o)+n,(e-n)*Math.sin(o)+(t-i)*Math.cos(o)+i]},d=function(e){var t=g(e),n=(0,i.Z)(t,6),o=n[0],a=n[1],r=n[2],l=n[3],c=n[4],u=n[5];if("freedraw"===e.type){var d=s(e),h=(0,i.Z)(d,4),x=h[0],v=h[1],m=h[2],p=h[3];return[x+e.x,v+e.y,m+e.x,p+e.y]}var y=f(o,a,c,u,e.angle),w=(0,i.Z)(y,2),k=w[0],S=w[1],Z=f(o,l,c,u,e.angle),R=(0,i.Z)(Z,2),M=R[0],E=R[1],C=f(r,l,c,u,e.angle),b=(0,i.Z)(C,2),P=b[0],j=b[1],T=f(r,a,c,u,e.angle),N=(0,i.Z)(T,2),A=N[0],B=N[1];return[Math.min(k,M,P,A),Math.min(S,E,j,B),Math.max(k,M,P,A),Math.max(S,E,j,B)]},h=function(e){if(!e.length)return[0,0,0,0];var t=1/0,n=-1/0,o=1/0,a=-1/0;return e.forEach((function(e){var r=d(e),l=(0,i.Z)(r,4),c=l[0],u=l[1],s=l[2],f=l[3];t=Math.min(t,c),o=Math.min(o,u),n=Math.max(n,s),a=Math.max(a,f)})),[t,o,n,a]},g=function(e){if("freedraw"===e.type){var t=s(e),n=(0,i.Z)(t,4),o=n[0],a=n[1],r=n[2],l=n[3],c=o+e.x,u=a+e.y,f=r+e.x,d=l+e.y;return[c,u,f,d,(c+f)/2,(u+d)/2]}return[e.x,e.y,e.x+e.width,e.y+e.height,e.x+e.width/2,e.y+e.height/2]},x=function(e,t){return Math.abs(e-t)},v=0,m=function(){return"id".concat(v++)},p=function(e){var t=e.fontSize,n=e.fontFamily;return"".concat(t,"px ").concat(n,", Segoe UI Emoji")}},6818:function(e,t,n){e.exports=n.p+"static/media/\u70b9\u7a00\u91ca.31d6cfe0d16ae931b73c.md"}}]);
//# sourceMappingURL=CreateText.57ff0e44.chunk.js.map