"use strict";(self.webpackChunkexcalidraw_app=self.webpackChunkexcalidraw_app||[]).push([[804],{8079:function(e,t,n){n.r(t),n.d(t,{default:function(){return f},elements:function(){return s}});var o=n(1413),i=n(2791),r=function(e,t){var n=e.getContext("2d");n.clearRect(0,0,e.width,e.height),function(e,t){var n=t.scrollX,o=t.scrollY;e.save();var i=100,r=100,l=e.canvas;e.translate(n,o),e.strokeStyle="red",e.fillStyle="red",e.save(),e.beginPath(),e.setLineDash([10,10]),e.moveTo(0,-o),e.lineTo(0,l.height-o),e.moveTo(-n,0),e.lineTo(l.width-n,0),e.stroke(),e.restore(),e.beginPath(),e.lineWidth=2,e.textBaseline="middle";for(var a=0;a<o/i;a++)e.moveTo(0,-a*i),e.lineTo(8,-a*i),e.font="20px Arial",e.fillText(-a,-25,-a*i);for(var s=0;s<(l.height-o)/i;s++)e.moveTo(0,s*i),e.lineTo(8,s*i),e.font="20px Arial",e.fillText(s,-25,s*i);for(var c=1;c<n/r;c++)e.moveTo(-c*r,0),e.lineTo(-c*r,8),e.font="20px Arial",e.fillText(-c,-c*r-10,-15);for(var f=1;f<(l.width-n)/r;f++)e.moveTo(f*r,0),e.lineTo(f*r,8),e.font="20px Arial",e.fillText(f,f*r-5,-15);e.stroke(),e.restore()}(n,t),function(e,t){s.forEach((function(n){e.save(),e.translate(n.x+t.scrollX,n.y+t.scrollY),e.strokeStyle=n.strokeStyle,e.strokeColor=n.strokeColor,e.strokeRect(0,0,n.width,n.height),e.restore()}))}(n,t)},l=n(184),a={offsetLeft:0,offsetTop:0,scrollX:0,scrollY:0,draggingElement:null},s=[],c=function(e,t){var n=e.clientX,o=e.clientY,i=t.offsetLeft,r=t.offsetTop;return{x:n-i-t.scrollX,y:o-r-t.scrollY}},f=(0,i.memo)((function(){var e=(0,i.useRef)(null),t=(0,i.useRef)(null);(0,i.useEffect)((function(){var t=function(){var t=e.current,n=t.getContext("2d"),o=t.offsetWidth,i=t.offsetHeight,l=t.offsetLeft,s=t.offsetTop;t.width=o*window.devicePixelRatio,t.height=i*window.devicePixelRatio,n.scale(window.devicePixelRatio,window.devicePixelRatio),a.offsetLeft=l,a.offsetTop=s,r(t,a)};t();var n=function(){t()};return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}}),[]),(0,i.useEffect)((function(){var e=t.current,n=function(e){e.preventDefault()};return e.addEventListener("wheel",n,{passive:!1}),function(){e.removeEventListener("wheel",n)}}),[]);var n=function(e){return function(t){window.removeEventListener("pointermove",e.eventListeners.onMove),window.removeEventListener("pointerup",e.eventListeners.onUp)}},f=function(t){return function(n){var o=c(n,a);t.lastCoords.x=o.x,t.lastCoords.y=o.y,a.draggingElement.width=o.x-t.origin.x,a.draggingElement.height=o.y-t.origin.y,r(e.current,a)}};return(0,l.jsxs)("div",{className:"infinite-canvas",children:[(0,l.jsx)("div",{ref:t,children:(0,l.jsx)("canvas",{ref:e,className:"canvas",onPointerDown:function(e){var t=c(e,a);console.log("origin...",a,t);var i={origin:t,lastCoords:(0,o.Z)({},t),eventListeners:{onMove:null,onUp:null}},r={x:i.origin.x,y:i.origin.y,width:0,height:0,strokeColor:"#000000",backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid"};a.draggingElement=r,s.push(r);var l=f(i),d=n(i);window.addEventListener("pointermove",l),window.addEventListener("pointerup",d),i.eventListeners.onMove=l,i.eventListeners.onUp=d},onWheel:function(t){var n=t.deltaX,o=t.deltaY;a.scrollX=a.scrollX-n,a.scrollY=a.scrollY-o,console.log("\u6eda\u52a8\u8ddd\u79bb\uff0cX\uff1a".concat(a.scrollX,", Y\uff1a").concat(a.scrollY)),r(e.current,a)},children:"\u7ed8\u5236canvas"})}),(0,l.jsx)("div",{children:(0,l.jsx)("button",{onClick:function(){var e=1/0,t=-1/0,n=1/0,i=-1/0;s.forEach((function(o){var r=[o.x,o.y,o.x+o.width,o.y+o.height],l=r[0],a=r[1],s=r[2],c=r[3];e=Math.min(e,l),n=Math.min(n,a),t=Math.max(t,s),i=Math.max(i,c)}));var l=document.createElement("canvas");l.width=(t-e+20)*window.devicePixelRatio,l.height=(i-n+20)*window.devicePixelRatio,l.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio),r(l,(0,o.Z)((0,o.Z)({},a),{},{scrollX:10-e,scrollY:10-n})),console.log("\u5bfc\u51fa",s);var c=document.createElement("a");c.href=l.toDataURL(),c.download="canvas.png",c.click()},children:"\u5bfc\u51faPNG"})})]})}))}}]);
//# sourceMappingURL=Scale.4c15ce5d.chunk.js.map