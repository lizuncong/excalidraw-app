"use strict";(self.webpackChunkexcalidraw_app=self.webpackChunkexcalidraw_app||[]).push([[343],{8009:function(e,t,n){n.r(t),n.d(t,{default:function(){return X}});var o=n(1413),r=n(3433),i=n(9439),l=n(2791),a=function(e,t){var n=e.clientX,o=e.clientY,r=t.offsetLeft,i=t.offsetTop;return{x:n-r-t.scrollX,y:o-i-t.scrollY}},s=function(e,t){return Math.abs(e-t)},c=0,d=n(84),u=function(e){var t=e.type,n=e.x,o=e.y,r=e.strokeColor,i=e.backgroundColor,l=e.fillStyle,a=e.strokeWidth,s=e.strokeStyle,d=e.width,u=void 0===d?0:d,f=e.height,v=void 0===f?0:f,h=e.points,g=void 0===h?[]:h;return{id:"id".concat(c++),type:t,x:n,y:o,width:u,height:v,strokeColor:r,backgroundColor:i,fillStyle:l,strokeWidth:a,strokeStyle:s,isDeleted:!1,points:g}},f=new WeakMap,v=function(e){f.delete(e)},h=function(e,t){var n=t.zoom||1,o=f.get(e);if(o)return console.log("\u590d\u7528\u4e4b\u524d\u7684canvas========================"),o;var r=m(e,n,t);return f.set(e,r),r},g=document.getElementById("placeholder"),p=null,m=function(e,t,n){var r=document.createElement("canvas"),l=r.getContext("2d"),a=y(e);g||(g=document.getElementById("placeholder")),p&&g.removeChild(p),p=r,g.appendChild(p);if("freedraw"===e.type){var s,c,u=(0,d.qf)((0,o.Z)((0,o.Z)({},e),{},{points:e.points.map((function(t){return[t[0]-e.x,t[1]-e.y]}))})),f=(0,i.Z)(u,4),v=f[0],h=f[1],m=f[2],x=f[3];r.width=(0,d.TE)(v,m)*window.devicePixelRatio+40,r.height=(0,d.TE)(h,x)*window.devicePixelRatio+40,s=e.x>v?(0,d.TE)(e.x,v)*window.devicePixelRatio:0,c=e.y>h?(0,d.TE)(e.y,h)*window.devicePixelRatio:0,l.translate(s,c)}else r.width=e.width*window.devicePixelRatio*t+a*t*2,r.height=e.height*window.devicePixelRatio*t+a*t*2;return l.save(),l.translate(a*t,a*t),l.scale(window.devicePixelRatio*t,window.devicePixelRatio*t),w(e,l,n),l.restore(),{element:e,canvas:r,theme:n.theme,canvasZoom:t,canvasOffsetX:0,canvasOffsetY:0}},w=function(e,t,n){switch(t.globalAlpha=e.opacity/100,e.type){case"rectangle":t.lineJoin="round",t.lineCap="round",t.strokeStyle=e.strokeStyle,t.strokeRect(0,0,e.width,e.height);break;case"freedraw":t.save(),t.lineWidth=3,t.strokeStyle=e.strokeStyle,e.points.forEach((function(n,o){var r=(0,i.Z)(n,2),l=r[0],a=r[1];l-=e.x,a-=e.y,o?t.lineTo(l,a):t.moveTo(l,a)})),t.stroke(),t.restore()}t.globalAlpha=1},y=function(e){return"freedraw"===e.type?12*e.strokeWidth:20},x=function(e,t,n){var o=e.element,r=y(o),l=(0,d.qf)(o),a=(0,i.Z)(l,4),s=a[0],c=a[1],u=a[2],f=a[3];console.log("eleement-====",e.canvas);var v=((s+u)/2+n.scrollX)*window.devicePixelRatio,h=((c+f)/2+n.scrollY)*window.devicePixelRatio;console.log("cx...",v,h),t.save(),t.scale(1/window.devicePixelRatio,1/window.devicePixelRatio),t.translate(v,h),t.drawImage(e.canvas,-(u-s)/2*window.devicePixelRatio-r*e.canvasZoom/e.canvasZoom,-(f-c)/2*window.devicePixelRatio-r*e.canvasZoom/e.canvasZoom,e.canvas.width/e.canvasZoom,e.canvas.height/e.canvasZoom),t.restore()},k=function(e){var t=e.elements,n=e.appState,o=e.scale,r=e.canvas,i=e.renderConfig,l=r.getContext("2d");l.save(),l.scale(o,o);var a=r.width/o,s=r.height/o;l.clearRect(0,0,a,s),l.save(),l.scale(i.zoom,i.zoom),function(e,t){var n=t.scrollX,o=t.scrollY;e.save();var r=100,i=100,l=e.canvas;e.strokeStyle="red",e.fillStyle="red",e.beginPath(),e.lineWidth=2,e.textBaseline="middle",e.save(),e.translate(0,o);for(var a=0;a<o/r;a++)e.moveTo(0,-a*r),e.lineTo(8,-a*r),e.font="10px Arial",e.fillText(-a,0,-a*r+10);for(var s=1;s<(l.height-o)/r;s++)e.moveTo(0,s*r),e.lineTo(8,s*r),e.font="10px Arial",e.fillText(s,0,s*r+10);e.restore(),e.save(),e.translate(n,0);for(var c=0;c<n/i;c++)e.moveTo(-c*i,0),e.lineTo(-c*i,8),e.font="10px Arial",e.fillText(-c,-c*i+5,5);for(var d=1;d<(l.width-n)/i;d++)e.moveTo(d*i,0),e.lineTo(d*i,8),e.font="10px Arial",e.fillText(d,d*i+5,5);e.restore(),e.stroke(),e.restore()}(l,i),t.forEach((function(e){!function(e,t,n,o){var r=h(e,n);x(r,t,n)}(e,l,i)})),l.restore(),l.restore(),localStorage.setItem("elements",JSON.stringify(t)),localStorage.setItem("appState",JSON.stringify(n))},C={tools:"index_tools__ZQUTr",item:"index_item__JCc41",selected:"index_selected__uL6n6"},S=n(4925),E=n(184),Z=["width","height","mirror","style"],T=function(e,t){var n="number"===typeof t?{width:t}:t,r=n.width,i=void 0===r?512:r,l=n.height,a=void 0===l?i:l,s=(n.mirror,n.style),c=(0,S.Z)(n,Z);return(0,E.jsx)("svg",(0,o.Z)((0,o.Z)({"aria-hidden":"true",focusable:"false",role:"img",viewBox:"0 0 ".concat(i," ").concat(a),style:s},c),{},{children:"string"===typeof e?(0,E.jsx)("path",{fill:"currentColor",d:e}):e}))},M=[{type:"rectangle",icon:T((0,E.jsxs)("g",{strokeWidth:"1.5",children:[(0,E.jsx)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),(0,E.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"})]}),{width:24,height:24,fill:"none",strokeWidth:2,stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})},{type:"freedraw",icon:T((0,E.jsxs)("g",{strokeWidth:"1.25",children:[(0,E.jsx)("path",{clipRule:"evenodd",d:"m7.643 15.69 7.774-7.773a2.357 2.357 0 1 0-3.334-3.334L4.31 12.357a3.333 3.333 0 0 0-.977 2.357v1.953h1.953c.884 0 1.732-.352 2.357-.977Z"}),(0,E.jsx)("path",{d:"m11.25 5.417 3.333 3.333"})]}),{width:20,height:20,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})}],R=(0,l.memo)((function(e){var t=e.activeTool,n=e.onActiveToolChange;return(0,E.jsx)("div",{className:C.tools,children:M.map((function(e){return(0,E.jsx)("span",{className:[C.item,t.type===e.type&&C.selected].join(" "),onClick:function(){return n({type:e.type})},children:e.icon},e.type)}))})})),P=n(5671),b=n(3144),I=new(function(){function e(){(0,P.Z)(this,e);var t=JSON.parse(localStorage.getItem("elements"));this.elements=t||[]}return(0,b.Z)(e,[{key:"getElementsIncludingDeleted",value:function(){return this.elements}},{key:"replaceAllElements",value:function(e){this.elements=e}}]),e}()),L=JSON.parse(localStorage.getItem("appState"))||{scrollX:0,scrollY:0,offsetLeft:0,offsetTop:0,draggingElement:null},j=(0,l.memo)((function(){var e=(0,l.useRef)(null),t=(0,l.useRef)(null),n=(0,l.useRef)(null),c=(0,l.useState)({type:""}),f=(0,i.Z)(c,2),h=f[0],g=f[1];(0,l.useEffect)((function(){var t=function(e){e.width=r*window.devicePixelRatio,e.height=i*window.devicePixelRatio},o=e.current,r=o.offsetWidth,i=o.offsetHeight;t(o),t(n.current);var l=o.getBoundingClientRect(),a=l.x,s=l.y;L.offsetLeft=a,L.offsetTop=s,k({elements:I.getElementsIncludingDeleted(),appState:L,scale:window.devicePixelRatio,canvas:n.current,renderConfig:{selectionColor:"#6965db",scrollX:L.scrollX,scrollY:L.scrollY,viewBackgroundColor:"#ffffff",zoom:1}})}),[]),(0,l.useEffect)((function(){var e=t.current,n=function(e){e.preventDefault()};return e.addEventListener("wheel",n,{passive:!1}),function(){e.removeEventListener("wheel",n)}}),[]);var p=function(t){return(0,d.$9)((function(n){var o=a(n,L);if(t.lastCoords.x=o.x,t.lastCoords.y=o.y,"freedraw"===h.type)console.log("fredda=====",L.draggingElement),L.draggingElement.points.push([o.x,o.y]);else{var r=t.lastCoords,i=t.origin.x,l=t.origin.y,c=r.x,d=r.y,u=s(t.origin.x,r.x),f=s(t.origin.y,r.y),g=c<i?i-u:i,p=d<l?l-f:l;L.draggingElement.x=g,L.draggingElement.y=p,L.draggingElement.width=u,L.draggingElement.height=f}v(L.draggingElement),k({elements:[L.draggingElement],appState:L,scale:window.devicePixelRatio,canvas:e.current,renderConfig:{selectionColor:"#6965db",scrollX:L.scrollX,scrollY:L.scrollY,viewBackgroundColor:"#ffffff",zoom:1}})}))},m=function(t){return function(o){I.replaceAllElements([].concat((0,r.Z)(I.getElementsIncludingDeleted()),[L.draggingElement])),console.log("pointer up appState...",L);var i=e.current;i.getContext("2d").clearRect(0,0,i.width,i.height),k({elements:I.getElementsIncludingDeleted(),appState:L,scale:window.devicePixelRatio,canvas:n.current,renderConfig:{selectionColor:"#6965db",scrollX:L.scrollX,scrollY:L.scrollY,viewBackgroundColor:"#ffffff",zoom:1}}),window.removeEventListener("pointermove",t.eventListeners.onMove),window.removeEventListener("pointerup",t.eventListeners.onUp)}},w=function(e){var t=a(e,L);return{origin:t,lastCoords:(0,o.Z)({},t),eventListeners:{onMove:null,onUp:null,onKeyUp:null,onKeyDown:null}}};return(0,E.jsxs)("div",{ref:t,children:[(0,E.jsxs)("div",{className:"container wrap",children:[(0,E.jsx)("canvas",{ref:n,className:"canvas",children:"\u9759\u6001canvas"}),(0,E.jsx)("canvas",{ref:e,className:"canvas draw",onWheel:function(e){var t=e.deltaX,o=e.deltaY;L.scrollX=L.scrollX-t,L.scrollY=L.scrollY-o,k({elements:I.getElementsIncludingDeleted(),appState:L,scale:window.devicePixelRatio,canvas:n.current,renderConfig:{selectionColor:"#6965db",scrollX:L.scrollX,scrollY:L.scrollY,viewBackgroundColor:"#ffffff",zoom:1}})},onPointerDown:function(e){if(h.type){var t=w(e),n=function(e){var t=e.elementType,n=e.pointerDownState,o=e.appState;return u("freedraw"===t?{type:t,x:n.origin.x,y:n.origin.y,points:[[n.origin.x,n.origin.y]],strokeColor:o.currentItemStrokeColor,backgroundColor:o.currentItemBackgroundColor,fillStyle:o.currentItemFillStyle,strokeWidth:o.currentItemStrokeWidth,strokeStyle:(0,d.B8)()}:{type:t,x:n.origin.x,y:n.origin.y,strokeColor:o.currentItemStrokeColor,backgroundColor:o.currentItemBackgroundColor,fillStyle:o.currentItemFillStyle,strokeWidth:o.currentItemStrokeWidth,strokeStyle:(0,d.B8)()})}({elementType:h.type,pointerDownState:t,appState:L});L.draggingElement=n,v(n);var o=p(t),r=m(t);window.addEventListener("pointermove",o),window.addEventListener("pointerup",r),t.eventListeners.onMove=o,t.eventListeners.onUp=r}},children:"\u52a8\u6001canvas"}),(0,E.jsx)(R,{activeTool:h,onActiveToolChange:function(e){g(e)}})]}),(0,E.jsx)("div",{id:"placeholder"})]})})),X=j},84:function(e,t,n){n.d(t,{$9:function(){return c},B8:function(){return s},TE:function(){return u},dE:function(){return a},qf:function(){return d}});var o=n(9439),r=n(7762),i=n(3433),l=n(4164),a=function(e,t){var n=e.clientX,o=e.clientY,r=t.offsetLeft,i=t.offsetTop;return{x:n-r-t.scrollX,y:o-i-t.scrollY}},s=function(){var e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),n=Math.floor(256*Math.random());return"rgb(".concat(e,",").concat(t,",").concat(n,")")},c=function(e){return function(e,t){var n=null,o=null,r=null,l=function t(l){n=window.requestAnimationFrame((function(){n=null,e.apply(void 0,(0,i.Z)(l)),o=null,r&&(o=r,r=null,t(o))}))},a=function(){for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];o=i,null===n?l(o):null!==t&&void 0!==t&&t.trailing&&(r=i)};return a.flush=function(){null!==n&&(cancelAnimationFrame(n),n=null),o&&(e.apply(void 0,(0,i.Z)(r||o)),o=r=null)},a.cancel=function(){o=r=null,null!==n&&(cancelAnimationFrame(n),n=null)},a}((function(t){(0,l.unstable_batchedUpdates)(e,t)}))},d=function(e){if("freedraw"===e.type){var t=function(e){var t,n=1/0,i=1/0,l=-1/0,a=-1/0,s=(0,r.Z)(e);try{for(s.s();!(t=s.n()).done;){var c=(0,o.Z)(t.value,2),d=c[0],u=c[1];n=Math.min(n,d),i=Math.min(i,u),l=Math.max(l,d),a=Math.max(a,u)}}catch(f){s.e(f)}finally{s.f()}return[n,i,l,a]}(e.points),n=(0,o.Z)(t,4),i=n[0],l=n[1],a=n[2],s=n[3],c=i+e.x,d=l+e.y,u=a+e.x,f=s+e.y;return[c,d,u,f,(c+u)/2,(d+f)/2]}return[e.x,e.y,e.x+e.width,e.y+e.height,e.x+e.width/2,e.y+e.height/2]},u=function(e,t){return Math.abs(e-t)},f=0;window.__generateExcalidrawElements=function(){return(JSON.parse(localStorage.getItem("free-draw-elements"))||[]).map((function(e){var t=e.points.map((function(t){return[t[0]-e.x,t[1]-e.y]})),n=function(e){var t=e.map((function(e){return e[0]})),n=e.map((function(e){return e[1]}));return{width:Math.max.apply(Math,(0,i.Z)(t))-Math.min.apply(Math,(0,i.Z)(t)),height:Math.max.apply(Math,(0,i.Z)(n))-Math.min.apply(Math,(0,i.Z)(n))}}(t),o=n.width,r=n.height;return{id:"id".concat(f++),type:"freedraw",x:e.x,y:e.y,width:o,height:r,angle:0,strokeColor:e.strokeStyle,backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid",roughness:1,opacity:100,groupIds:[],roundness:null,seed:Math.floor(Math.random()*Math.pow(2,31)),version:1,versionNonce:0,isDeleted:!1,boundElements:null,updated:Date.now(),link:null,locked:!1,points:t,pressures:[],simulatePressure:!0,lastCommittedPoint:t[t.length-1]}}))}}}]);
//# sourceMappingURL=Canvas.ba9ee9f0.chunk.js.map