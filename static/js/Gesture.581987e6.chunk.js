"use strict";(this.webpackChunkexcalidraw_app=this.webpackChunkexcalidraw_app||[]).push([[408],{9851:function(e,t,n){n.r(t),n.d(t,{default:function(){return w},elements:function(){return m}});var o=n(1413),r=n(4519),i=function(e,t){var n=e.getContext("2d");n.clearRect(0,0,e.width,e.height),function(e,t){var n=t.zoom,o=t.scrollX,r=t.scrollY;e.save();var i=100*n.value,l=100*n.value,a=8*n.value,s=e.canvas,c=o*n.value,u=r*n.value;e.translate(c,u),e.strokeStyle="red",e.fillStyle="red",e.save(),e.beginPath(),e.setLineDash([10,10]),e.moveTo(0,-u),e.lineTo(0,s.height-u),e.moveTo(-c,0),e.lineTo(s.width-c,0),e.stroke(),e.restore(),e.beginPath(),e.lineWidth=2,e.textBaseline="middle";for(var v=0;v<u/i;v++)e.moveTo(0,-v*i),e.lineTo(a,-v*i),e.font="".concat(20*n.value,"px Arial"),e.fillText(-v,-25,-v*i);for(var f=0;f<(s.height-u)/i;f++)e.moveTo(0,f*i),e.lineTo(a,f*i),e.font="".concat(20*n.value,"px Arial"),e.fillText(f,-25,f*i);for(var d=1;d<c/l;d++)e.moveTo(-d*l,0),e.lineTo(-d*l,a),e.font="".concat(20*n.value,"px Arial"),e.fillText(-d,-d*l-10,-15);for(var h=1;h<(s.width-c)/l;h++)e.moveTo(h*l,0),e.lineTo(h*l,a),e.font="".concat(20*n.value,"px Arial"),e.fillText(h,h*l-5,-15);e.stroke(),e.restore()}(n,t),function(e,t){m.forEach((function(n){e.save(),e.scale(t.zoom.value,t.zoom.value),e.translate(n.x+t.scrollX,n.y+t.scrollY),e.strokeStyle=n.strokeStyle,e.strokeColor=n.strokeColor,e.strokeRect(0,0,n.width,n.height),e.restore()}))}(n,t)},l=n(9439),a=function(e){var t=Array.from(e.values());return{x:c(t,(function(e){return e.x}))/t.length,y:c(t,(function(e){return e.y}))/t.length}},s=function(e){var t=(0,l.Z)(e,2),n=t[0],o=t[1];return Math.hypot(n.x-o.x,n.y-o.y)},c=function(e,t){return e.reduce((function(e,n){return e+t(n)}),0)},u=n(4975),v={pointers:new Map,lastCenter:null,initialDistance:null,initialScale:null},f=function(e,t){(0,r.useEffect)((function(){var t=e.current,n=function(e){e.touches.length||v.pointers.clear()};return t.addEventListener("touchend",n),function(){t.removeEventListener("touchend",n)}}),[e]);return{gesture:v,removePointer:function(e){v.pointers.delete(e.pointerId)},updateGestureOnPointerDown:function(e){v.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),2===v.pointers.size&&(v.lastCenter=a(v.pointers),v.initialScale=t.zoom.value,v.initialDistance=s(Array.from(v.pointers.values())))},handleCanvasPointerMove:function(e,n){v.pointers.has(e.pointerId)&&v.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY});var o=v.initialScale;if(2===v.pointers.size&&v.lastCenter&&o&&v.initialDistance){var r=a(v.pointers),i=r.x-v.lastCenter.x,l=r.y-v.lastCenter.y;v.lastCenter=r;var c=s(Array.from(v.pointers.values()))/v.initialDistance,f=c?(0,u.j)(o*c):t.zoom.value,d=(0,u.E)({viewportX:r.x,viewportY:r.y,nextZoom:f},t);Object.assign(t,{zoom:d.zoom,scrollX:d.scrollX+i/f,scrollY:d.scrollY+l/f}),n()}else v.lastCenter=v.initialDistance=v.initialScale=null}}},d=n(2556),h={zoom:{value:1},offsetLeft:0,offsetTop:0,scrollX:0,scrollY:0,draggingElement:null},m=[],p=function(e,t){var n=e.clientX,o=e.clientY,r=t.zoom,i=t.offsetLeft,l=t.offsetTop,a=t.scrollX,s=t.scrollY;return{x:(n-i)/r.value-a,y:(o-l)/r.value-s}},x=(0,r.memo)((function(){var e=(0,r.useRef)(null),t=(0,r.useRef)(null),n=(0,r.useRef)({}),l=(0,r.useRef)();(0,r.useEffect)((function(){var t=function(){var t=e.current,n=t.getContext("2d"),o=t.offsetWidth,r=t.offsetHeight,l=t.offsetLeft,a=t.offsetTop;t.width=o*window.devicePixelRatio,t.height=r*window.devicePixelRatio,n.scale(window.devicePixelRatio,window.devicePixelRatio),h.offsetLeft=l,h.offsetTop=a,i(t,h)};t();var n=function(){t()};return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}}),[]),(0,r.useEffect)((function(){var e=t.current,o=function(e){e.preventDefault()};e.addEventListener("wheel",o,{passive:!1});var r=function(e){n.current={cursorX:e.clientX,cursorY:e.clientY}};return document.addEventListener("mousemove",r),function(){e.removeEventListener("wheel",o),document.removeEventListener("mousemove",r)}}),[]);var a=f(e,h),s=a.updateGestureOnPointerDown,c=a.handleCanvasPointerMove,u=a.removePointer,v=a.gesture,x=function(e){return function(t){console.log("pointer up..",t.pointerId),u(t),window.removeEventListener("pointermove",e.eventListeners.onMove),window.removeEventListener("pointerup",e.eventListeners.onUp)}},w=function(t){return function(n){var o=p(n,h);t.lastCoords.x=o.x,t.lastCoords.y=o.y,h.draggingElement.width=o.x-t.origin.x,h.draggingElement.height=o.y-t.origin.y,i(e.current,h)}};return(0,d.jsxs)("div",{className:"gesture",children:[(0,d.jsx)("div",{ref:t,children:(0,d.jsx)("canvas",{ref:e,className:"canvas",onPointerDown:function(e){if(s(e),console.log("pointer down...",v.pointers),!(v.pointers.size>1)){var t=p(e,h);console.log("origin...",h,t);var n={origin:t,lastCoords:(0,o.Z)({},t),eventListeners:{onMove:null,onUp:null}},r={x:n.origin.x,y:n.origin.y,width:0,height:0,strokeColor:"#000000",backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid"};h.draggingElement=r,m.push(r);var i=w(n),l=x(n);window.addEventListener("pointermove",i),window.addEventListener("pointerup",l),n.eventListeners.onMove=i,n.eventListeners.onUp=l}},onPointerCancel:u,onPointerMove:function(t){console.log("pointer move===="),c(t,(function(){console.log("move....."),i(e.current,h)}))},onWheel:function(t){var r=t.deltaX,a=t.deltaY;if(t.metaKey||t.ctrlKey){var s=Math.sign(a),c=Math.abs(a),u=a;c>10&&(u=10*s);var v=h.zoom.value-u/100,f=function(e){return Math.max(.1,Math.min(e,30))}(v+=Math.log10(Math.max(1,h.zoom.value))*-s*Math.min(1,c/20));return Object.assign(h,(0,o.Z)({},function(e,t){var n=e.viewportX,o=e.viewportY,r=e.nextZoom,i=n-t.offsetLeft,l=o-t.offsetTop,a=t.zoom.value;return{scrollX:t.scrollX+i/r-i/a,scrollY:t.scrollY+l/r-l/a,zoom:{value:r}}}({viewportX:n.current.cursorX,viewportY:n.current.cursorY,nextZoom:f},h))),l.current.innerText="".concat((100*f).toFixed(0),"%"),void i(e.current,h)}h.scrollX=h.scrollX-r/h.zoom.value,h.scrollY=h.scrollY-a/h.zoom.value,i(e.current,h)},children:"\u7ed8\u5236canvas"})}),(0,d.jsx)("div",{children:(0,d.jsx)("button",{onClick:function(){var e=1/0,t=-1/0,n=1/0,r=-1/0;m.forEach((function(o){var i=[o.x,o.y,o.x+o.width,o.y+o.height],l=i[0],a=i[1],s=i[2],c=i[3];e=Math.min(e,l),n=Math.min(n,a),t=Math.max(t,s),r=Math.max(r,c)}));var l=document.createElement("canvas");l.width=(t-e+20)*window.devicePixelRatio,l.height=(r-n+20)*window.devicePixelRatio,l.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio),i(l,(0,o.Z)((0,o.Z)({},h),{},{scrollX:10-e,scrollY:10-n})),console.log("\u5bfc\u51fa",m);var a=document.createElement("a");a.href=l.toDataURL(),a.download="canvas.png",a.click()},children:"\u5bfc\u51faPNG"})}),(0,d.jsx)("div",{ref:l})]})})),w=x},4975:function(e,t,n){n.d(t,{E:function(){return r},j:function(){return o}});var o=function(e){return Math.max(.1,Math.min(e,30))},r=function(e,t){var n=e.viewportX,o=e.viewportY,r=e.nextZoom,i=n-t.offsetLeft,l=o-t.offsetTop,a=t.zoom.value;return{scrollX:t.scrollX+i/r-i/a,scrollY:t.scrollY+l/r-l/a,zoom:{value:r}}}}}]);
//# sourceMappingURL=Gesture.581987e6.chunk.js.map