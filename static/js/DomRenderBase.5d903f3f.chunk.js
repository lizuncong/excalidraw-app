"use strict";(this.webpackChunkexcalidraw_app=this.webpackChunkexcalidraw_app||[]).push([[216],{4959:function(e,t,n){n.r(t),n.d(t,{appState:function(){return G},default:function(){return Q}});var o,r=n(3433),i=n(1413),l=n(9439),a=n(4519),c=n(5204),s=n(4975),u=n(4925),d=["type","x","y","strokeColor","backgroundColor","fillStyle","strokeWidth","strokeStyle","width","height","angle","points"],f=function(e){var t=e.type,n=e.x,o=e.y,r=e.strokeColor,l=e.backgroundColor,a=e.fillStyle,s=e.strokeWidth,f=void 0===s?3:s,h=e.strokeStyle,v=e.width,g=void 0===v?0:v,p=e.height,m=void 0===p?0:p,x=e.angle,y=void 0===x?0:x,w=e.points,C=void 0===w?[]:w,k=(0,u.Z)(e,d);return(0,i.Z)({id:(0,c.kb)(),type:t,x:n,y:o,width:g,height:m,strokeColor:r,backgroundColor:l,fillStyle:a,strokeWidth:f,strokeStyle:h,angle:y,isDeleted:!1,points:C},k)},h=function(e){var t=e.elementType,n=e.pointerDownState,o=e.appState;return f("freedraw"===t?{type:t,x:n.origin.x,y:n.origin.y,points:[[n.origin.x,n.origin.y]],strokeColor:o.currentItemStrokeColor,backgroundColor:o.currentItemBackgroundColor,fillStyle:o.currentItemFillStyle,strokeWidth:o.currentItemStrokeWidth,strokeStyle:(0,c.B8)()}:{type:t,x:n.origin.x,y:n.origin.y,strokeColor:o.currentItemStrokeColor,backgroundColor:o.currentItemBackgroundColor,fillStyle:o.currentItemFillStyle,strokeWidth:o.currentItemStrokeWidth,strokeStyle:(0,c.B8)()})},v=function(e){return f((0,i.Z)({type:"text",text:e.text,fontSize:e.fontSize,fontFamily:e.fontFamily,textAlign:e.textAlign,verticalAlign:e.verticalAlign,originalText:e.text},e))},g=function(e,t){return Number((Math.random()*(t-e)+e).toFixed(5))},p=function(e,t,n){for(var o,r=[],i=0;i<e;i++){var l=g(-n.scrollX,n.canvasWidth-n.scrollX),a=g(-n.scrollY,n.canvasHeight-n.scrollY);if(o=h({elementType:t,pointerDownState:{origin:{x:l,y:a}},appState:n}),"rectangle"===t){var s=Math.abs(g(-n.scrollX-l,n.canvasWidth-n.scrollX-l))+2,u=Math.abs(g(-n.scrollY-a,n.canvasHeight-n.scrollY-a))+2;o.width=s,o.height=u}else if("freedraw"===t)for(var d=g(20,100),f=0;f<d;f++)l=g(l,l+10),a=g(a,a+10),o.points.push([l,a]);else if("text"===t){var p="".concat(l,", ").concat(a);o=v({x:l,y:a,strokeColor:(0,c.B8)(),backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid",text:p,width:20*p.length,height:25,fontSize:20,fontFamily:"Virgil",textAlign:"left",verticalAlign:"top"})}r.push(o)}return r},m=n(2556),x=n(9402),y=function(e){var t=e.elements,n=e.appState,r=(e.scale,e.svg);e.renderConfig;o||(o=x.createRoot(r));r.setAttribute("style","\n    transform: translateX(".concat(n.scrollX*n.zoom.value,"px) translateY(").concat(n.scrollY*n.zoom.value,"px) scale(").concat(n.zoom.value,");\n    width: ").concat(30,"px;\n    height: ").concat(30,"px;\n    transform-origin: left top;\n  ")),console.log("\u5f00\u59cb\u6e32\u67d3\u3002\u3002\u3002",t);var i=t.map((function(e,t){return function(e,t,n){var o;switch(e.type){case"rectangle":o=(0,m.jsx)("svg",{id:e.id,width:e.width+2*e.strokeWidth,height:e.height+2*e.strokeWidth,style:{position:"absolute",left:"".concat(e.x,"px"),top:"".concat(e.y,"px")},xmlns:"http://www.w3.org/2000/svg",version:"1.1",children:(0,m.jsx)("rect",{x:Math.ceil(e.strokeWidth/2),y:Math.ceil(e.strokeWidth/2),width:e.width,height:e.height,style:{fill:"none",strokeWidth:e.strokeWidth,stroke:e.strokeStyle}})},e.id);break;case"freedraw":var r=(0,c.qf)(e),i=(0,l.Z)(r,4),a=i[0],s=i[1],u=i[2],d=i[3],f=(0,c.TE)(a,u),h=(0,c.TE)(s,d),v=e.points.map((function(t){return[t[0]-a+Math.ceil(e.strokeWidth/2),t[1]-s+Math.ceil(e.strokeWidth/2)]}));o=(0,m.jsx)("svg",{id:e.id,width:f+2*e.strokeWidth,height:h+2*e.strokeWidth,style:{position:"absolute",left:"".concat(a,"px"),top:"".concat(s,"px")},xmlns:"http://www.w3.org/2000/svg",version:"1.1",children:(0,m.jsx)("polyline",{points:v.join(" "),style:{fill:"none",strokeWidth:e.strokeWidth,stroke:e.strokeStyle}})},e.id)}return o}(e)}));console.log("\u6e32\u67d3\u540e\u3002\u3002\u3002",i),o.render(i)},w=n(5909),C={pointers:new Map,lastCenter:null,initialDistance:null,initialScale:null},k=function(e,t){(0,a.useEffect)((function(){var t=e.current,n=function(e){e.touches.length||C.pointers.clear()};return t.addEventListener("touchend",n),function(){t.removeEventListener("touchend",n)}}),[e]);return{gesture:C,removePointer:function(e){C.pointers.delete(e.pointerId)},updateGestureOnPointerDown:function(e){C.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),2===C.pointers.size&&(C.lastCenter=(0,w.q)(C.pointers),C.initialScale=t.zoom.value,C.initialDistance=(0,w.S)(Array.from(C.pointers.values())))},handleCanvasPointerMove:function(e,n){C.pointers.has(e.pointerId)&&C.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY});var o=C.initialScale;if(2===C.pointers.size&&C.lastCenter&&o&&C.initialDistance){var r=(0,w.q)(C.pointers),i=r.x-C.lastCenter.x,l=r.y-C.lastCenter.y;C.lastCenter=r;var a=(0,w.S)(Array.from(C.pointers.values()))/C.initialDistance,c=a?(0,s.j)(o*a):t.zoom.value,u=(0,s.E)({viewportX:r.x,viewportY:r.y,nextZoom:c},t);Object.assign(t,{zoom:u.zoom,scrollX:u.scrollX+i/c,scrollY:u.scrollY+l/c}),n()}else C.lastCenter=C.initialDistance=C.initialScale=null}}},S={tools:"index_tools__0zLhr",item:"index_item__a+4UR",selected:"index_selected__yHucW"},j=["width","height","mirror","style"],E=function(e,t){var n="number"===typeof t?{width:t}:t,o=n.width,r=void 0===o?512:o,l=n.height,a=void 0===l?r:l,c=(n.mirror,n.style),s=(0,u.Z)(n,j);return(0,m.jsx)("svg",(0,i.Z)((0,i.Z)({"aria-hidden":"true",focusable:"false",role:"img",viewBox:"0 0 ".concat(r," ").concat(a),style:c},s),{},{children:"string"===typeof e?(0,m.jsx)("path",{fill:"currentColor",d:e}):e}))},z=E((0,m.jsxs)("g",{strokeWidth:"1.5",children:[(0,m.jsx)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),(0,m.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"})]}),{width:24,height:24,fill:"none",strokeWidth:2,stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),M=E((0,m.jsxs)("g",{strokeWidth:"1.25",children:[(0,m.jsx)("path",{clipRule:"evenodd",d:"m7.643 15.69 7.774-7.773a2.357 2.357 0 1 0-3.334-3.334L4.31 12.357a3.333 3.333 0 0 0-.977 2.357v1.953h1.953c.884 0 1.732-.352 2.357-.977Z"}),(0,m.jsx)("path",{d:"m11.25 5.417 3.333 3.333"})]}),{width:20,height:20,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),b=E((0,m.jsxs)("g",{strokeWidth:"1.25",children:[(0,m.jsx)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),(0,m.jsx)("path",{d:"M15 8h.01"}),(0,m.jsx)("path",{d:"M12 20h-5a3 3 0 0 1 -3 -3v-10a3 3 0 0 1 3 -3h10a3 3 0 0 1 3 3v5"}),(0,m.jsx)("path",{d:"M4 15l4 -4c.928 -.893 2.072 -.893 3 0l4 4"}),(0,m.jsx)("path",{d:"M14 14l1 -1c.617 -.593 1.328 -.793 2.009 -.598"}),(0,m.jsx)("path",{d:"M19 16v6"}),(0,m.jsx)("path",{d:"M22 19l-3 3l-3 -3"})]}),{width:24,height:24,fill:"none",strokeWidth:2,stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),Z={width:20,height:20,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"},Y=E((0,m.jsx)("path",{strokeWidth:"1.25",d:"M10 4.167v11.666M4.167 10h11.666"}),Z),X=E((0,m.jsx)("path",{d:"M5 10h10",strokeWidth:"1.25"}),Z),T=n(2121),_=n(5671),W=n(3144),I=function(){function e(){(0,_.Z)(this,e);var t=JSON.parse(localStorage.getItem("elements"));this.elements=t||[]}return(0,W.Z)(e,[{key:"getElementsIncludingDeleted",value:function(){return this.elements}},{key:"replaceAllElements",value:function(e){this.elements=e}}]),e}(),R=new I,D=[{type:"rectangle",icon:z},{type:"freedraw",icon:M}],L=(0,a.memo)((function(e){var t=e.activeTool,n=e.onActiveToolChange;return(0,m.jsxs)("div",{className:S.tools,children:[(0,m.jsx)("span",{className:[S.item].join(" "),onClick:function(){(0,T.aF)({renderScene:y,elements:R.getElementsIncludingDeleted(),appState:G})},children:b}),D.map((function(e){var o=t.type===e.type;return(0,m.jsx)("span",{className:[S.item,o&&S.selected].join(" "),onClick:function(){return n({type:o?"":e.type})},children:e.icon},e.type)}))]})})),A={scale:"index_scale__mR-V3",item:"index_item__Wk8d0",value:"index_value__a48Yg"},P=(0,a.memo)((function(e){var t=e.appState,n=e.onZoomChange,o="".concat((100*t.zoom.value).toFixed(0),"%");return(0,m.jsxs)("div",{className:A.scale,children:[(0,m.jsx)("span",{className:[A.item].join(" "),onClick:function(){return n((0,s.j)(t.zoom.value-.1))},children:X}),(0,m.jsx)("span",{className:A.value,onClick:function(){return n((0,s.j)(1))},children:o}),(0,m.jsx)("span",{className:[A.item].join(" "),onClick:function(){return n((0,s.j)(t.zoom.value+.1))},children:Y})]})})),B=P,N="index_layer__zMJe8",F="index_ball_red__TSHIp",O="index_boundceBall__v-OAX",H="index_shadowball__JCZI3",U=(0,a.memo)((function(e){var t=e.activeTool,n=e.onActiveToolChange,o=e.appState,r=e.onZoomChange;return(0,m.jsxs)("div",{className:N,children:[(0,m.jsx)(B,{appState:o,onZoomChange:r}),(0,m.jsx)(L,{activeTool:t,onActiveToolChange:n}),(0,m.jsxs)("div",{className:O,children:[(0,m.jsx)("div",{className:F}),(0,m.jsx)("div",{className:H})]})]})})),q=U,K={textarea:"index_textarea__9SYfK",textarea_copy:"index_textarea_copy__9z8iV"},J=(0,a.forwardRef)((function(e,t){var n=e.staticCanvasRef,o=(0,a.useRef)(null),i=(0,a.useState)(""),s=(0,l.Z)(i,2),u=s[0],d=s[1];return(0,a.useImperativeHandle)(t,(function(){return{startEditText:function(e){e.preventDefault(),e.stopPropagation();var t=(0,c.dE)(e,G),n=t.x,r=t.y,i=v({x:n,y:r,strokeColor:(0,c.B8)(),backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid",text:"",fontSize:20,fontFamily:"Virgil",textAlign:"left",verticalAlign:"top"});G.draggingElement=i;var l=o.current;l.focus();var a=e.clientX-G.offsetLeft,s=e.clientY-G.offsetTop,u={font:(0,c.mO)(i),left:"".concat(a,"px"),top:"".concat(s,"px"),opacity:1,color:i.strokeColor,fontSize:i.fontSize};Object.assign(l.style,u);var d=document.getElementById("copyText");Object.assign(d.style,u);var f=G.canvasWidth-a;Object.assign(l.style,{zIndex:1,maxWidth:"".concat(f,"px"),width:"".concat(i.fontSize,"px"),height:"".concat(1.2*i.fontSize,"px")})}}})),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("textarea",{onChange:function(e){var t=e.target.value,n=o.current,r=parseFloat(n.style.maxWidth),i=document.getElementById("copyText");i.innerText=t;var l=i.getBoundingClientRect().width;if(l>r)if(l-r<30)t=i.innerText=t.slice(0,t.length-1)+"\n"+t.slice(t.length-1);else{var a=t.split("\n"),c=[];a.forEach((function(e){if(i.innerText=e,i.getBoundingClientRect().width<=r)c.push(e);else for(var t=0,n=1;n<e.length;n++){var o=e.slice(t,n);i.innerText=o,i.getBoundingClientRect().width>r?(c.push(e.slice(t,n-1)),t=n-1):n===e.length-1&&c.push(e.slice(t,n))}})),t=c.join("\n"),i.innerText=t}d(t);var s=i.getBoundingClientRect(),u=s.width,f=s.height;n.style.width="".concat(u+30,"px"),n.style.height="".concat(f,"px"),G.draggingElement.text=t},onBlur:function(){var e=G.draggingElement,t=o.current,i=document.getElementById("copyText");e.text&&(e.width=i.offsetWidth,e.height=i.offsetHeight,G.draggingElement,R.replaceAllElements([].concat((0,r.Z)(R.getElementsIncludingDeleted()),[G.draggingElement])),y({elements:R.getElementsIncludingDeleted(),appState:G,scale:window.devicePixelRatio,canvas:n.current,renderConfig:{selectionColor:"#6965db",scrollX:G.scrollX,scrollY:G.scrollY,viewBackgroundColor:"#ffffff",zoom:G.zoom}}),setTimeout((function(){i.innerText="",d("")}),200)),Object.assign(t.style,{left:"0px",top:"0px",zIndex:-1,opacity:0})},value:u,className:K.textarea,ref:o}),(0,m.jsx)("div",{style:{background:"grey"},id:"copyText",contentEditable:!0,className:[K.textarea,K.textarea_copy].join(" ")})]})})),V=(0,a.memo)(J),G=JSON.parse(localStorage.getItem("appState"))||{zoom:{value:1},scrollX:0,scrollY:0,offsetLeft:0,offsetTop:0,draggingElement:null,canvasWidth:0,canvasHeight:0},$=(0,a.memo)((function(){var e=(0,a.useRef)(null),t=(0,a.useRef)(null),n=(0,a.useRef)(null),o=(0,a.useRef)(null),u=(0,a.useRef)({}),d=(0,a.useRef)(null),f=(0,a.useRef)(null),v=(0,a.useRef)({}),x=(0,a.useState)(!1),w=(0,l.Z)(x,2),C=w[0],S=w[1],j=(0,a.useState)({type:""}),E=(0,l.Z)(j,2),z=E[0],M=E[1],b=(0,a.useState)({count:"",type:"rectangle"}),Z=(0,l.Z)(b,2),Y=Z[0],X=Z[1],T=(0,a.useState)(!1),_=(0,l.Z)(T,2),W=_[0],I=_[1],D=(0,a.useRef)(),L=function(){S(!C)};(0,a.useEffect)((function(){var t=function(e){e.width=i*window.devicePixelRatio,e.height=l*window.devicePixelRatio},r=e.current,i=r.offsetWidth,l=r.offsetHeight;t(r),t(n.current);var a=r.getBoundingClientRect(),c=a.x,s=a.y;G.offsetLeft=c,G.offsetTop=s,G.canvasWidth=i,G.canvasHeight=l,y({elements:R.getElementsIncludingDeleted(),appState:G,scale:window.devicePixelRatio,canvas:n.current,svg:o.current,renderConfig:{selectionColor:"#6965db",scrollX:G.scrollX,scrollY:G.scrollY,viewBackgroundColor:"#ffffff",zoom:G.zoom}})}),[]),(0,a.useEffect)((function(){var n=t.current,o=function(e){e.preventDefault()};n.addEventListener("wheel",o,{passive:!1});var r=function(e){u.current={cursorX:e.clientX,cursorY:e.clientY}},i=function(e){e.preventDefault()},l=e.current;return l.addEventListener("touchstart",i),document.addEventListener("mousemove",r),function(){l.removeEventListener("touchstart",i),n.removeEventListener("wheel",o),document.removeEventListener("mousemove",r)}}),[]),(0,a.useEffect)((function(){var e=0,t=Date.now();!function n(){var o=Date.now();if(e++,o>1e3+t){var r=Math.round(1e3*e/(o-t));f.current.innerText="FPS\uff1a".concat(r),e=0,t=o}requestAnimationFrame(n)}()}),[]);var A=k(e,G),P=A.updateGestureOnPointerDown,B=A.handleCanvasPointerMove,N=A.removePointer,F=A.gesture,O=function(){y({elements:R.getElementsIncludingDeleted(),appState:G,scale:window.devicePixelRatio,canvas:n.current,svg:o.current,renderConfig:{selectionColor:"#6965db",scrollX:G.scrollX,scrollY:G.scrollY,viewBackgroundColor:"#ffffff",zoom:G.zoom}}),v.current.zoomTimerId&&clearTimeout(v.current.zoomTimerId),v.current.zoomTimerId=setTimeout((function(){y({elements:R.getElementsIncludingDeleted(),appState:G,scale:window.devicePixelRatio,canvas:n.current,svg:o.current,renderConfig:{selectionColor:"#6965db",scrollX:G.scrollX,scrollY:G.scrollY,viewBackgroundColor:"#ffffff",zoom:G.zoom}})}),300)},H=function(e){return(0,c.$9)((function(t){var r=(0,c.dE)(t,G);if(e.lastCoords.x=r.x,e.lastCoords.y=r.y,"freedraw"===z.type)G.draggingElement.points.push([r.x,r.y]);else{var i=e.lastCoords,l=e.origin.x,a=e.origin.y,s=i.x,u=i.y,d=(0,c.TE)(e.origin.x,i.x),f=(0,c.TE)(e.origin.y,i.y),h=s<l?l-d:l,v=u<a?a-f:a;G.draggingElement.x=h,G.draggingElement.y=v,G.draggingElement.width=d,G.draggingElement.height=f}G.draggingElement,y({elements:R.getElementsIncludingDeleted(),appState:G,scale:window.devicePixelRatio,canvas:n.current,svg:o.current,renderConfig:{selectionColor:"#6965db",scrollX:G.scrollX,scrollY:G.scrollY,viewBackgroundColor:"#ffffff",zoom:G.zoom}})}))},U=function(t){return function(r){N(r);var i=e.current;i.getContext("2d").clearRect(0,0,i.width,i.height),y({elements:R.getElementsIncludingDeleted(),appState:G,scale:window.devicePixelRatio,canvas:n.current,svg:o.current,renderConfig:{selectionColor:"#6965db",scrollX:G.scrollX,scrollY:G.scrollY,viewBackgroundColor:"#ffffff",zoom:G.zoom}}),window.removeEventListener("pointermove",t.eventListeners.onMove),window.removeEventListener("pointerup",t.eventListeners.onUp)}},K=function(e){var t=(0,c.dE)(e,G);return{origin:t,lastCoords:(0,i.Z)({},t),eventListeners:{onMove:null,onUp:null,onKeyUp:null,onKeyDown:null}}};return(0,m.jsxs)("div",{className:"svg-base",ref:t,children:[(0,m.jsxs)("div",{onWheel:function(e){var t=e.deltaX,r=e.deltaY;if(e.metaKey||e.ctrlKey){var l=Math.sign(r),a=Math.abs(r),c=r;a>10&&(c=10*l);var d=G.zoom.value-c/100;d+=Math.log10(Math.max(1,G.zoom.value))*-l*Math.min(1,a/20);var f=(0,s.j)(d);return Object.assign(G,(0,i.Z)({},(0,s.E)({viewportX:u.current.cursorX,viewportY:u.current.cursorY,nextZoom:f},G))),L(),void O()}G.scrollX=G.scrollX-t/G.zoom.value,G.scrollY=G.scrollY-r/G.zoom.value,y({elements:R.getElementsIncludingDeleted(),appState:G,scale:window.devicePixelRatio,canvas:n.current,svg:o.current,renderConfig:{selectionColor:"#6965db",scrollX:G.scrollX,scrollY:G.scrollY,viewBackgroundColor:"#ffffff",zoom:G.zoom}})},onPointerDown:function(e){if(!(F.pointers.size>1))if(z.type){var t=K(e),n=h({elementType:z.type,pointerDownState:t,appState:G});G.draggingElement=n,R.replaceAllElements([].concat((0,r.Z)(R.getElementsIncludingDeleted()),[G.draggingElement]));var o=H(t),i=U(t);window.addEventListener("pointermove",o),window.addEventListener("pointerup",i),t.eventListeners.onMove=o,t.eventListeners.onUp=i}else P(e)},onDoubleClick:function(e){z.type||d.current.startEditText(e)},onPointerCancel:N,onPointerMove:function(e){B(e,(function(){L(),O()}))},className:"container wrap",children:[(0,m.jsx)("div",{className:"svg-container",ref:o}),(0,m.jsx)("canvas",{ref:n,className:"canvas",children:"\u9759\u6001canvas"}),(0,m.jsx)("canvas",{ref:e,className:"canvas draw",children:"\u52a8\u6001canvas"}),(0,m.jsx)(q,{activeTool:z,onZoomChange:function(e){G.zoom.value!==e&&(Object.assign(G,(0,i.Z)({},(0,s.E)({viewportX:G.canvasWidth/2+G.offsetLeft,viewportY:G.canvasHeight/2+G.offsetTop,nextZoom:e},G))),L(),O())},appState:(0,i.Z)({},G),onActiveToolChange:function(e){M(e)}}),(0,m.jsx)(V,{ref:d,staticCanvasRef:n})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("span",{ref:f,children:"FPS\uff1a--"}),(0,m.jsx)("span",{className:"total",id:"canvas-total"})]}),(0,m.jsxs)("div",{className:"row",children:[(0,m.jsx)("input",{type:"number",value:Y.count,onChange:function(e){return X((0,i.Z)((0,i.Z)({},Y),{},{count:e.target.value}))}}),(0,m.jsxs)("select",{value:Y.type,onChange:function(e){return X((0,i.Z)((0,i.Z)({},Y),{},{type:e.target.value}))},children:[(0,m.jsx)("option",{value:"freedraw",children:"freedraw"}),(0,m.jsx)("option",{value:"rectangle",children:"rectangle"}),(0,m.jsx)("option",{value:"text",children:"text"})]}),(0,m.jsx)("button",{onClick:function(){var e=p(Number(Y.count),Y.type,G);R.replaceAllElements([].concat((0,r.Z)(R.getElementsIncludingDeleted()),(0,r.Z)(e))),y({elements:R.getElementsIncludingDeleted(),appState:G,scale:window.devicePixelRatio,canvas:n.current,svg:o.current,renderConfig:{selectionColor:"#6965db",scrollX:G.scrollX,scrollY:G.scrollY,viewBackgroundColor:"#ffffff",zoom:G.zoom}})},children:"\u751f\u6210"}),(0,m.jsx)("button",{onClick:function(){if(I(!W),D.current&&cancelAnimationFrame(D.current),!W){var e=Date.now();D.current=requestAnimationFrame((function t(){var r=Date.now();if(r-e>=100){e=r;var i=function(e,t){return e.forEach((function(e){var n=g(-t.scrollX,t.canvasWidth-t.scrollX),o=g(-t.scrollY,t.canvasHeight-t.scrollY);e.x=n,e.y=o})),e}(R.getElementsIncludingDeleted(),G);y({elements:i,appState:G,scale:window.devicePixelRatio,canvas:n.current,svg:o.current,renderConfig:{selectionColor:"#6965db",scrollX:G.scrollX,scrollY:G.scrollY,viewBackgroundColor:"#ffffff",zoom:G.zoom}})}D.current=requestAnimationFrame(t)}))}},children:W?"\u505c\u6b62\u52a8\u753b":"\u52a8\u753b"})]}),(0,m.jsx)("div",{id:"placeholder"})]})})),Q=$},2121:function(e,t,n){n.d(t,{Sp:function(){return l},aF:function(){return a}});var o=n(1413),r=n(9439),i=n(5204),l=function(e,t){var n=(0,i.KP)(e),o=(0,r.Z)(n,4),l=o[0],a=o[1],c=o[2],s=o[3];return[l,a,(0,i.TE)(l,c)+2*t,(0,i.TE)(a,s)+t+t]},a=function(e){var t=e.renderScene,n=e.isExport,i=void 0===n||n,a=e.notUseCache,c=function(e){var t=e.renderScene,n=e.isExport,i=e.notUseCache,a=e.elements,c=e.appState,s=l(a,10),u=(0,r.Z)(s,4),d=u[0],f=u[1],h=u[2],v=u[3],g=document.createElement("canvas");return g.width=h*window.devicePixelRatio,g.height=v*window.devicePixelRatio,t({elements:a,appState:(0,o.Z)((0,o.Z)({},c),{},{scrollX:10-d,scrollY:10-f}),scale:window.devicePixelRatio,canvas:g,renderConfig:{selectionColor:"#6965db",scrollX:10-d,scrollY:10-f,viewBackgroundColor:"#ffffff",zoom:{value:1},isExport:n,notUseCache:i}}),g.toDataURL()}({renderScene:t,isExport:i,notUseCache:void 0===a||a,elements:e.elements,appState:e.appState}),s=document.createElement("a");s.href=c,s.download="canvas.png",s.click()}},5909:function(e,t,n){n.d(t,{S:function(){return i},q:function(){return r}});var o=n(9439),r=function(e){var t=Array.from(e.values());return{x:l(t,(function(e){return e.x}))/t.length,y:l(t,(function(e){return e.y}))/t.length}},i=function(e){var t=(0,o.Z)(e,2),n=t[0],r=t[1];return Math.hypot(n.x-r.x,n.y-r.y)},l=function(e,t){return e.reduce((function(e,n){return e+t(n)}),0)}},5204:function(e,t,n){n.d(t,{$9:function(){return s},B8:function(){return c},KP:function(){return h},Pi:function(){return f},TE:function(){return g},dE:function(){return a},kb:function(){return m},mO:function(){return x},qf:function(){return v}});var o=n(9439),r=n(7762),i=n(3433),l=n(4453),a=function(e,t){var n=e.clientX,o=e.clientY,r=t.zoom,i=t.offsetLeft,l=t.offsetTop,a=t.scrollX,c=t.scrollY,s=r?r.value:1;return{x:(n-i)/s-a,y:(o-l)/s-c}},c=function(){var e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),n=Math.floor(256*Math.random());return"rgb(".concat(e,",").concat(t,",").concat(n,")")},s=function(e){return function(e,t){var n=null,o=null,r=null,l=function t(l){n=window.requestAnimationFrame((function(){n=null,e.apply(void 0,(0,i.Z)(l)),o=null,r&&(o=r,r=null,t(o))}))},a=function(){for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];o=i,null===n?l(o):null!==t&&void 0!==t&&t.trailing&&(r=i)};return a.flush=function(){null!==n&&(cancelAnimationFrame(n),n=null),o&&(e.apply(void 0,(0,i.Z)(r||o)),o=r=null)},a.cancel=function(){o=r=null,null!==n&&(cancelAnimationFrame(n),n=null)},a}((function(t){(0,l.unstable_batchedUpdates)(e,t)}))},u=function(e){var t=1/0,n=1/0,i=-1/0,l=-1/0,a=e.points;"freedraw"===e.type&&(a=e.points.map((function(t){return[t[0]-e.x,t[1]-e.y]})));var c,s=(0,r.Z)(a);try{for(s.s();!(c=s.n()).done;){var u=(0,o.Z)(c.value,2),d=u[0],f=u[1];t=Math.min(t,d),n=Math.min(n,f),i=Math.max(i,d),l=Math.max(l,f)}}catch(h){s.e(h)}finally{s.f()}return[t,n,i,l]},d=function(e,t,n,o,r){return[(e-n)*Math.cos(r)-(t-o)*Math.sin(r)+n,(e-n)*Math.sin(r)+(t-o)*Math.cos(r)+o]},f=function(e){var t=v(e),n=(0,o.Z)(t,6),r=n[0],i=n[1],l=n[2],a=n[3],c=n[4],s=n[5];if("freedraw"===e.type){var f=u(e),h=(0,o.Z)(f,4),g=h[0],p=h[1],m=h[2],x=h[3];return[g+e.x,p+e.y,m+e.x,x+e.y]}var y=d(r,i,c,s,e.angle),w=(0,o.Z)(y,2),C=w[0],k=w[1],S=d(r,a,c,s,e.angle),j=(0,o.Z)(S,2),E=j[0],z=j[1],M=d(l,a,c,s,e.angle),b=(0,o.Z)(M,2),Z=b[0],Y=b[1],X=d(l,i,c,s,e.angle),T=(0,o.Z)(X,2),_=T[0],W=T[1];return[Math.min(C,E,Z,_),Math.min(k,z,Y,W),Math.max(C,E,Z,_),Math.max(k,z,Y,W)]},h=function(e){if(!e.length)return[0,0,0,0];var t=1/0,n=-1/0,r=1/0,i=-1/0;return e.forEach((function(e){var l=f(e),a=(0,o.Z)(l,4),c=a[0],s=a[1],u=a[2],d=a[3];t=Math.min(t,c),r=Math.min(r,s),n=Math.max(n,u),i=Math.max(i,d)})),[t,r,n,i]},v=function(e){if("freedraw"===e.type){var t=u(e),n=(0,o.Z)(t,4),r=n[0],i=n[1],l=n[2],a=n[3],c=r+e.x,s=i+e.y,d=l+e.x,f=a+e.y;return[c,s,d,f,(c+d)/2,(s+f)/2]}return[e.x,e.y,e.x+e.width,e.y+e.height,e.x+e.width/2,e.y+e.height/2]},g=function(e,t){return Math.abs(e-t)},p=0,m=function(){return"id".concat(p++)},x=function(e){var t=e.fontSize,n=e.fontFamily;return"".concat(t,"px ").concat(n,", Segoe UI Emoji")}},4975:function(e,t,n){n.d(t,{E:function(){return r},j:function(){return o}});var o=function(e){return Math.max(.1,Math.min(e,30))},r=function(e,t){var n=e.viewportX,o=e.viewportY,r=e.nextZoom,i=n-t.offsetLeft,l=o-t.offsetTop,a=t.zoom.value;return{scrollX:t.scrollX+i/r-i/a,scrollY:t.scrollY+l/r-l/a,zoom:{value:r}}}}}]);
//# sourceMappingURL=DomRenderBase.5d903f3f.chunk.js.map