!function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function t(t,r){if(t){if("string"===typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,r):void 0}}function r(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,l,i=[],s=!0,f=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);s=!0);}catch(c){f=!0,a=c}finally{try{if(!s&&null!=r.return&&(l=r.return(),Object(l)!==l))return}finally{if(f)throw a}}return i}}(e,r)||t(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var n=function(e){var n=1/0,a=1/0,o=-1/0,l=-1/0,i=e.points;"freedraw"===e.type&&(i=e.points.map((function(t){return[t[0]-e.x,t[1]-e.y]})));var s,f=function(e,r){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=t(e))||r&&e&&"number"===typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,l=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw l}}}}(i);try{for(f.s();!(s=f.n()).done;){var c=r(s.value,2),u=c[0],v=c[1];n=Math.min(n,u),a=Math.min(a,v),o=Math.max(o,u),l=Math.max(l,v)}}catch(h){f.e(h)}finally{f.f()}return[n,a,o,l]},a=function(e,t){return Math.abs(e-t)},o=function(e){if("freedraw"===e.type){var t=r(n(e),4),a=t[0],o=t[1],l=t[2],i=t[3],s=a+e.x,f=o+e.y,c=l+e.x,u=i+e.y;return[s,f,c,u,(s+c)/2,(f+u)/2]}return[e.x,e.y,e.x+e.width,e.y+e.height,e.x+e.width/2,e.y+e.height/2]},l=function(e,t,r,n,a){return[(e-r)*Math.cos(a)-(t-n)*Math.sin(a)+r,(e-r)*Math.sin(a)+(t-n)*Math.cos(a)+n]},i=function(e,t){var r=e.clientX,n=e.clientY,a=t.zoom,o=t.offsetLeft,l=t.offsetTop,i=t.scrollX,s=t.scrollY,f=a?a.value:1;return{x:(r-o)/f-i,y:(n-l)/f-s}},s=new WeakMap,f=function(e,t){var r=s.get(e);if(r&&!t.notUseCache)return r;var n=u(e,t.zoom,t);return t.notUseCache||s.set(e,n),n},c="object"===typeof document,u=function(e,t,n){var l,i,s=c?window.devicePixelRatio:n.devicePixelRatio,f=h(e);if("freedraw"===e.type){var u,y,d=r(o(e),4),m=d[0],p=d[1],x=d[2],g=d[3];i=(l=new OffscreenCanvas(a(m,x)*s*t.value+f*t.value*2,a(p,g)*s*t.value+f*t.value*2)).getContext("2d"),u=e.x>m?a(e.x,m)*s*t.value:0,y=e.y>p?a(e.y,p)*t.value*s:0,i.translate(u,y)}else i=(l=new OffscreenCanvas(e.width*s*t.value+f*t.value*2,e.height*s*t.value+f*t.value*2)).getContext("2d");return i.save(),i.translate(f*t.value,f*t.value),i.scale(s*t.value,s*t.value),v(e,i,n),i.restore(),{element:e,canvas:l,theme:n.theme,canvasZoom:t,canvasOffsetX:0,canvasOffsetY:0}},v=function(e,t,n){switch(t.globalAlpha=e.opacity/100,e.type){case"rectangle":t.lineJoin="round",t.lineCap="round",t.lineWidth=e.strokeWidth,t.strokeStyle=n.strokeStyle||e.strokeStyle,t.strokeRect(0,0,e.width,e.height);break;case"text":t.font=function(e){var t=e.fontSize,r=e.fontFamily;return"".concat(t,"px ").concat(r,", Segoe UI Emoji")}(e),t.fillStyle=n.fillStyle||e.strokeColor,t.textAlign=e.textAlign;var a=e.text.split("\n"),o=a.length?e.height/a.length:18;t.textBaseline="bottom";for(var l=0;l<a.length;l++)t.fillText(a[l],0,(l+1)*o);break;case"freedraw":t.save(),t.lineWidth=e.strokeWidth,t.strokeStyle=n.strokeStyle||e.strokeStyle,e.points.forEach((function(n,a){var o=r(n,2),l=o[0],i=o[1];l-=e.x,i-=e.y,a?t.lineTo(l,i):t.moveTo(l,i)})),t.stroke(),t.restore()}t.globalAlpha=1},h=function(e){return"freedraw"===e.type?12*e.strokeWidth:20},y=function(e,t,n){var a=c?window.devicePixelRatio:n.devicePixelRatio,l=e.element,i=h(l),s=r(o(l),4),f=s[0],u=s[1],v=s[2],y=s[3];if("freedraw"===l.type){var d=r(o(l),4);f=d[0],u=d[1],v=d[2],y=d[3]}var m=((f+v)/2+n.scrollX)*a,p=((u+y)/2+n.scrollY)*a;t.save(),t.scale(1/a,1/a),t.translate(m,p),t.drawImage(e.canvas,-(v-f)/2*a-i*e.canvasZoom.value/e.canvasZoom.value,-(y-u)/2*a-i*e.canvasZoom.value/e.canvasZoom.value,e.canvas.width/e.canvasZoom.value,e.canvas.height/e.canvasZoom.value),t.restore()},d=function(e,t,a,s){var f=function(e){var t=r(o(e),6),a=t[0],i=t[1],s=t[2],f=t[3],c=t[4],u=t[5];if("freedraw"===e.type){var v=r(n(e),4),h=v[0],y=v[1],d=v[2],m=v[3];return[h+e.x,y+e.y,d+e.x,m+e.y]}var p=r(l(a,i,c,u,e.angle),2),x=p[0],g=p[1],w=r(l(a,f,c,u,e.angle),2),b=w[0],S=w[1],T=r(l(s,f,c,u,e.angle),2),k=T[0],C=T[1],A=r(l(s,i,c,u,e.angle),2),M=A[0],X=A[1];return[Math.min(x,b,k,M),Math.min(g,S,C,X),Math.max(x,b,k,M),Math.max(g,S,C,X)]}(e),c=r(f,4),u=c[0],v=c[1],h=c[2],y=c[3],d=i({clientX:s.offsetLeft,clientY:s.offsetTop},s),m=i({clientX:s.offsetLeft+t,clientY:s.offsetTop+a},s);return d.x<=h&&d.y<=y&&m.x>=u&&m.y>=v},m=function(e){var t=e.elements,r=e.appState,n=e.scale,a=e.canvas,o=e.renderConfig,l=a.getContext("2d");l.save(),l.scale(n,n);var i=a.width/n,s=a.height/n;(l.clearRect(0,0,i,s),l.save(),l.scale(o.zoom.value,o.zoom.value),o.isExport&&t||function(e,t){var r=t.scrollX,n=t.scrollY,a=t.zoom;e.save();var o=100,l=100,i=e.canvas;e.strokeStyle="red",e.fillStyle="red",e.beginPath(),e.lineWidth=2,e.textBaseline="middle",e.save(),e.translate(0,n);for(var s=0;s<n/o;s++)e.moveTo(0,-s*o),e.lineTo(8,-s*o),e.font="10px Arial",e.fillText(-s,0,-s*o+10);for(var f=1;f<(i.height-n*a.value)/(o*a.value);f++)e.moveTo(0,f*o),e.lineTo(8,f*o),e.font="10px Arial",e.fillText(f,0,f*o+10);e.restore(),e.save(),e.translate(r,0);for(var c=0;c<r/l;c++)e.moveTo(-c*l,0),e.lineTo(-c*l,8),e.font="10px Arial",e.fillText(-c,-c*l+5,5);for(var u=1;u<(i.width-r*a.value)/(l*a.value);u++)e.moveTo(u*l,0),e.lineTo(u*l,8),e.font="10px Arial",e.fillText(u,u*l+5,5);e.restore(),e.stroke(),e.restore()}(l,o),t)&&t.filter((function(e){return d(e,i,s,{zoom:o.zoom,offsetLeft:r.offsetLeft,offsetTop:r.offsetTop,scrollX:o.scrollX,scrollY:o.scrollY})})).forEach((function(e){!function(e,t,r,n){var a=f(e,r);y(a,t,r)}(e,l,o)}));l.restore(),l.restore()};let p=null,x=null;self.onmessage=e=>{const{canvasWorker:t,scale:r,isExport:n,notUseCache:a,type:o,minX:l,exportPadding:i,minY:s,elements:f,width:c,height:u,devicePixelRatio:v,appState:h}=e.data;if("render"===o){p=t,x=p.getContext("2d"),x.scale(r,r),m({elements:f,appState:{...h,scrollX:-l+i,scrollY:-s+i},scale:v,canvas:p,renderConfig:{selectionColor:"#6965db",scrollX:-l+i,scrollY:-s+i,viewBackgroundColor:"#ffffff",zoom:{value:1},fillStyle:h.fillStyle,strokeStyle:h.strokeStyle,isExport:n,notUseCache:a,devicePixelRatio:v}});const e=p.transferToImageBitmap();postMessage({imageBitmap:e},[e])}},console.log("worker===========")}();
//# sourceMappingURL=file.worker.e450a597.worker.js.map