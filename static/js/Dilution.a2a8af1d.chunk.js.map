{"version":3,"file":"static/js/Dilution.a2a8af1d.chunk.js","mappings":"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","sources":["components/markdown/index.jsx","pages/free-draw/dilution/renderScene.js","pages/free-draw/dilution/index.jsx","util/index.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport remarkGfm from \"remark-gfm\";\nimport { Prism as SyntaxHighlighter } from \"react-syntax-highlighter\";\nimport rehypeRaw from \"rehype-raw\";\n// import { tomorrow } from \"react-syntax-highlighter/dist/esm/styles/prism\";\nimport \"github-markdown-css\";\n\nimport './index.less'\n\n\nfunction Shapes({ src }) {\n  const [mdText, setMdText] = useState(\"\");\n  useEffect(() => {\n    fetch(src)\n      .then((response) => response.text())\n      .then((text) => {\n        setMdText(text);\n      });\n  }, [src]);\n  return (\n    <div className=\"markdown-body\">\n      <ReactMarkdown\n        children={mdText}\n        rehypePlugins={[rehypeRaw]}\n        remarkPlugins={[remarkGfm]}\n        components={{\n          code({ node, inline, className, children, ...props }) {\n            const match = /language-(\\w+)/.exec(className || \"\");\n            return !inline && match ? (\n              <SyntaxHighlighter\n                children={String(children).replace(/\\n$/, \"\")}\n                // style={{ background: 'red'}}\n                language={match[1]}\n                className=\"my-code\"\n                PreTag=\"div\"\n                {...props}\n              />\n            ) : (\n              <code className={className} {...props}>\n                {children}\n              </code>\n            );\n          },\n        }}\n      />\n    </div>\n  );\n}\n\nexport default Shapes;\n","import { elements } from \"./index\";\n\nconst renderElements = (ctx, appState) => {\n  elements.forEach((ele) => {\n    ctx.save();\n    ctx.beginPath();\n    ctx.lineWidth = 3;\n    ctx.strokeStyle = \"blue\";\n\n    ele.points.forEach((point, index) => {\n      if (!index) {\n        ctx.moveTo(...ele.points[0]);\n      } else {\n        ctx.lineTo(...point);\n      }\n    });\n\n    ctx.stroke();\n\n    ctx.restore();\n  });\n};\nconst renderScene = (canvas, appState) => {\n  const context = canvas.getContext(\"2d\");\n  context.clearRect(0, 0, canvas.width, canvas.height);\n  renderElements(context, appState);\n};\n\nexport default renderScene;\n","import React, { memo, useRef, useEffect } from \"react\";\nimport { viewportCoordsToSceneCoords } from \"@/util\";\nimport MarkDown from \"@/components/markdown\";\nimport doc from \"@doc/canvas进阶/点稀释.md\";\nimport \"./index.less\";\nimport renderScene from \"./renderScene\";\n\nexport const elements = [];\nconst appState = {\n  offsetLeft: 0,\n  offsetTop: 0,\n  scrollX: 0,\n  scrollY: 0,\n  draggingElement: null,\n};\nconst Canvas = memo(() => {\n  const canvasRef = useRef(null);\n  const canvasContainer = useRef(null);\n  useEffect(() => {\n    // canvas分辨率矫正\n    const canvas = canvasRef.current;\n    const context = canvas.getContext(\"2d\");\n    const { offsetWidth, offsetHeight, offsetLeft, offsetTop } = canvas;\n    canvas.width = offsetWidth * window.devicePixelRatio;\n    canvas.height = offsetHeight * window.devicePixelRatio;\n    context.scale(window.devicePixelRatio, window.devicePixelRatio);\n    appState.offsetLeft = offsetLeft;\n    appState.offsetTop = offsetTop;\n    renderScene(canvas, appState);\n\n    // 防止双指滑动时切换页面\n    const wrap = canvasContainer.current;\n    const handleWheel = (e) => {\n      e.preventDefault();\n    };\n    // 防止双指滑动时切换页面\n    wrap.addEventListener(\"wheel\", handleWheel, {\n      passive: false,\n    });\n    return () => {\n      wrap.removeEventListener(\"wheel\", handleWheel);\n    };\n  }, []);\n  const handleCanvasPointerDown = (event) => {\n    const origin = viewportCoordsToSceneCoords(event, appState);\n\n    const pointerDownState = {\n      origin,\n      lastCoords: { ...origin },\n      eventListeners: {\n        onMove: null,\n        onUp: null,\n      },\n    };\n    const element = {\n      x: pointerDownState.origin.x,\n      y: pointerDownState.origin.y,\n      points: [],\n      strokeColor: \"#000000\",\n      backgroundColor: \"transparent\",\n      fillStyle: \"hachure\",\n      strokeWidth: 1,\n      strokeStyle: \"solid\",\n    };\n    appState.draggingElement = element;\n    elements.push(element);\n\n    const onPointerMove =\n      onPointerMoveFromCanvasPointerDownHandler(pointerDownState);\n    const onPointerUp =\n      onPointerUpFromCanvasPointerDownHandler(pointerDownState);\n    window.addEventListener(\"pointermove\", onPointerMove);\n    window.addEventListener(\"pointerup\", onPointerUp);\n    pointerDownState.eventListeners.onMove = onPointerMove;\n    pointerDownState.eventListeners.onUp = onPointerUp;\n  };\n  const onPointerMoveFromCanvasPointerDownHandler =\n    (pointerDownState) => (event) => {\n      const pointerCoords = viewportCoordsToSceneCoords(event, appState);\n\n      appState.draggingElement.points.push([pointerCoords.x, pointerCoords.y]);\n      renderScene(canvasRef.current, appState);\n    };\n\n  const onPointerUpFromCanvasPointerDownHandler = (pointerDownState) => () => {\n    console.log('appState...', appState)\n    console.log('elements...', elements)\n    window.removeEventListener(\n      \"pointermove\",\n      pointerDownState.eventListeners.onMove\n    );\n    window.removeEventListener(\n      \"pointerup\",\n      pointerDownState.eventListeners.onUp\n    );\n  };\n  return (\n    <div className=\"free-draw\">\n      <div className=\"container\" ref={canvasContainer}>\n        <canvas\n          ref={canvasRef}\n          className=\"canvas\"\n          onPointerDown={handleCanvasPointerDown}\n        >\n          绘制canvas\n        </canvas>\n      </div>\n      <MarkDown src={doc} />\n    </div>\n  );\n});\n\nexport default Canvas;\n","export const viewportCoordsToSceneCoords = (\n  { clientX, clientY },\n  { offsetLeft, offsetTop, scrollX, scrollY }\n) => {\n  const x = clientX - offsetLeft - scrollX;\n  const y = clientY - offsetTop - scrollY;\n  return { x, y };\n};\n"],"names":["src","useState","mdText","setMdText","useEffect","fetch","then","response","text","className","children","rehypePlugins","rehypeRaw","remarkPlugins","remarkGfm","components","code","node","inline","props","match","exec","String","replace","language","PreTag","canvas","appState","ctx","context","getContext","clearRect","width","height","elements","ele","save","beginPath","lineWidth","strokeStyle","points","forEach","point","index","lineTo","moveTo","stroke","restore","offsetLeft","offsetTop","scrollX","scrollY","draggingElement","memo","canvasRef","useRef","canvasContainer","current","offsetWidth","offsetHeight","window","devicePixelRatio","scale","renderScene","wrap","handleWheel","e","preventDefault","addEventListener","passive","removeEventListener","onPointerMoveFromCanvasPointerDownHandler","pointerDownState","event","pointerCoords","viewportCoordsToSceneCoords","push","x","y","onPointerUpFromCanvasPointerDownHandler","console","log","eventListeners","onMove","onUp","ref","onPointerDown","origin","lastCoords","element","strokeColor","backgroundColor","fillStyle","strokeWidth","onPointerMove","onPointerUp","doc","clientX","clientY"],"sourceRoot":""}