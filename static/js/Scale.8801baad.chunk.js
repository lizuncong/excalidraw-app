"use strict";(this.webpackChunkexcalidraw_app=this.webpackChunkexcalidraw_app||[]).push([[804],{5951:function(e,t,o){o.r(t),o.d(t,{default:function(){return v},elements:function(){return s}});var n=o(1413),r=o(4519),i=function(e,t){var o=e.getContext("2d");o.clearRect(0,0,e.width,e.height),function(e,t){var o=t.zoom,n=t.scrollX,r=t.scrollY;e.save();var i=100*o.value,l=100*o.value,a=8*o.value,s=e.canvas,c=n*o.value,v=r*o.value;e.translate(c,v),e.strokeStyle="red",e.fillStyle="red",e.save(),e.beginPath(),e.setLineDash([10,10]),e.moveTo(0,-v),e.lineTo(0,s.height-v),e.moveTo(-c,0),e.lineTo(s.width-c,0),e.stroke(),e.restore(),e.beginPath(),e.lineWidth=2,e.textBaseline="middle";for(var u=0;u<v/i;u++)e.moveTo(0,-u*i),e.lineTo(a,-u*i),e.font="".concat(20*o.value,"px Arial"),e.fillText(-u,-25,-u*i);for(var f=0;f<(s.height-v)/i;f++)e.moveTo(0,f*i),e.lineTo(a,f*i),e.font="".concat(20*o.value,"px Arial"),e.fillText(f,-25,f*i);for(var d=1;d<c/l;d++)e.moveTo(-d*l,0),e.lineTo(-d*l,a),e.font="".concat(20*o.value,"px Arial"),e.fillText(-d,-d*l-10,-15);for(var h=1;h<(s.width-c)/l;h++)e.moveTo(h*l,0),e.lineTo(h*l,a),e.font="".concat(20*o.value,"px Arial"),e.fillText(h,h*l-5,-15);e.stroke(),e.restore()}(o,t),function(e,t){s.forEach((function(o){e.save(),e.scale(t.zoom.value,t.zoom.value),e.translate(o.x+t.scrollX,o.y+t.scrollY),e.strokeStyle=o.strokeStyle,e.strokeColor=o.strokeColor,e.strokeRect(0,0,o.width,o.height),e.restore()}))}(o,t)},l=o(2556),a={zoom:{value:1},offsetLeft:0,offsetTop:0,scrollX:0,scrollY:0,draggingElement:null},s=[],c=function(e,t){var o=e.clientX,n=e.clientY,r=t.zoom,i=t.offsetLeft,l=t.offsetTop,a=t.scrollX,s=t.scrollY;return{x:(o-i)/r.value-a,y:(n-l)/r.value-s}},v=(0,r.memo)((function(){var e=(0,r.useRef)(null),t=(0,r.useRef)(null),o=(0,r.useRef)({}),v=(0,r.useRef)();(0,r.useEffect)((function(){var t=function(){var t=e.current,o=t.getContext("2d"),n=t.offsetWidth,r=t.offsetHeight,l=t.offsetLeft,s=t.offsetTop;t.width=n*window.devicePixelRatio,t.height=r*window.devicePixelRatio,o.scale(window.devicePixelRatio,window.devicePixelRatio),a.offsetLeft=l,a.offsetTop=s,i(t,a)};t();var o=function(){t()};return window.addEventListener("resize",o),function(){window.removeEventListener("resize",o)}}),[]),(0,r.useEffect)((function(){var e=t.current,n=function(e){e.preventDefault()};e.addEventListener("wheel",n,{passive:!1});var r=function(e){o.current={cursorX:e.clientX,cursorY:e.clientY}};return document.addEventListener("mousemove",r),function(){e.removeEventListener("wheel",n),document.removeEventListener("mousemove",r)}}),[]);var u=function(e){return function(t){window.removeEventListener("pointermove",e.eventListeners.onMove),window.removeEventListener("pointerup",e.eventListeners.onUp)}},f=function(t){return function(o){var n=c(o,a);t.lastCoords.x=n.x,t.lastCoords.y=n.y,a.draggingElement.width=n.x-t.origin.x,a.draggingElement.height=n.y-t.origin.y,i(e.current,a)}};return(0,l.jsxs)("div",{className:"scale",children:[(0,l.jsx)("div",{ref:t,children:(0,l.jsx)("canvas",{ref:e,className:"canvas",onPointerDown:function(e){var t=c(e,a);console.log("origin...",a,t);var o={origin:t,lastCoords:(0,n.Z)({},t),eventListeners:{onMove:null,onUp:null}},r={x:o.origin.x,y:o.origin.y,width:0,height:0,strokeColor:"#000000",backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid"};a.draggingElement=r,s.push(r);var i=f(o),l=u(o);window.addEventListener("pointermove",i),window.addEventListener("pointerup",l),o.eventListeners.onMove=i,o.eventListeners.onUp=l},onWheel:function(t){var r,l=t.deltaX,s=t.deltaY;if(t.metaKey||t.ctrlKey){var c=Math.sign(s),u=Math.abs(s),f=s;u>10&&(f=10*c);var d=a.zoom.value-f/100;d+=Math.log10(Math.max(1,a.zoom.value))*-c*Math.min(1,u/20);var h=(r=d,Math.max(.1,Math.min(r,30)));return Object.assign(a,(0,n.Z)({},function(e,t){var o=e.viewportX,n=e.viewportY,r=e.nextZoom,i=o-t.offsetLeft,l=n-t.offsetTop,a=t.zoom.value;return{scrollX:t.scrollX+i/r-i/a,scrollY:t.scrollY+l/r-l/a,zoom:{value:r}}}({viewportX:o.current.cursorX,viewportY:o.current.cursorY,nextZoom:h},a))),v.current.innerText="".concat((100*h).toFixed(0),"%"),void i(e.current,a)}a.scrollX=a.scrollX-l/a.zoom.value,a.scrollY=a.scrollY-s/a.zoom.value,i(e.current,a)},children:"\u7ed8\u5236canvas"})}),(0,l.jsx)("div",{children:(0,l.jsx)("button",{onClick:function(){var e=1/0,t=-1/0,o=1/0,r=-1/0;s.forEach((function(n){var i=[n.x,n.y,n.x+n.width,n.y+n.height],l=i[0],a=i[1],s=i[2],c=i[3];e=Math.min(e,l),o=Math.min(o,a),t=Math.max(t,s),r=Math.max(r,c)}));var l=document.createElement("canvas");l.width=(t-e+20)*window.devicePixelRatio,l.height=(r-o+20)*window.devicePixelRatio,l.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio),i(l,(0,n.Z)((0,n.Z)({},a),{},{scrollX:10-e,scrollY:10-o})),console.log("\u5bfc\u51fa",s);var c=document.createElement("a");c.href=l.toDataURL(),c.download="canvas.png",c.click()},children:"\u5bfc\u51faPNG"})}),(0,l.jsx)("div",{ref:v})]})}))}}]);
//# sourceMappingURL=Scale.8801baad.chunk.js.map