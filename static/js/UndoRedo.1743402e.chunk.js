"use strict";(this.webpackChunkexcalidraw_app=this.webpackChunkexcalidraw_app||[]).push([[894],{8927:function(e,t,n){n.r(t),n.d(t,{default:function(){return k},elements:function(){return w}});var r=n(1413),i=n(4519),o=n(5204),a="index_undoRedo__mOw1J",s="index_canvas__s497j",l="index_container__JGkWk",u="index_btnRow__ReEOR",c=n(3433),f=function(e,t){var n,r=e.getContext("2d");r.clearRect(0,0,e.width,e.height),n=r,w.forEach((function(e){n.save(),n.beginPath(),n.lineWidth=3,n.strokeStyle=e.strokeStyle,e.points.forEach((function(t,r){r?n.lineTo.apply(n,(0,c.Z)(t)):n.moveTo.apply(n,(0,c.Z)(e.points[0]))})),n.stroke(),n.restore()})),localStorage.setItem("free-draw-elements",JSON.stringify(w))},h=n(5671),d=n(3144),v=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(null==t||"object"!==typeof t)return t;if("[object Object]"===Object.prototype.toString.call(t)){var r="function"===typeof t.constructor?Object.create(Object.getPrototypeOf(t)):{};for(var i in t)if(t.hasOwnProperty(i)){if(0===n&&("shape"===i||"canvas"===i))continue;r[i]=e(t[i],n+1)}return r}if(Array.isArray(t)){for(var o=t.length,a=new Array(o);o--;)a[o]=e(t[o],n+1);return a}return t},p=function(e){return{selectedElementIds:e.selectedElementIds,selectedGroupIds:e.selectedGroupIds,viewBackgroundColor:e.viewBackgroundColor,editingLinearElement:e.editingLinearElement,editingGroupId:e.editingGroupId,name:e.name}},y=function(){function e(){var t=this;(0,h.Z)(this,e),this.generateEntry=function(e,n){return t.dehydrateHistoryEntry({appState:p(e),elements:n})},this.elementCache=new Map,this.recording=!0,this.stateHistory=[],this.redoStack=[],this.lastEntry=null}return(0,d.Z)(e,[{key:"hydrateHistoryEntry",value:function(e){var t=this,n=e.appState,r=e.elements;return{appState:JSON.parse(n),elements:r.map((function(e){var n,r=null===(n=t.elementCache.get(e.id))||void 0===n?void 0:n.get(e.versionNonce);if(!r)throw new Error("Element not found: ".concat(e.id,":").concat(e.versionNonce));return r}))}}},{key:"dehydrateHistoryEntry",value:function(e){var t=this,n=e.appState,r=e.elements;return{appState:JSON.stringify(n),elements:r.map((function(e){t.elementCache.has(e.id)||t.elementCache.set(e.id,new Map);var n=t.elementCache.get(e.id);return n.has(e.versionNonce)||n.set(e.versionNonce,v(e)),{id:e.id,versionNonce:e.versionNonce}}))}}},{key:"clear",value:function(){this.stateHistory.length=0,this.redoStack.length=0,this.lastEntry=null,this.elementCache.clear()}},{key:"shouldCreateEntry",value:function(e){var t,n=this.lastEntry;if(!n)return!0;if(e.elements.length!==n.elements.length)return!0;for(var r=e.elements.length-1;r>-1;r--){var i=e.elements[r],o=n.elements[r];if(!i||!o||i.id!==o.id||i.versionNonce!==o.versionNonce)return!0}for(t in e.appState){var a,s;if("editingLinearElement"===t)if((null===(a=e.appState[t])||void 0===a?void 0:a.elementId)===(null===(s=n.appState[t])||void 0===s?void 0:s.elementId))continue;if("selectedElementIds"!==t&&"selectedGroupIds"!==t&&e.appState[t]!==n.appState[t])return!0}return!1}},{key:"pushEntry",value:function(e,t){var n=this.generateEntry(e,t),r=this.hydrateHistoryEntry(n);if(r){if(!this.shouldCreateEntry(r))return;this.stateHistory.push(n),this.lastEntry=r,this.clearRedoStack()}}},{key:"clearRedoStack",value:function(){this.redoStack.splice(0,this.redoStack.length)}},{key:"redoOnce",value:function(){if(0===this.redoStack.length)return null;var e=this.redoStack.pop();return void 0!==e?(this.stateHistory.push(e),this.hydrateHistoryEntry(e)):null}},{key:"undoOnce",value:function(){if(1===this.stateHistory.length)return null;var e=this.stateHistory.pop(),t=this.stateHistory[this.stateHistory.length-1];return void 0!==e?(this.redoStack.push(e),this.hydrateHistoryEntry(t)):null}},{key:"setCurrentState",value:function(e,t){this.lastEntry=this.hydrateHistoryEntry(this.generateEntry(e,t))}},{key:"resumeRecording",value:function(){this.recording=!0}},{key:"record",value:function(e,t){this.recording&&(this.pushEntry(e,t),this.recording=!1)}}]),e}(),m=y,g=n(2556),w=JSON.parse(localStorage.getItem("free-draw-elements"))||[],E={offsetLeft:0,offsetTop:0,scrollX:0,scrollY:0,draggingElement:null},x=new m;console.log("history...",x);var k=(0,i.memo)((function(){var e=(0,i.useRef)(null),t=(0,i.useRef)(null);(0,i.useEffect)((function(){var n=e.current,r=n.getContext("2d"),i=n.offsetWidth,o=n.offsetHeight,a=n.offsetLeft,s=n.offsetTop;n.width=i*window.devicePixelRatio,n.height=o*window.devicePixelRatio,r.scale(window.devicePixelRatio,window.devicePixelRatio),E.offsetLeft=a,E.offsetTop=s,f(n,E);var l=t.current,u=function(e){e.preventDefault()};return l.addEventListener("wheel",u,{passive:!1}),function(){l.removeEventListener("wheel",u)}}),[]);var n=function(t){return function(t){var n=(0,o.dE)(t,E);E.draggingElement.points.push([n.x,n.y]),f(e.current,E)}},c=function(e){return function(){window.removeEventListener("pointermove",e.eventListeners.onMove),window.removeEventListener("pointerup",e.eventListeners.onUp)}};return(0,g.jsx)("div",{className:a,children:(0,g.jsxs)("div",{className:l,ref:t,children:[(0,g.jsx)("canvas",{ref:e,className:s,onPointerDown:function(e){var t=(0,o.dE)(e,E),i={origin:t,lastCoords:(0,r.Z)({},t),eventListeners:{onMove:null,onUp:null}},a={x:i.origin.x,y:i.origin.y,points:[[i.origin.x,i.origin.y]],strokeColor:"#000000",backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:(0,o.B8)()};E.draggingElement=a,w.push(a);var s=n(i),l=c(i);window.addEventListener("pointermove",s),window.addEventListener("pointerup",l),i.eventListeners.onMove=s,i.eventListeners.onUp=l},children:"\u7ed8\u5236canvas"}),(0,g.jsxs)("div",{className:u,children:[(0,g.jsx)("button",{children:"\u64a4\u9500"}),(0,g.jsx)("button",{children:"\u91cd\u505a"})]})]})})}))},5204:function(e,t,n){n.d(t,{$9:function(){return u},B8:function(){return l},KP:function(){return d},Pi:function(){return h},TE:function(){return p},dE:function(){return s},kb:function(){return m},mO:function(){return g},qf:function(){return v}});var r=n(9439),i=n(7762),o=n(3433),a=n(4453),s=function(e,t){var n=e.clientX,r=e.clientY,i=t.zoom,o=t.offsetLeft,a=t.offsetTop,s=t.scrollX,l=t.scrollY,u=i?i.value:1;return{x:(n-o)/u-s,y:(r-a)/u-l}},l=function(){var e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),n=Math.floor(256*Math.random());return"rgb(".concat(e,",").concat(t,",").concat(n,")")},u=function(e){return function(e,t){var n=null,r=null,i=null,a=function t(a){n=window.requestAnimationFrame((function(){n=null,e.apply(void 0,(0,o.Z)(a)),r=null,i&&(r=i,i=null,t(r))}))},s=function(){for(var e=arguments.length,o=new Array(e),s=0;s<e;s++)o[s]=arguments[s];r=o,null===n?a(r):null!==t&&void 0!==t&&t.trailing&&(i=o)};return s.flush=function(){null!==n&&(cancelAnimationFrame(n),n=null),r&&(e.apply(void 0,(0,o.Z)(i||r)),r=i=null)},s.cancel=function(){r=i=null,null!==n&&(cancelAnimationFrame(n),n=null)},s}((function(t){(0,a.unstable_batchedUpdates)(e,t)}))},c=function(e){var t=1/0,n=1/0,o=-1/0,a=-1/0,s=e.points;"freedraw"===e.type&&(s=e.points.map((function(t){return[t[0]-e.x,t[1]-e.y]})));var l,u=(0,i.Z)(s);try{for(u.s();!(l=u.n()).done;){var c=(0,r.Z)(l.value,2),f=c[0],h=c[1];t=Math.min(t,f),n=Math.min(n,h),o=Math.max(o,f),a=Math.max(a,h)}}catch(d){u.e(d)}finally{u.f()}return[t,n,o,a]},f=function(e,t,n,r,i){return[(e-n)*Math.cos(i)-(t-r)*Math.sin(i)+n,(e-n)*Math.sin(i)+(t-r)*Math.cos(i)+r]},h=function(e){var t=v(e),n=(0,r.Z)(t,6),i=n[0],o=n[1],a=n[2],s=n[3],l=n[4],u=n[5];if("freedraw"===e.type){var h=c(e),d=(0,r.Z)(h,4),p=d[0],y=d[1],m=d[2],g=d[3];return[p+e.x,y+e.y,m+e.x,g+e.y]}var w=f(i,o,l,u,e.angle),E=(0,r.Z)(w,2),x=E[0],k=E[1],S=f(i,s,l,u,e.angle),M=(0,r.Z)(S,2),b=M[0],C=M[1],L=f(a,s,l,u,e.angle),Z=(0,r.Z)(L,2),H=Z[0],N=Z[1],O=f(a,o,l,u,e.angle),_=(0,r.Z)(O,2),j=_[0],R=_[1];return[Math.min(x,b,H,j),Math.min(k,C,N,R),Math.max(x,b,H,j),Math.max(k,C,N,R)]},d=function(e){if(!e.length)return[0,0,0,0];var t=1/0,n=-1/0,i=1/0,o=-1/0;return e.forEach((function(e){var a=h(e),s=(0,r.Z)(a,4),l=s[0],u=s[1],c=s[2],f=s[3];t=Math.min(t,l),i=Math.min(i,u),n=Math.max(n,c),o=Math.max(o,f)})),[t,i,n,o]},v=function(e){if("freedraw"===e.type){var t=c(e),n=(0,r.Z)(t,4),i=n[0],o=n[1],a=n[2],s=n[3],l=i+e.x,u=o+e.y,f=a+e.x,h=s+e.y;return[l,u,f,h,(l+f)/2,(u+h)/2]}return[e.x,e.y,e.x+e.width,e.y+e.height,e.x+e.width/2,e.y+e.height/2]},p=function(e,t){return Math.abs(e-t)},y=0,m=function(){return"id".concat(y++)},g=function(e){var t=e.fontSize,n=e.fontFamily;return"".concat(t,"px ").concat(n,", Segoe UI Emoji")}}}]);
//# sourceMappingURL=UndoRedo.1743402e.chunk.js.map