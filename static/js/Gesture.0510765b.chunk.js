"use strict";(self.webpackChunkexcalidraw_app=self.webpackChunkexcalidraw_app||[]).push([[408],{3576:function(e,t,n){n.r(t),n.d(t,{default:function(){return x},elements:function(){return h}});var o=n(1413),r=n(2791),i=function(e,t){var n=e.getContext("2d");n.clearRect(0,0,e.width,e.height),function(e,t){var n=t.zoom,o=t.scrollX,r=t.scrollY;e.save();var i=100*n.value,l=100*n.value,a=8*n.value,s=e.canvas,c=o*n.value,u=r*n.value;e.translate(c,u),e.strokeStyle="red",e.fillStyle="red",e.save(),e.beginPath(),e.setLineDash([10,10]),e.moveTo(0,-u),e.lineTo(0,s.height-u),e.moveTo(-c,0),e.lineTo(s.width-c,0),e.stroke(),e.restore(),e.beginPath(),e.lineWidth=2,e.textBaseline="middle";for(var v=0;v<u/i;v++)e.moveTo(0,-v*i),e.lineTo(a,-v*i),e.font="".concat(20*n.value,"px Arial"),e.fillText(-v,-25,-v*i);for(var f=0;f<(s.height-u)/i;f++)e.moveTo(0,f*i),e.lineTo(a,f*i),e.font="".concat(20*n.value,"px Arial"),e.fillText(f,-25,f*i);for(var d=1;d<c/l;d++)e.moveTo(-d*l,0),e.lineTo(-d*l,a),e.font="".concat(20*n.value,"px Arial"),e.fillText(-d,-d*l-10,-15);for(var h=1;h<(s.width-c)/l;h++)e.moveTo(h*l,0),e.lineTo(h*l,a),e.font="".concat(20*n.value,"px Arial"),e.fillText(h,h*l-5,-15);e.stroke(),e.restore()}(n,t),function(e,t){h.forEach((function(n){e.save(),e.scale(t.zoom.value,t.zoom.value),e.translate(n.x+t.scrollX,n.y+t.scrollY),e.strokeStyle=n.strokeStyle,e.strokeColor=n.strokeColor,e.strokeRect(0,0,n.width,n.height),e.restore()}))}(n,t)},l=n(9439),a=function(e){var t=Array.from(e.values());return{x:c(t,(function(e){return e.x}))/t.length,y:c(t,(function(e){return e.y}))/t.length}},s=function(e){var t=(0,l.Z)(e,2),n=t[0],o=t[1];return Math.hypot(n.x-o.x,n.y-o.y)},c=function(e,t){return e.reduce((function(e,n){return e+t(n)}),0)},u=function(e){return Math.max(.1,Math.min(e,30))},v=function(e,t){var n=e.viewportX,o=e.viewportY,r=e.nextZoom,i=n-t.offsetLeft,l=o-t.offsetTop,a=t.zoom.value;return{scrollX:t.scrollX+i/r-i/a,scrollY:t.scrollY+l/r-l/a,zoom:{value:r}}},f=n(184),d={zoom:{value:1},offsetLeft:0,offsetTop:0,scrollX:0,scrollY:0,draggingElement:null},h=[],m=function(e,t){var n=e.clientX,o=e.clientY,r=t.zoom,i=t.offsetLeft,l=t.offsetTop,a=t.scrollX,s=t.scrollY;return{x:(n-i)/r.value-a,y:(o-l)/r.value-s}},p={pointers:new Map,lastCenter:null,initialDistance:null,initialScale:null},x=(0,r.memo)((function(){var e=(0,r.useRef)(null),t=(0,r.useRef)(null),n=(0,r.useRef)({}),l=(0,r.useRef)();(0,r.useEffect)((function(){var t=function(){var t=e.current,n=t.getContext("2d"),o=t.offsetWidth,r=t.offsetHeight,l=t.offsetLeft,a=t.offsetTop;t.width=o*window.devicePixelRatio,t.height=r*window.devicePixelRatio,n.scale(window.devicePixelRatio,window.devicePixelRatio),d.offsetLeft=l,d.offsetTop=a,i(t,d)};t();var n=function(){t()};return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}}),[]),(0,r.useEffect)((function(){var o=t.current,r=function(e){e.preventDefault()};o.addEventListener("wheel",r,{passive:!1});var i=function(e){n.current={cursorX:e.clientX,cursorY:e.clientY}},l=e.current,a=function(e){console.log("touchend.."),e.touches.length||p.pointers.clear()};return l.addEventListener("touchend",a),document.addEventListener("mousemove",i),function(){o.removeEventListener("wheel",r),l.removeEventListener("touchend",a),document.removeEventListener("mousemove",i)}}),[]);var c=function(e){p.pointers.delete(e.pointerId)},x=function(e){return function(t){console.log("pointer up..",t.pointerId),c(t),window.removeEventListener("pointermove",e.eventListeners.onMove),window.removeEventListener("pointerup",e.eventListeners.onUp)}},w=function(t){return function(n){var o=m(n,d);t.lastCoords.x=o.x,t.lastCoords.y=o.y,d.draggingElement.width=o.x-t.origin.x,d.draggingElement.height=o.y-t.origin.y,i(e.current,d)}};return(0,f.jsxs)("div",{className:"gesture",children:[(0,f.jsx)("div",{ref:t,children:(0,f.jsx)("canvas",{ref:e,className:"canvas",onPointerDown:function(e){if(function(e){p.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),2===p.pointers.size&&(p.lastCenter=a(p.pointers),p.initialScale=d.zoom.value,p.initialDistance=s(Array.from(p.pointers.values())))}(e),console.log("pointer down...",p.pointers),!(p.pointers.size>1)){var t=m(e,d);console.log("origin...",d,t);var n={origin:t,lastCoords:(0,o.Z)({},t),eventListeners:{onMove:null,onUp:null}},r={x:n.origin.x,y:n.origin.y,width:0,height:0,strokeColor:"#000000",backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid"};d.draggingElement=r,h.push(r);var i=w(n),l=x(n);window.addEventListener("pointermove",i),window.addEventListener("pointerup",l),n.eventListeners.onMove=i,n.eventListeners.onUp=l}},onPointerCancel:c,onPointerMove:function(t){p.pointers.has(t.pointerId)&&p.pointers.set(t.pointerId,{x:t.clientX,y:t.clientY});var n=p.initialScale;if(2===p.pointers.size&&p.lastCenter&&n&&p.initialDistance){var o=a(p.pointers),r=o.x-p.lastCenter.x,l=o.y-p.lastCenter.y;p.lastCenter=o;var c=s(Array.from(p.pointers.values()))/p.initialDistance,f=c?u(n*c):d.zoom.value,h=v({viewportX:o.x,viewportY:o.y,nextZoom:f},d);Object.assign(d,{zoom:h.zoom,scrollX:h.scrollX+r/f,scrollY:h.scrollY+l/f}),i(e.current,d)}else p.lastCenter=p.initialDistance=p.initialScale=null},onWheel:function(t){var r=t.deltaX,a=t.deltaY;if(t.metaKey||t.ctrlKey){var s=Math.sign(a),c=Math.abs(a),f=a;c>10&&(f=10*s);var h=d.zoom.value-f/100;h+=Math.log10(Math.max(1,d.zoom.value))*-s*Math.min(1,c/20);var m=u(h);return Object.assign(d,(0,o.Z)({},v({viewportX:n.current.cursorX,viewportY:n.current.cursorY,nextZoom:m},d))),l.current.innerText="".concat((100*m).toFixed(0),"%"),void i(e.current,d)}d.scrollX=d.scrollX-r/d.zoom.value,d.scrollY=d.scrollY-a/d.zoom.value,i(e.current,d)},children:"\u7ed8\u5236canvas"})}),(0,f.jsx)("div",{children:(0,f.jsx)("button",{onClick:function(){var e=1/0,t=-1/0,n=1/0,r=-1/0;h.forEach((function(o){var i=[o.x,o.y,o.x+o.width,o.y+o.height],l=i[0],a=i[1],s=i[2],c=i[3];e=Math.min(e,l),n=Math.min(n,a),t=Math.max(t,s),r=Math.max(r,c)}));var l=document.createElement("canvas");l.width=(t-e+20)*window.devicePixelRatio,l.height=(r-n+20)*window.devicePixelRatio,l.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio),i(l,(0,o.Z)((0,o.Z)({},d),{},{scrollX:10-e,scrollY:10-n})),console.log("\u5bfc\u51fa",h);var a=document.createElement("a");a.href=l.toDataURL(),a.download="canvas.png",a.click()},children:"\u5bfc\u51faPNG"})}),(0,f.jsx)("div",{ref:l})]})}))}}]);
//# sourceMappingURL=Gesture.0510765b.chunk.js.map