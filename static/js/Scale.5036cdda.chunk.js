"use strict";(this.webpackChunkexcalidraw_app=this.webpackChunkexcalidraw_app||[]).push([[804],{5951:function(e,t,o){o.r(t),o.d(t,{default:function(){return v},elements:function(){return s}});var n=o(1413),r=o(4519),i=function(e,t){var o=e.getContext("2d");o.clearRect(0,0,e.width,e.height),function(e,t){var o=t.zoom,n=t.scrollX,r=t.scrollY;e.save();var i=100*o.value,a=100*o.value,l=8*o.value,s=e.canvas,c=n*o.value,v=r*o.value;e.translate(c,v),e.strokeStyle="red",e.fillStyle="red",e.save(),e.beginPath(),e.setLineDash([10,10]),e.moveTo(0,-v),e.lineTo(0,s.height-v),e.moveTo(-c,0),e.lineTo(s.width-c,0),e.stroke(),e.restore(),e.beginPath(),e.lineWidth=2,e.textBaseline="middle";for(var u=0;u<v/i;u++)e.moveTo(0,-u*i),e.lineTo(l,-u*i),e.font="".concat(20*o.value,"px Arial"),e.fillText(-u,-25,-u*i);for(var f=0;f<(s.height-v)/i;f++)e.moveTo(0,f*i),e.lineTo(l,f*i),e.font="".concat(20*o.value,"px Arial"),e.fillText(f,-25,f*i);for(var d=1;d<c/a;d++)e.moveTo(-d*a,0),e.lineTo(-d*a,l),e.font="".concat(20*o.value,"px Arial"),e.fillText(-d,-d*a-10,-15);for(var h=1;h<(s.width-c)/a;h++)e.moveTo(h*a,0),e.lineTo(h*a,l),e.font="".concat(20*o.value,"px Arial"),e.fillText(h,h*a-5,-15);e.stroke(),e.restore()}(o,t),function(e,t){s.forEach((function(o){e.save(),e.scale(t.zoom.value,t.zoom.value),e.translate(o.x+t.scrollX,o.y+t.scrollY),e.strokeStyle=o.strokeStyle,e.strokeColor=o.strokeColor,e.strokeRect(0,0,o.width,o.height),e.restore()}))}(o,t)},a=o(2556),l={zoom:{value:1},offsetLeft:0,offsetTop:0,scrollX:0,scrollY:0,draggingElement:null},s=[],c=function(e,t){var o=e.clientX,n=e.clientY,r=t.zoom,i=t.offsetLeft,a=t.offsetTop,l=t.scrollX,s=t.scrollY;return{x:(o-i)/r.value-l,y:(n-a)/r.value-s}},v=(0,r.memo)((function(){var e=(0,r.useRef)(null),t=(0,r.useRef)(null),o=(0,r.useRef)({}),v=(0,r.useRef)();(0,r.useEffect)((function(){var t=function(){var t=e.current,o=t.getContext("2d"),n=t.offsetWidth,r=t.offsetHeight,a=t.offsetLeft,s=t.offsetTop;t.width=n*window.devicePixelRatio,t.height=r*window.devicePixelRatio,o.scale(window.devicePixelRatio,window.devicePixelRatio),l.offsetLeft=a,l.offsetTop=s,i(t,l)};t();var o=function(){t()};return window.addEventListener("resize",o),function(){window.removeEventListener("resize",o)}}),[]),(0,r.useEffect)((function(){var e=t.current,n=function(e){e.preventDefault()};e.addEventListener("wheel",n,{passive:!1});var r=function(e){o.current={cursorX:e.clientX,cursorY:e.clientY}};return document.addEventListener("mousemove",r),function(){e.removeEventListener("wheel",n),document.removeEventListener("mousemove",r)}}),[]);var u=function(e){return function(t){window.removeEventListener("pointermove",e.eventListeners.onMove),window.removeEventListener("pointerup",e.eventListeners.onUp)}},f=function(t){return function(o){var n=c(o,l);t.lastCoords.x=n.x,t.lastCoords.y=n.y,l.draggingElement.width=n.x-t.origin.x,l.draggingElement.height=n.y-t.origin.y,i(e.current,l)}};return(0,a.jsxs)("div",{className:"scale",children:[(0,a.jsx)("div",{ref:t,children:(0,a.jsx)("canvas",{ref:e,className:"canvas",onPointerDown:function(e){var t=c(e,l),o={origin:t,lastCoords:(0,n.Z)({},t),eventListeners:{onMove:null,onUp:null}},r={x:o.origin.x,y:o.origin.y,width:0,height:0,strokeColor:"#000000",backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid"};l.draggingElement=r,s.push(r);var i=f(o),a=u(o);window.addEventListener("pointermove",i),window.addEventListener("pointerup",a),o.eventListeners.onMove=i,o.eventListeners.onUp=a},onWheel:function(t){var r,a=t.deltaX,s=t.deltaY;if(t.metaKey||t.ctrlKey){var c=Math.sign(s),u=Math.abs(s),f=s;u>10&&(f=10*c);var d=l.zoom.value-f/100;d+=Math.log10(Math.max(1,l.zoom.value))*-c*Math.min(1,u/20);var h=(r=d,Math.max(.1,Math.min(r,30)));return Object.assign(l,(0,n.Z)({},function(e,t){var o=e.viewportX,n=e.viewportY,r=e.nextZoom,i=o-t.offsetLeft,a=n-t.offsetTop,l=t.zoom.value;return{scrollX:t.scrollX+i/r-i/l,scrollY:t.scrollY+a/r-a/l,zoom:{value:r}}}({viewportX:o.current.cursorX,viewportY:o.current.cursorY,nextZoom:h},l))),v.current.innerText="".concat((100*h).toFixed(0),"%"),void i(e.current,l)}l.scrollX=l.scrollX-a/l.zoom.value,l.scrollY=l.scrollY-s/l.zoom.value,i(e.current,l)},children:"\u7ed8\u5236canvas"})}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:function(){var e=1/0,t=-1/0,o=1/0,r=-1/0;s.forEach((function(n){var i=[n.x,n.y,n.x+n.width,n.y+n.height],a=i[0],l=i[1],s=i[2],c=i[3];e=Math.min(e,a),o=Math.min(o,l),t=Math.max(t,s),r=Math.max(r,c)}));var a=document.createElement("canvas");a.width=(t-e+20)*window.devicePixelRatio,a.height=(r-o+20)*window.devicePixelRatio,a.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio),i(a,(0,n.Z)((0,n.Z)({},l),{},{scrollX:10-e,scrollY:10-o}));var c=document.createElement("a");c.href=a.toDataURL(),c.download="canvas.png",c.click()},children:"\u5bfc\u51faPNG"})}),(0,a.jsx)("div",{ref:v})]})}))}}]);
//# sourceMappingURL=Scale.5036cdda.chunk.js.map