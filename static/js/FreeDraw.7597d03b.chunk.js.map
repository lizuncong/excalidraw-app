{"version":3,"file":"static/js/FreeDraw.7597d03b.chunk.js","mappings":"+SAkDA,MAvCA,SAAgB,GAAU,IAARA,EAAG,EAAHA,IAChB,GAA4BC,EAAAA,EAAAA,UAAS,IAAG,eAAjCC,EAAM,KAAEC,EAAS,KAQxB,OAPAC,EAAAA,EAAAA,YAAU,WACRC,MAAML,GACHM,MAAK,SAACC,GAAQ,OAAKA,EAASC,MAAM,IAClCF,MAAK,SAACE,GACLL,EAAUK,EACZ,GACJ,GAAG,CAACR,KAEF,gBAAKS,UAAU,gBAAe,UAC5B,SAAC,IAAa,CACZC,SAAUR,EACVS,cAAe,CAACC,EAAAA,GAChBC,cAAe,CAACC,EAAAA,GAChBC,WAAY,CACVC,KAAI,YAAO,EAAJC,KAAgD,IAA1CC,EAAM,EAANA,OAAQT,EAAS,EAATA,UAAWC,EAAQ,EAARA,SAAaS,GAAK,YAC1CC,EAAQ,iBAAiBC,KAAKZ,GAAa,IACjD,OAAQS,GAAUE,GAChB,SAAC,KAAiB,QAChBV,SAAUY,OAAOZ,GAAUa,QAAQ,MAAO,IAE1CC,SAAUJ,EAAM,GAChBX,UAAU,UACVgB,OAAO,OACHN,KAGN,iCAAMV,UAAWA,GAAeU,GAAK,aAClCT,IAGP,MAKV,C,kOCZA,EAPoB,SAACgB,EAAQC,GAC3B,IA5BsBC,EA4BhBC,EAAUH,EAAOI,WAAW,MAClCD,EAAQE,UAAU,EAAG,EAAGL,EAAOM,MAAON,EAAOO,QA7BvBL,EA8BPC,EA5BfK,EAAAA,SAAiB,SAACC,GAChB,IAAMC,EAASD,EAAIC,OACnB,KAAIA,EAAOC,OAAS,GAApB,CAGAT,EAAIU,OACJV,EAAIW,UAAY,EAChBX,EAAIY,SAAW,QACfZ,EAAIa,QAAU,QACdb,EAAIc,YAAcP,EAAIO,YACtBd,EAAIe,YACJ,IAAMC,EAAaR,EAAO,GAC1BR,EAAIiB,OAAOD,EAAW,GAAIA,EAAW,IAErC,IAAK,IAAIE,EAAI,EAAGA,EAAIV,EAAOC,OAAQS,IAAK,CACtC,IAAMC,GAAMX,EAAOU,GAAG,GAAKV,EAAOU,EAAI,GAAG,IAAM,EACzCE,GAAMZ,EAAOU,GAAG,GAAKV,EAAOU,EAAI,GAAG,IAAM,EAC/ClB,EAAIqB,iBAAiBb,EAAOU,EAAI,GAAG,GAAIV,EAAOU,EAAI,GAAG,GAAIC,EAAIC,EAC/D,CAEApB,EAAIsB,SAEJtB,EAAIuB,SAlBJ,CAmBF,GAOF,E,UC3BajB,EAAWkB,KAAKC,MAAMC,aAAaC,QAAQ,wBAA0B,GAC5E5B,EAAW,CACf6B,WAAY,EACZC,UAAW,EACXC,QAAS,EACTC,QAAS,EACTC,gBAAiB,MA4HnB,GA1HeC,EAAAA,EAAAA,OAAK,WAClB,IAAMC,GAAYC,EAAAA,EAAAA,QAAO,MACnBC,GAAkBD,EAAAA,EAAAA,QAAO,MAC/B,GAA0B9D,EAAAA,EAAAA,UAASgE,OAAOC,kBAAiB,eAApDC,EAAK,KAAEC,EAAQ,KAChBC,GAAWN,EAAAA,EAAAA,QAAO,MACxB,GAAwB9D,EAAAA,EAAAA,UAAS,CAAC,GAAE,eAA7BqE,EAAI,KAAEC,EAAO,KACdC,EAAS,SAAC9C,EAAQyC,GACtB,IAAMtC,EAAUH,EAAOI,WAAW,MAC1B2C,EAA8B/C,EAA9B+C,YAAaC,EAAiBhD,EAAjBgD,aACrBhD,EAAOM,MAAQyC,EAAcN,EAC7BzC,EAAOO,OAASyC,EAAeP,EAC/BI,EAAQ,CAAEvC,MAAON,EAAOM,MAAOC,OAAQP,EAAOO,SAC9CJ,EAAQsC,MAAMA,EAAOA,EACvB,EACAE,EAASM,QAAUR,GACnB/D,EAAAA,EAAAA,YAAU,WACR,IAAM+D,EAAQE,EAASM,QAEjBjD,EAASoC,EAAUa,QACjBnB,EAA0B9B,EAA1B8B,WAAYC,EAAc/B,EAAd+B,UAEpBe,EAAO9C,EAAQyC,GACfxC,EAAS6B,WAAaA,EACtB7B,EAAS8B,UAAYA,EACrBmB,EAAYlD,EAAQC,GAGpB,IAAMkD,EAAOb,EAAgBW,QACvBG,EAAc,SAACC,GACnBA,EAAEC,gBACJ,EAKA,OAHAH,EAAKI,iBAAiB,QAASH,EAAa,CAC1CI,SAAS,IAEJ,WACLL,EAAKM,oBAAoB,QAASL,EACpC,CACF,GAAG,CAACT,IACJ,IAiCMe,EACJ,SAACC,GAAgB,OAAK,SAACC,GACrB,IAAMC,GAAgBC,EAAAA,EAAAA,IAA4BF,EAAO3D,GAEzDA,EAASiC,gBAAgBxB,OAAOqD,KAAK,CAACF,EAAcG,EAAGH,EAAcI,IACrEf,EAAYd,EAAUa,QAAShD,EACjC,CAAE,EAEEiE,EAA0C,SAACP,GAAgB,OAAK,WACpEpB,OAAOkB,oBACL,cACAE,EAAiBQ,eAAeC,QAElC7B,OAAOkB,oBACL,YACAE,EAAiBQ,eAAeE,KAEpC,CAAE,EACF,OACE,iBAAKtF,UAAU,YAAW,WACxB,4BACE,sDAAe6D,EAAKtC,MAAK,sBAAMsC,EAAKrC,OAAM,sBAAMqC,EAAKtC,MAAQsC,EAAKrC,WAClE,6DAEE,kBACE+D,KAAK,SACLC,MAAO9B,EACP+B,SAAU,SAACnB,GACT,IAAMoB,EAAIC,OAAOrB,EAAEsB,OAAOJ,OAC1B/D,EAASG,OAAS,EAClB+B,EAAS+B,GACT3B,EAAOV,EAAUa,QAASwB,EAC5B,WAIN,gBAAK1F,UAAU,YAAY6F,IAAKtC,EAAgB,UAC9C,mBACEsC,IAAKxC,EACLrD,UAAU,SACV8F,cAzEwB,SAACjB,GAC/B,IAAMkB,GAAShB,EAAAA,EAAAA,IAA4BF,EAAO3D,GAE5C0D,EAAmB,CACvBmB,OAAAA,EACAC,YAAW,UAAMD,GACjBX,eAAgB,CACdC,OAAQ,KACRC,KAAM,OAGJW,EAAU,CACdhB,EAAGL,EAAiBmB,OAAOd,EAC3BC,EAAGN,EAAiBmB,OAAOb,EAC3BvD,OAAQ,CAAC,CAACiD,EAAiBmB,OAAOd,EAAGL,EAAiBmB,OAAOb,IAC7DgB,YAAa,UACbC,gBAAiB,cACjBC,UAAW,UACXC,YAAa,EACbpE,YAAa,SAEff,EAASiC,gBAAkB8C,EAC3BxE,EAASuD,KAAKiB,GAEd,IAAMK,EACJ3B,EAA0CC,GACtC2B,EACJpB,EAAwCP,GAC1CpB,OAAOgB,iBAAiB,cAAe8B,GACvC9C,OAAOgB,iBAAiB,YAAa+B,GACrC3B,EAAiBQ,eAAeC,OAASiB,EACzC1B,EAAiBQ,eAAeE,KAAOiB,CACzC,EAyC+C,mCAK3C,SAAC,IAAQ,CAAChH,IAAKiH,MAGrB,G,ySC7HazB,EAA8B,SAAH,KAGlC,IAFF0B,EAAO,EAAPA,QAASC,EAAO,EAAPA,QACTC,EAAI,EAAJA,KAAM5D,EAAU,EAAVA,WAAYC,EAAS,EAATA,UAAWC,EAAO,EAAPA,QAASC,EAAO,EAAPA,QAElC0D,EAAYD,EAAOA,EAAKnB,MAAQ,EAGtC,MAAO,CAAEP,GAFEwB,EAAU1D,GAAc6D,EAAY3D,EAEnCiC,GADDwB,EAAU1D,GAAa4D,EAAY1D,EAEhD,EAGa2D,EAAM,WACjB,IAAMC,EAAIC,KAAKC,MAAsB,IAAhBD,KAAKE,UACpBC,EAAIH,KAAKC,MAAsB,IAAhBD,KAAKE,UACpBE,EAAIJ,KAAKC,MAAsB,IAAhBD,KAAKE,UAC1B,MAAM,OAAN,OAAcH,EAAC,YAAII,EAAC,YAAIC,EAAC,IAC3B,EAmDaC,EAA8B,SAACC,GAC1C,OAlDyB,SAACC,EAAIC,GAC9B,IAAIC,EAAU,KACVC,EAAW,KACXC,EAAmB,KAEjBC,EAAe,SAAfA,EAAgBC,GACpBJ,EAAUhE,OAAOqE,uBAAsB,WACrCL,EAAU,KACVF,EAAE,qBAAIM,IACNH,EAAW,KACPC,IACFD,EAAWC,EACXA,EAAmB,KACnBC,EAAaF,GAEjB,GACF,EAEMK,EAAM,WAAc,IAAD,uBAATF,EAAI,yBAAJA,EAAI,gBAKlBH,EAAWG,EACK,OAAZJ,EACFG,EAAaF,GACA,OAAJF,QAAI,IAAJA,GAAAA,EAAMQ,WACfL,EAAmBE,EAEvB,EAkBA,OAjBAE,EAAIE,MAAQ,WACM,OAAZR,IACFS,qBAAqBT,GACrBA,EAAU,MAERC,IACFH,EAAE,qBAAKI,GAAoBD,IAC3BA,EAAWC,EAAmB,KAElC,EACAI,EAAII,OAAS,WACXT,EAAWC,EAAmB,KACd,OAAZF,IACFS,qBAAqBT,GACrBA,EAAU,KAEd,EACOM,CACT,CAESK,EAAY,SAACtD,IAClBuD,EAAAA,EAAAA,yBAAwBf,EAAMxC,EAChC,GACF,EAEawD,EAAsB,SAACpC,GAClC,IAAIqC,EAAOC,IACPC,EAAOD,IACPE,GAAQF,IACRG,GAAQH,IACR5G,EAASsE,EAAQtE,OACA,aAAjBsE,EAAQV,OACV5D,EAASsE,EAAQtE,OAAOgH,KAAI,SAACC,GAC3B,MAAO,CAACA,EAAE,GAAK3C,EAAQhB,EAAG2D,EAAE,GAAK3C,EAAQf,EAC3C,KACD,IAC0B,EAD1B,UACoBvD,GAAM,IAA3B,2BAA6B,CAAC,IAAD,qBAAjBsD,EAAC,KAAEC,EAAC,KACdoD,EAAOvB,KAAK8B,IAAIP,EAAMrD,GACtBuD,EAAOzB,KAAK8B,IAAIL,EAAMtD,GACtBuD,EAAO1B,KAAK+B,IAAIL,EAAMxD,GACtByD,EAAO3B,KAAK+B,IAAIJ,EAAMxD,EACxB,CAAC,+BAED,MAAO,CAACoD,EAAME,EAAMC,EAAMC,EAC5B,EAEaK,EAAS,SAACC,EAAIC,EAAIC,EAAIC,EAAIC,GAAK,MAC1C,EAIGJ,EAAKE,GAAMnC,KAAKsC,IAAID,IAAUH,EAAKE,GAAMpC,KAAKuC,IAAIF,GAASF,GAC3DF,EAAKE,GAAMnC,KAAKuC,IAAIF,IAAUH,EAAKE,GAAMpC,KAAKsC,IAAID,GAASD,EAC7D,EAEUI,EAAmB,SAACtD,GAC/B,IAEA,EAAiCuD,EAAyBvD,GAAQ,eAA3D+C,EAAE,KAAEC,EAAE,KAAEC,EAAE,KAAEC,EAAE,KAAEM,EAAE,KAAEC,EAAE,KAE7B,GAAqB,aAAjBzD,EAAQV,KAAqB,CAC/B,MAAiC8C,EAAoBpC,GAAQ,eAAtDqC,EAAI,KAAEE,EAAI,KAAEC,EAAI,KAAEC,EAAI,KAE7B,MAAO,CACLJ,EAAOrC,EAAQhB,EACfuD,EAAOvC,EAAQf,EACfuD,EAAOxC,EAAQhB,EACfyD,EAAOzC,EAAQf,EAEnB,CACE,MAAmB6D,EAAOC,EAAIC,EAAIQ,EAAIC,EAAIzD,EAAQmD,OAAM,eAAjDO,EAAG,KAAEC,EAAG,KACf,EAAmBb,EAAOC,EAAIG,EAAIM,EAAIC,EAAIzD,EAAQmD,OAAM,eAAjDS,EAAG,KAAEC,EAAG,KACf,EAAmBf,EAAOG,EAAIC,EAAIM,EAAIC,EAAIzD,EAAQmD,OAAM,eAAjDW,EAAG,KAAEC,EAAG,KACf,EAAmBjB,EAAOG,EAAID,EAAIQ,EAAIC,EAAIzD,EAAQmD,OAAM,eAAjDa,EAAG,KAAEC,EAAG,KAQjB,MAHW,CAJInD,KAAK8B,IAAIc,EAAKE,EAAKE,EAAKE,GACxBlD,KAAK8B,IAAIe,EAAKE,EAAKE,EAAKE,GACxBnD,KAAK+B,IAAIa,EAAKE,EAAKE,EAAKE,GACxBlD,KAAK+B,IAAIc,EAAKE,EAAKE,EAAKE,GAKzC,EACaC,EAAkB,SAAC1I,GAC9B,IAAKA,EAASG,OACZ,MAAO,CAAC,EAAG,EAAG,EAAG,GAGnB,IAAI0G,EAAOC,IACPE,GAAQF,IACRC,EAAOD,IACPG,GAAQH,IAUZ,OARA9G,EAAS2I,SAAQ,SAACnE,GAChB,MAAyBsD,EAAiBtD,GAAQ,eAA3C+C,EAAE,KAAEC,EAAE,KAAEC,EAAE,KAAEC,EAAE,KACrBb,EAAOvB,KAAK8B,IAAIP,EAAMU,GACtBR,EAAOzB,KAAK8B,IAAIL,EAAMS,GACtBR,EAAO1B,KAAK+B,IAAIL,EAAMS,GACtBR,EAAO3B,KAAK+B,IAAIJ,EAAMS,EACxB,IAEO,CAACb,EAAME,EAAMC,EAAMC,EAC5B,EACac,EAA2B,SAACvD,GACvC,GAAqB,aAAjBA,EAAQV,KAAqB,CAC/B,MAAiC8C,EAAoBpC,GAAQ,eAAtDqC,EAAI,KAAEE,EAAI,KAAEC,EAAI,KAAEC,EAAI,KACvBM,EAAKV,EAAOrC,EAAQhB,EACpBgE,EAAKT,EAAOvC,EAAQf,EACpBgE,EAAKT,EAAOxC,EAAQhB,EACpBkE,EAAKT,EAAOzC,EAAQf,EAC1B,MAAO,CAAC8D,EAAIC,EAAIC,EAAIC,GAAKH,EAAKE,GAAM,GAAID,EAAKE,GAAM,EACrD,CACA,MAAO,CACLlD,EAAQhB,EACRgB,EAAQf,EACRe,EAAQhB,EAAIgB,EAAQ1E,MACpB0E,EAAQf,EAAIe,EAAQzE,OACpByE,EAAQhB,EAAIgB,EAAQ1E,MAAQ,EAC5B0E,EAAQf,EAAIe,EAAQzE,OAAS,EAEjC,EAEa6I,EAAW,SAACpF,EAAGC,GAAC,OAAK6B,KAAKuD,IAAIrF,EAAIC,EAAG,EAW9CqF,EAAa,EACJC,EAAW,WAAH,kBAAcD,IAAY,EAgDlCE,EAAgB,SAAH,GAAkC,IAA5BC,EAAQ,EAARA,SAAUC,EAAU,EAAVA,WACxC,MAAM,GAAN,OAAUD,EAAQ,cAAMC,EAAU,mBACpC,C","sources":["components/markdown/index.jsx","pages/free-draw/base/renderScene.js","pages/free-draw/base/index.jsx","util/index.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport remarkGfm from \"remark-gfm\";\nimport { Prism as SyntaxHighlighter } from \"react-syntax-highlighter\";\nimport rehypeRaw from \"rehype-raw\";\n// import { tomorrow } from \"react-syntax-highlighter/dist/esm/styles/prism\";\nimport \"github-markdown-css\";\n\nimport './index.less'\n\n\nfunction Shapes({ src }) {\n  const [mdText, setMdText] = useState(\"\");\n  useEffect(() => {\n    fetch(src)\n      .then((response) => response.text())\n      .then((text) => {\n        setMdText(text);\n      });\n  }, [src]);\n  return (\n    <div className=\"markdown-body\">\n      <ReactMarkdown\n        children={mdText}\n        rehypePlugins={[rehypeRaw]}\n        remarkPlugins={[remarkGfm]}\n        components={{\n          code({ node, inline, className, children, ...props }) {\n            const match = /language-(\\w+)/.exec(className || \"\");\n            return !inline && match ? (\n              <SyntaxHighlighter\n                children={String(children).replace(/\\n$/, \"\")}\n                // style={{ background: 'red'}}\n                language={match[1]}\n                className=\"my-code\"\n                PreTag=\"div\"\n                {...props}\n              />\n            ) : (\n              <code className={className} {...props}>\n                {children}\n              </code>\n            );\n          },\n        }}\n      />\n    </div>\n  );\n}\n\nexport default Shapes;\n","import { elements } from \"./index\";\n\nconst renderElements = (ctx, appState) => {\n\n  elements.forEach((ele) => {\n    const points = ele.points;\n    if (points.length < 2) {\n      return;\n    }\n    ctx.save();\n    ctx.lineWidth = 4;\n    ctx.lineJoin = \"round\";\n    ctx.lineCap = \"round\";\n    ctx.strokeStyle = ele.strokeStyle;\n    ctx.beginPath();\n    const firstPoint = points[0]\n    ctx.moveTo(firstPoint[0], firstPoint[1]);\n\n    for (let i = 1; i < points.length; i++) {\n      const xc = (points[i][0] + points[i - 1][0]) / 2;\n      const yc = (points[i][1] + points[i - 1][1]) / 2;\n      ctx.quadraticCurveTo(points[i - 1][0], points[i - 1][1], xc, yc);\n    }\n\n    ctx.stroke();\n\n    ctx.restore();\n  });\n};\nconst renderScene = (canvas, appState) => {\n  const context = canvas.getContext(\"2d\");\n  context.clearRect(0, 0, canvas.width, canvas.height);\n  renderElements(context, appState);\n  // localStorage.setItem(\"free-draw-elements\", JSON.stringify(elements));\n};\n\nexport default renderScene;\n","import React, { memo, useState, useRef, useEffect } from \"react\";\nimport { viewportCoordsToSceneCoords } from \"@/util\";\nimport MarkDown from \"@/components/markdown\";\nimport doc from \"@doc/canvas进阶/自由绘制.md\";\nimport \"./index.less\";\nimport renderScene from \"./renderScene\";\n\nexport const elements = JSON.parse(localStorage.getItem(\"free-draw-elements\")) || [];\nconst appState = {\n  offsetLeft: 0,\n  offsetTop: 0,\n  scrollX: 0,\n  scrollY: 0,\n  draggingElement: null,\n};\nconst Canvas = memo(() => {\n  const canvasRef = useRef(null);\n  const canvasContainer = useRef(null);\n  const [scale, setScale] = useState(window.devicePixelRatio)\n  const scaleRef = useRef(null);\n  const [size, setSize] = useState({})\n  const resize = (canvas, scale) => {\n    const context = canvas.getContext(\"2d\");\n    const { offsetWidth, offsetHeight } = canvas;\n    canvas.width = offsetWidth * scale;\n    canvas.height = offsetHeight * scale;\n    setSize({ width: canvas.width, height: canvas.height })\n    context.scale(scale, scale);\n  }\n  scaleRef.current = scale;\n  useEffect(() => {\n    const scale = scaleRef.current;\n    // canvas分辨率矫正\n    const canvas = canvasRef.current;\n    const { offsetLeft, offsetTop } = canvas;\n\n    resize(canvas, scale)\n    appState.offsetLeft = offsetLeft;\n    appState.offsetTop = offsetTop;\n    renderScene(canvas, appState);\n\n    // 防止双指滑动时切换页面\n    const wrap = canvasContainer.current;\n    const handleWheel = (e) => {\n      e.preventDefault();\n    };\n    // 防止双指滑动时切换页面\n    wrap.addEventListener(\"wheel\", handleWheel, {\n      passive: false,\n    });\n    return () => {\n      wrap.removeEventListener(\"wheel\", handleWheel);\n    };\n  }, [scaleRef]);\n  const handleCanvasPointerDown = (event) => {\n    const origin = viewportCoordsToSceneCoords(event, appState);\n\n    const pointerDownState = {\n      origin,\n      lastCoords: { ...origin },\n      eventListeners: {\n        onMove: null,\n        onUp: null,\n      },\n    };\n    const element = {\n      x: pointerDownState.origin.x,\n      y: pointerDownState.origin.y,\n      points: [[pointerDownState.origin.x, pointerDownState.origin.y]],\n      strokeColor: \"#000000\",\n      backgroundColor: \"transparent\",\n      fillStyle: \"hachure\",\n      strokeWidth: 1,\n      strokeStyle: 'black',\n    };\n    appState.draggingElement = element;\n    elements.push(element);\n\n    const onPointerMove =\n      onPointerMoveFromCanvasPointerDownHandler(pointerDownState);\n    const onPointerUp =\n      onPointerUpFromCanvasPointerDownHandler(pointerDownState);\n    window.addEventListener(\"pointermove\", onPointerMove);\n    window.addEventListener(\"pointerup\", onPointerUp);\n    pointerDownState.eventListeners.onMove = onPointerMove;\n    pointerDownState.eventListeners.onUp = onPointerUp;\n  };\n  const onPointerMoveFromCanvasPointerDownHandler =\n    (pointerDownState) => (event) => {\n      const pointerCoords = viewportCoordsToSceneCoords(event, appState);\n\n      appState.draggingElement.points.push([pointerCoords.x, pointerCoords.y]);\n      renderScene(canvasRef.current, appState);\n    };\n\n  const onPointerUpFromCanvasPointerDownHandler = (pointerDownState) => () => {\n    window.removeEventListener(\n      \"pointermove\",\n      pointerDownState.eventListeners.onMove\n    );\n    window.removeEventListener(\n      \"pointerup\",\n      pointerDownState.eventListeners.onUp\n    );\n  };\n  return (\n    <div className=\"free-draw\">\n      <div>\n        <div>canvas宽度：{size.width} 高度：{size.height} 面积：{size.width * size.height}</div>\n        <div>\n          当前系数：\n          <input\n            type=\"number\"\n            value={scale}\n            onChange={(e) => {\n              const v = Number(e.target.value)\n              elements.length = 0\n              setScale(v)\n              resize(canvasRef.current, v)\n            }}\n          />\n        </div>\n      </div>\n      <div className=\"container\" ref={canvasContainer}>\n        <canvas\n          ref={canvasRef}\n          className=\"canvas\"\n          onPointerDown={handleCanvasPointerDown}\n        >\n          绘制canvas\n        </canvas>\n      </div>\n      <MarkDown src={doc} />\n    </div>\n  );\n});\n\nexport default Canvas;\n","import { unstable_batchedUpdates } from \"react-dom\";\n\nexport const sceneCoordsToViewportCoords = (\n  { sceneX, sceneY },\n  { offsetLeft, offsetTop, scrollX, scrollY }\n) => {\n  const x = sceneX + scrollX + offsetLeft;\n  const y = sceneY + scrollY + offsetTop;\n  return { x, y };\n};\nexport const viewportCoordsToSceneCoords = (\n  { clientX, clientY },\n  { zoom, offsetLeft, offsetTop, scrollX, scrollY }\n) => {\n  const zoomValue = zoom ? zoom.value : 1;\n  const x = (clientX - offsetLeft) / zoomValue - scrollX;\n  const y = (clientY - offsetTop) / zoomValue - scrollY;\n  return { x, y };\n};\n\n//rgb颜色随机\nexport const rgb = () => {\n  const r = Math.floor(Math.random() * 256);\n  const g = Math.floor(Math.random() * 256);\n  const b = Math.floor(Math.random() * 256);\n  return `rgb(${r},${g},${b})`;\n};\n\nexport const throttleRAF = (fn, opts) => {\n  let timerId = null;\n  let lastArgs = null;\n  let lastArgsTrailing = null;\n\n  const scheduleFunc = (args) => {\n    timerId = window.requestAnimationFrame(() => {\n      timerId = null;\n      fn(...args);\n      lastArgs = null;\n      if (lastArgsTrailing) {\n        lastArgs = lastArgsTrailing;\n        lastArgsTrailing = null;\n        scheduleFunc(lastArgs);\n      }\n    });\n  };\n\n  const ret = (...args) => {\n    if (process.env.NODE_ENV === \"test\") {\n      fn(...args);\n      return;\n    }\n    lastArgs = args;\n    if (timerId === null) {\n      scheduleFunc(lastArgs);\n    } else if (opts?.trailing) {\n      lastArgsTrailing = args;\n    }\n  };\n  ret.flush = () => {\n    if (timerId !== null) {\n      cancelAnimationFrame(timerId);\n      timerId = null;\n    }\n    if (lastArgs) {\n      fn(...(lastArgsTrailing || lastArgs));\n      lastArgs = lastArgsTrailing = null;\n    }\n  };\n  ret.cancel = () => {\n    lastArgs = lastArgsTrailing = null;\n    if (timerId !== null) {\n      cancelAnimationFrame(timerId);\n      timerId = null;\n    }\n  };\n  return ret;\n};\nexport const withBatchedUpdatesThrottled = (func) => {\n  return throttleRAF((event) => {\n    unstable_batchedUpdates(func, event);\n  });\n};\n\nexport const getBoundsFromPoints = (element) => {\n  let minX = Infinity;\n  let minY = Infinity;\n  let maxX = -Infinity;\n  let maxY = -Infinity;\n  let points = element.points;\n  if (element.type === \"freedraw\") {\n    points = element.points.map((p) => {\n      return [p[0] - element.x, p[1] - element.y];\n    });\n  }\n  for (const [x, y] of points) {\n    minX = Math.min(minX, x);\n    minY = Math.min(minY, y);\n    maxX = Math.max(maxX, x);\n    maxY = Math.max(maxY, y);\n  }\n\n  return [minX, minY, maxX, maxY];\n};\n\nexport const rotate = (x1, y1, x2, y2, angle) =>\n  // 𝑎′𝑥=(𝑎𝑥−𝑐𝑥)cos𝜃−(𝑎𝑦−𝑐𝑦)sin𝜃+𝑐𝑥\n  // 𝑎′𝑦=(𝑎𝑥−𝑐𝑥)sin𝜃+(𝑎𝑦−𝑐𝑦)cos𝜃+𝑐𝑦.\n  // https://math.stackexchange.com/questions/2204520/how-do-i-rotate-a-line-segment-in-a-specific-point-on-the-line\n  [\n    (x1 - x2) * Math.cos(angle) - (y1 - y2) * Math.sin(angle) + x2,\n    (x1 - x2) * Math.sin(angle) + (y1 - y2) * Math.cos(angle) + y2,\n  ];\n\nexport const getElementBounds = (element) => {\n  let bounds;\n\n  const [x1, y1, x2, y2, cx, cy] = getElementAbsoluteCoords(element);\n\n  if (element.type === \"freedraw\") {\n    const [minX, minY, maxX, maxY] = getBoundsFromPoints(element);\n\n    return [\n      minX + element.x,\n      minY + element.y,\n      maxX + element.x,\n      maxY + element.y,\n    ];\n  } else {\n    const [x11, y11] = rotate(x1, y1, cx, cy, element.angle);\n    const [x12, y12] = rotate(x1, y2, cx, cy, element.angle);\n    const [x22, y22] = rotate(x2, y2, cx, cy, element.angle);\n    const [x21, y21] = rotate(x2, y1, cx, cy, element.angle);\n    const minX = Math.min(x11, x12, x22, x21);\n    const minY = Math.min(y11, y12, y22, y21);\n    const maxX = Math.max(x11, x12, x22, x21);\n    const maxY = Math.max(y11, y12, y22, y21);\n    bounds = [minX, minY, maxX, maxY];\n  }\n\n  return bounds;\n};\nexport const getCommonBounds = (elements) => {\n  if (!elements.length) {\n    return [0, 0, 0, 0];\n  }\n\n  let minX = Infinity;\n  let maxX = -Infinity;\n  let minY = Infinity;\n  let maxY = -Infinity;\n\n  elements.forEach((element) => {\n    const [x1, y1, x2, y2] = getElementBounds(element);\n    minX = Math.min(minX, x1);\n    minY = Math.min(minY, y1);\n    maxX = Math.max(maxX, x2);\n    maxY = Math.max(maxY, y2);\n  });\n\n  return [minX, minY, maxX, maxY];\n};\nexport const getElementAbsoluteCoords = (element) => {\n  if (element.type === \"freedraw\") {\n    const [minX, minY, maxX, maxY] = getBoundsFromPoints(element);\n    const x1 = minX + element.x;\n    const y1 = minY + element.y;\n    const x2 = maxX + element.x;\n    const y2 = maxY + element.y;\n    return [x1, y1, x2, y2, (x1 + x2) / 2, (y1 + y2) / 2];\n  }\n  return [\n    element.x,\n    element.y,\n    element.x + element.width,\n    element.y + element.height,\n    element.x + element.width / 2,\n    element.y + element.height / 2,\n  ];\n};\n\nexport const distance = (x, y) => Math.abs(x - y);\n\nexport const getSizeFromPoints = (points) => {\n  const xs = points.map((point) => point[0]);\n  const ys = points.map((point) => point[1]);\n  return {\n    width: Math.max(...xs) - Math.min(...xs),\n    height: Math.max(...ys) - Math.min(...ys),\n  };\n};\n\nlet testIdBase = 0;\nexport const randomId = () => `id${testIdBase++}`;\nexport const randomInteger = () => Math.floor(Math.random() * 2 ** 31);\n\nexport const generateExcalidrawElements = () => {\n  const freeDrawElements =\n    JSON.parse(localStorage.getItem(\"free-draw-elements\")) || [];\n  const result = freeDrawElements.map((ele) => {\n    const points = ele.points.map((p) => {\n      return [p[0] - ele.x, p[1] - ele.y];\n    });\n    const { width, height } = getSizeFromPoints(points);\n    return {\n      id: randomId(),\n      type: \"freedraw\",\n      x: ele.x,\n      y: ele.y,\n      width: width,\n      height: height,\n      angle: 0,\n      strokeColor: ele.strokeStyle,\n      backgroundColor: \"transparent\",\n      fillStyle: \"hachure\",\n      strokeWidth: 1,\n      strokeStyle: \"solid\",\n      roughness: 1,\n      opacity: 100,\n      groupIds: [],\n      roundness: null,\n      seed: randomInteger(),\n      version: 1,\n      versionNonce: 0,\n      isDeleted: false,\n      boundElements: null,\n      updated: Date.now(),\n      link: null,\n      locked: false,\n      points: points,\n      pressures: [],\n      simulatePressure: true,\n      lastCommittedPoint: points[points.length - 1],\n    };\n  });\n  return result;\n};\n\n// for worker\n// window.__generateExcalidrawElements = generateExcalidrawElements;\n\nexport const getFontString = ({ fontSize, fontFamily }) => {\n  return `${fontSize}px ${fontFamily}, Segoe UI Emoji`;\n};\n"],"names":["src","useState","mdText","setMdText","useEffect","fetch","then","response","text","className","children","rehypePlugins","rehypeRaw","remarkPlugins","remarkGfm","components","code","node","inline","props","match","exec","String","replace","language","PreTag","canvas","appState","ctx","context","getContext","clearRect","width","height","elements","ele","points","length","save","lineWidth","lineJoin","lineCap","strokeStyle","beginPath","firstPoint","moveTo","i","xc","yc","quadraticCurveTo","stroke","restore","JSON","parse","localStorage","getItem","offsetLeft","offsetTop","scrollX","scrollY","draggingElement","memo","canvasRef","useRef","canvasContainer","window","devicePixelRatio","scale","setScale","scaleRef","size","setSize","resize","offsetWidth","offsetHeight","current","renderScene","wrap","handleWheel","e","preventDefault","addEventListener","passive","removeEventListener","onPointerMoveFromCanvasPointerDownHandler","pointerDownState","event","pointerCoords","viewportCoordsToSceneCoords","push","x","y","onPointerUpFromCanvasPointerDownHandler","eventListeners","onMove","onUp","type","value","onChange","v","Number","target","ref","onPointerDown","origin","lastCoords","element","strokeColor","backgroundColor","fillStyle","strokeWidth","onPointerMove","onPointerUp","doc","clientX","clientY","zoom","zoomValue","rgb","r","Math","floor","random","g","b","withBatchedUpdatesThrottled","func","fn","opts","timerId","lastArgs","lastArgsTrailing","scheduleFunc","args","requestAnimationFrame","ret","trailing","flush","cancelAnimationFrame","cancel","throttleRAF","unstable_batchedUpdates","getBoundsFromPoints","minX","Infinity","minY","maxX","maxY","map","p","min","max","rotate","x1","y1","x2","y2","angle","cos","sin","getElementBounds","getElementAbsoluteCoords","cx","cy","x11","y11","x12","y12","x22","y22","x21","y21","getCommonBounds","forEach","distance","abs","testIdBase","randomId","getFontString","fontSize","fontFamily"],"sourceRoot":""}