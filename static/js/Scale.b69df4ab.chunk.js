"use strict";(self.webpackChunkexcalidraw_app=self.webpackChunkexcalidraw_app||[]).push([[804],{9418:function(e,t,o){o.r(t),o.d(t,{default:function(){return f},elements:function(){return c}});var n=o(1413),r=o(2791),i=function(e,t){var o=e.getContext("2d");o.clearRect(0,0,e.width,e.height),function(e,t){var o=t.scrollX,n=t.scrollY;e.save();var r=100,i=100,l=e.canvas;e.translate(o,n),e.strokeStyle="red",e.fillStyle="red",e.save(),e.beginPath(),e.setLineDash([10,10]),e.moveTo(0,-n),e.lineTo(0,l.height-n),e.moveTo(-o,0),e.lineTo(l.width-o,0),e.stroke(),e.restore(),e.beginPath(),e.lineWidth=2,e.textBaseline="middle";for(var a=0;a<n/r;a++)e.moveTo(0,-a*r),e.lineTo(8,-a*r),e.font="20px Arial",e.fillText(-a,-25,-a*r);for(var s=0;s<(l.height-n)/r;s++)e.moveTo(0,s*r),e.lineTo(8,s*r),e.font="20px Arial",e.fillText(s,-25,s*r);for(var c=1;c<o/i;c++)e.moveTo(-c*i,0),e.lineTo(-c*i,8),e.font="20px Arial",e.fillText(-c,-c*i-10,-15);for(var v=1;v<(l.width-o)/i;v++)e.moveTo(v*i,0),e.lineTo(v*i,8),e.font="20px Arial",e.fillText(v,v*i-5,-15);e.stroke(),e.restore()}(o,t),function(e,t){c.forEach((function(o){e.save(),e.translate(o.x+t.scrollX,o.y+t.scrollY),e.strokeStyle=o.strokeStyle,e.strokeColor=o.strokeColor,e.strokeRect(0,0,o.width,o.height),e.restore()}))}(o,t)},l=function(e){return Math.max(.1,Math.min(e,30))},a=o(184),s={zoom:{value:1},offsetLeft:0,offsetTop:0,scrollX:0,scrollY:0,draggingElement:null},c=[],v=function(e,t){var o=e.clientX,n=e.clientY,r=t.offsetLeft,i=t.offsetTop;return{x:o-r-t.scrollX,y:n-i-t.scrollY}},f=(0,r.memo)((function(){var e=(0,r.useRef)(null),t=(0,r.useRef)(null),o=(0,r.useRef)({});(0,r.useEffect)((function(){var t=function(){var t=e.current,o=t.getContext("2d"),n=t.offsetWidth,r=t.offsetHeight,l=t.offsetLeft,a=t.offsetTop;t.width=n*window.devicePixelRatio,t.height=r*window.devicePixelRatio,o.scale(window.devicePixelRatio,window.devicePixelRatio),s.offsetLeft=l,s.offsetTop=a,i(t,s)};t();var o=function(){t()};return window.addEventListener("resize",o),function(){window.removeEventListener("resize",o)}}),[]),(0,r.useEffect)((function(){var e=t.current,n=function(e){e.preventDefault()};e.addEventListener("wheel",n,{passive:!1});var r=function(e){o.current={cursorX:e.clientX,cursorY:e.clientY}};return document.addEventListener("mousemove",r),function(){e.removeEventListener("wheel",n),document.removeEventListener("mousemove",r)}}),[]);var f=function(e){return function(t){window.removeEventListener("pointermove",e.eventListeners.onMove),window.removeEventListener("pointerup",e.eventListeners.onUp)}},u=function(t){return function(o){var n=v(o,s);t.lastCoords.x=n.x,t.lastCoords.y=n.y,s.draggingElement.width=n.x-t.origin.x,s.draggingElement.height=n.y-t.origin.y,i(e.current,s)}};return(0,a.jsxs)("div",{className:"infinite-canvas",children:[(0,a.jsx)("div",{ref:t,children:(0,a.jsx)("canvas",{ref:e,className:"canvas",onPointerDown:function(e){var t=v(e,s);console.log("origin...",s,t);var o={origin:t,lastCoords:(0,n.Z)({},t),eventListeners:{onMove:null,onUp:null}},r={x:o.origin.x,y:o.origin.y,width:0,height:0,strokeColor:"#000000",backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid"};s.draggingElement=r,c.push(r);var i=u(o),l=f(o);window.addEventListener("pointermove",i),window.addEventListener("pointerup",l),o.eventListeners.onMove=i,o.eventListeners.onUp=l},onWheel:function(t){var r=t.deltaX,a=t.deltaY;if(t.metaKey||t.ctrlKey){var c=Math.sign(a),v=Math.abs(a),f=a;v>10&&(f=10*c);var u=s.zoom.value-f/100;return u+=Math.log10(Math.max(1,s.zoom.value))*-c*Math.min(1,v/20),console.log("newZoom...",l(u)),void Object.assign(s,(0,n.Z)({},function(e,t){var o=e.viewportX,n=e.viewportY,r=e.nextZoom,i=o-t.offsetLeft,l=n-t.offsetTop,a=t.zoom.value;return{scrollX:t.scrollX+(i-i/a)+-(i-i/r),scrollY:t.scrollY+(l-l/a)+-(l-l/r),zoom:{value:r}}}({viewportX:o.current.cursorX,viewportY:o.current.cursorY,nextZoom:l(u)},s)))}s.scrollX=s.scrollX-r,s.scrollY=s.scrollY-a,i(e.current,s)},children:"\u7ed8\u5236canvas"})}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:function(){var e=1/0,t=-1/0,o=1/0,r=-1/0;c.forEach((function(n){var i=[n.x,n.y,n.x+n.width,n.y+n.height],l=i[0],a=i[1],s=i[2],c=i[3];e=Math.min(e,l),o=Math.min(o,a),t=Math.max(t,s),r=Math.max(r,c)}));var l=document.createElement("canvas");l.width=(t-e+20)*window.devicePixelRatio,l.height=(r-o+20)*window.devicePixelRatio,l.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio),i(l,(0,n.Z)((0,n.Z)({},s),{},{scrollX:10-e,scrollY:10-o})),console.log("\u5bfc\u51fa",c);var a=document.createElement("a");a.href=l.toDataURL(),a.download="canvas.png",a.click()},children:"\u5bfc\u51faPNG"})})]})}))}}]);
//# sourceMappingURL=Scale.b69df4ab.chunk.js.map