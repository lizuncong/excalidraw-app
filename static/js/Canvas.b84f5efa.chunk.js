"use strict";(self.webpackChunkexcalidraw_app=self.webpackChunkexcalidraw_app||[]).push([[343],{9040:function(e,t,o){o.r(t),o.d(t,{default:function(){return L}});var n=o(1413),r=o(3433),l=o(2791),i=function(e,t){var o=e.clientX,n=e.clientY,r=t.offsetLeft,l=t.offsetTop;return{x:o-r-t.scrollX,y:n-l-t.scrollY}},a=function(e,t){return Math.abs(e-t)},s=0,c=o(4925),d=["type","x","y","strokeColor","backgroundColor","fillStyle","strokeWidth","strokeStyle","roughness","opacity","width","height","angle","groupIds","roundness","boundElements","link","locked"],u=new WeakMap,f=new WeakMap,v=function(e){var t=u.get(e);if(void 0===t){if(f.delete(e),"rectangle"!==e.type)throw new Error("Unimplemented type ".concat(e.type));e.roundness,y(e,t)}},g=function(e,t){var o=t.zoom||1,n=f.get(e);return n||p(e,o,t)},h=document.getElementsByClassName("right")[0],m=null,p=function(e,t,o){var n=document.createElement("canvas"),r=n.getContext("2d"),l=k(e);m&&h.removeChild(m),m=n,h.appendChild(m);return n.width=e.width*window.devicePixelRatio*t+l*t*2,n.height=e.height*window.devicePixelRatio*t+l*t*2,r.save(),r.translate(l*t,l*t),r.scale(window.devicePixelRatio*t,window.devicePixelRatio*t),w(e,r,o),r.restore(),{element:e,canvas:n,theme:o.theme,canvasZoom:t,canvasOffsetX:0,canvasOffsetY:0}},w=function(e,t,o){if(t.globalAlpha=e.opacity/100,"rectangle"===e.type)t.lineJoin="round",t.lineCap="round",t.strokeStyle="red",t.strokeRect(0,0,e.width,e.height);t.globalAlpha=1},y=function(e,t){return u.set(e,t)},k=function(e){return"freedraw"===e.type?12*e.strokeWidth:20},x=function(e,t,o){var n=e.element,r=k(n),l=[n.x,n.y,n.x+n.width,n.y+n.height],i=l[0],a=l[1],s=l[2],c=l[3],d=((i+s)/2+o.scrollX)*window.devicePixelRatio,u=((a+c)/2+o.scrollY)*window.devicePixelRatio;t.save(),t.scale(1/window.devicePixelRatio,1/window.devicePixelRatio),t.translate(d,u),t.drawImage(e.canvas,-(s-i)/2*window.devicePixelRatio-r*e.canvasZoom/e.canvasZoom,-(c-a)/2*window.devicePixelRatio-r*e.canvasZoom/e.canvasZoom,e.canvas.width/e.canvasZoom,e.canvas.height/e.canvasZoom),t.restore()},S=function(e){var t=e.elements,o=e.appState,n=e.scale,r=e.canvas,l=e.renderConfig,i=r.getContext("2d");i.save(),console.log("scale====",n,l.zoom),i.scale(n,n);var a=r.width/n,s=r.height/n;i.clearRect(0,0,a,s),i.save(),i.scale(l.zoom,l.zoom),function(e,t){var o=t.scrollX,n=t.scrollY;e.save();var r=100,l=100,i=e.canvas;e.translate(o,n),e.strokeStyle="red",e.fillStyle="red",e.save(),e.beginPath(),e.setLineDash([10,10]),e.moveTo(0,-n),e.lineTo(0,i.height-n),e.moveTo(-o,0),e.lineTo(i.width-o,0),e.stroke(),e.restore(),e.beginPath(),e.lineWidth=2,e.textBaseline="middle";for(var a=0;a<n/r;a++)e.moveTo(0,-a*r),e.lineTo(8,-a*r),e.font="20px Arial",e.fillText(-a,-25,-a*r);for(var s=0;s<(i.height-n)/r;s++)e.moveTo(0,s*r),e.lineTo(8,s*r),e.font="20px Arial",e.fillText(s,-25,s*r);for(var c=1;c<o/l;c++)e.moveTo(-c*l,0),e.lineTo(-c*l,8),e.font="20px Arial",e.fillText(-c,-c*l-10,-15);for(var d=1;d<(i.width-o)/l;d++)e.moveTo(d*l,0),e.lineTo(d*l,8),e.font="20px Arial",e.fillText(d,d*l-5,-15);e.stroke(),e.restore()}(i,l),t.forEach((function(e){!function(e,t,o,n){if("rectangle"!==e.type)throw new Error("Unimplemented type ".concat(e.type));v(e);var r=g(e,o);x(r,t,o)}(e,i,l)})),i.restore(),i.restore(),localStorage.setItem("elements",JSON.stringify(t)),localStorage.setItem("appState",JSON.stringify(o))},C=o(5671),I=o(3144),E=function(){function e(){(0,C.Z)(this,e);var t=JSON.parse(localStorage.getItem("elements"));this.elements=t||[]}return(0,I.Z)(e,[{key:"getElementsIncludingDeleted",value:function(){return this.elements}},{key:"replaceAllElements",value:function(e){this.elements=e}}]),e}(),R=o(184),T=new E,P=JSON.parse(localStorage.getItem("appState"))||{scrollX:0,scrollY:0,offsetLeft:0,offsetTop:0,draggingElement:null,currentItemStrokeColor:"#000000",currentItemBackgroundColor:"transparent",currentItemFillStyle:"hachure",currentItemStrokeWidth:1,currentItemStrokeStyle:"solid",currentItemRoughness:1,currentItemOpacity:100},b=(0,l.memo)((function(){var e=(0,l.useRef)(null),t=(0,l.useRef)(null);(0,l.useEffect)((function(){var t=e.current,o=t.offsetWidth,n=t.offsetHeight,r=t.offsetLeft,l=t.offsetTop;t.width=o*window.devicePixelRatio,t.height=n*window.devicePixelRatio,P.offsetLeft=r,P.offsetTop=l,S({elements:T.getElementsIncludingDeleted(),appState:P,scale:window.devicePixelRatio,canvas:e.current,renderConfig:{selectionColor:"#6965db",scrollX:P.scrollX,scrollY:P.scrollY,viewBackgroundColor:"#ffffff",zoom:1}})}),[]),(0,l.useEffect)((function(){var e=t.current,o=function(e){e.preventDefault()};return e.addEventListener("wheel",o,{passive:!1}),function(){e.removeEventListener("wheel",o)}}),[]);var o=function(e,t){var o=function(e){var t,o=e.type,n=e.x,r=e.y,l=e.strokeColor,i=e.backgroundColor,a=e.fillStyle,u=e.strokeWidth,f=e.strokeStyle,v=e.roughness,g=e.opacity,h=e.width,m=void 0===h?0:h,p=e.height,w=void 0===p?0:p,y=e.angle,k=void 0===y?0:y,x=e.groupIds,S=void 0===x?[]:x,C=e.roundness,I=void 0===C?null:C,E=e.boundElements,R=void 0===E?null:E,T=e.link,P=void 0===T?null:T,b=e.locked,L=(0,c.Z)(e,d);return{id:"id".concat(s++),type:o,x:n,y:r,width:m,height:w,angle:k,strokeColor:l,backgroundColor:i,fillStyle:a,strokeWidth:u,strokeStyle:f,roughness:v,opacity:g,groupIds:S,roundness:I,version:L.version||1,versionNonce:null!==(t=L.versionNonce)&&void 0!==t?t:0,isDeleted:!1,boundElements:R,updated:Date.now(),link:P,locked:b}}({type:e,x:t.origin.x,y:t.origin.y,strokeColor:P.currentItemStrokeColor,backgroundColor:P.currentItemBackgroundColor,fillStyle:P.currentItemFillStyle,strokeWidth:P.currentItemStrokeWidth,strokeStyle:P.currentItemStrokeStyle,roughness:P.currentItemRoughness,opacity:P.currentItemOpacity,roundness:null,locked:!1});T.replaceAllElements([].concat((0,r.Z)(T.getElementsIncludingDeleted()),[o])),P.draggingElement=o},u=function(e){return function(t){window.removeEventListener("pointermove",e.eventListeners.onMove),window.removeEventListener("pointerup",e.eventListeners.onUp)}},f=function(t){return function(o){var n=i(o,P);t.lastCoords.x=n.x,t.lastCoords.y=n.y,v(t,o),S({elements:T.getElementsIncludingDeleted(),appState:P,scale:window.devicePixelRatio,canvas:e.current,renderConfig:{selectionColor:"#6965db",scrollX:P.scrollX,scrollY:P.scrollY,viewBackgroundColor:"#ffffff",zoom:1}})}},v=function(e,t){var o=e.lastCoords;!function(e,t,o,n,r,l,i,a,s,c,d){0!==i&&0!==a&&function(e,t){for(var o in t){var n=t[o];"undefined"!==typeof n&&(e[o]=n)}}(e,{x:r<o?o-i:o,y:l<n?n-a:n,width:i,height:a})}(P.draggingElement,0,e.origin.x,e.origin.y,o.x,o.y,a(e.origin.x,o.x),a(e.origin.y,o.y))},g=function(e){var t=i(e,P);return{origin:t,lastCoords:(0,n.Z)({},t),eventListeners:{onMove:null,onUp:null,onKeyUp:null,onKeyDown:null}}};return(0,R.jsxs)("div",{ref:t,children:[(0,R.jsx)("div",{className:"refer",children:"\u53c2\u7167\u7269"}),(0,R.jsx)("canvas",{onWheel:function(t){var o=t.deltaX,n=t.deltaY;P.scrollX=P.scrollX-o,P.scrollY=P.scrollY-n,S({elements:T.getElementsIncludingDeleted(),appState:P,scale:window.devicePixelRatio,canvas:e.current,renderConfig:{selectionColor:"#6965db",scrollX:P.scrollX,scrollY:P.scrollY,viewBackgroundColor:"#ffffff",zoom:1}}),console.log("wheel",P.scrollX,P.scrollY)},onPointerDown:function(e){var t=g(e);o("rectangle",t);var n=f(t),r=u(t);window.addEventListener("pointermove",n),window.addEventListener("pointerup",r),t.eventListeners.onMove=n,t.eventListeners.onUp=r},ref:e,className:"canvas",children:"\u7ed8\u5236canvas"})]})})),L=b}}]);
//# sourceMappingURL=Canvas.b84f5efa.chunk.js.map