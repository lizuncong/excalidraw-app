"use strict";(self.webpackChunkexcalidraw_app=self.webpackChunkexcalidraw_app||[]).push([[465],{1890:function(e,t,n){n.d(t,{Z:function(){return h}});var i=n(1413),a=n(4925),r=n(9439),o=n(2791),l=n(1350),c=n(1926),s=n(4209),u=n(6571),d=(n(3659),n(184)),f=["node","inline","className","children"];var h=function(e){var t=e.src,n=(0,o.useState)(""),h=(0,r.Z)(n,2),g=h[0],x=h[1];return(0,o.useEffect)((function(){fetch(t).then((function(e){return e.text()})).then((function(e){x(e)}))}),[t]),(0,d.jsx)("div",{className:"markdown-body",children:(0,d.jsx)(l.D,{children:g,rehypePlugins:[u.Z],remarkPlugins:[c.Z],components:{code:function(e){e.node;var t=e.inline,n=e.className,r=e.children,o=(0,a.Z)(e,f),l=/language-(\w+)/.exec(n||"");return!t&&l?(0,d.jsx)(s.Z,(0,i.Z)({children:String(r).replace(/\n$/,""),language:l[1],className:"my-code",PreTag:"div"},o)):(0,d.jsx)("code",(0,i.Z)((0,i.Z)({className:n},o),{},{children:r}))}}})})}},9136:function(e,t,n){n.r(t),n.d(t,{default:function(){return w},elements:function(){return m}});var i=n(9439),a=n(2791),r=n(84),o=n(1890),l=n(6818),c=n(1413),s=n(4925),u=["x","y","strokeColor","backgroundColor","fillStyle","strokeWidth","strokeStyle","roughness","opacity","width","height","angle"],d=function(e){var t=function(e){return e.replace(/\t/g,"        ").replace(/\r?\n|\r/g,"\n")}(e.text);return(0,c.Z)((0,c.Z)({},function(e,t){var n=t.x,i=t.y,a=t.strokeColor,o=t.backgroundColor,l=t.fillStyle,c=t.strokeWidth,d=t.strokeStyle,f=t.roughness,h=t.opacity,g=t.width,x=void 0===g?0:g,v=t.height,p=void 0===v?0:v,m=t.angle,y=void 0===m?0:m;return(0,s.Z)(t,u),{id:(0,r.kb)(),type:e,x:n,y:i,width:x,height:p,angle:y,strokeColor:a,backgroundColor:o,fillStyle:l,strokeWidth:c,strokeStyle:d,roughness:f,opacity:h}}("text",e)),{},{text:t,fontSize:e.fontSize,fontFamily:e.fontFamily,textAlign:e.textAlign,verticalAlign:e.verticalAlign,containerId:e.containerId||null,originalText:t})},f=function(e){var t=e.fontSize,n=e.fontFamily;return"".concat(t,"px ").concat(n,", Segoe UI Emoji")},h="text-elements",g=new WeakMap,x=function(e,t){m.forEach((function(n){var a=function(e){var t=g.get(e);if(t)return t;var n=document.createElement("canvas"),i=n.getContext("2d");n.width=e.width*window.devicePixelRatio+40,n.height=e.height*window.devicePixelRatio+40,i.save(),i.translate(20,20),i.scale(window.devicePixelRatio,window.devicePixelRatio),i.font=f(e),i.fillStyle=e.strokeColor,i.textAlign=e.textAlign;var a=e.text.split("\n"),r=a.length?e.height/a.length:18;i.textBaseline="bottom";for(var o=0;o<a.length;o++)i.fillText(a[o],0,(o+1)*r);return i.restore(),g.set(e,n),n}(n),o=(0,r.qf)(n),l=(0,i.Z)(o,4),c=l[0],s=l[1],u=l[2],d=l[3],h=((c+u)/2+t.scrollX)*window.devicePixelRatio,x=((s+d)/2+t.scrollY)*window.devicePixelRatio;e.save(),e.scale(1/window.devicePixelRatio,1/window.devicePixelRatio),e.translate(h,x),console.log(),e.drawImage(a,-(u-c)/2*window.devicePixelRatio-20,-(d-s)/2*window.devicePixelRatio-20,a.width,a.height),e.restore()}))},v=function(e,t){var n=e.getContext("2d");n.clearRect(0,0,e.width,e.height),x(n,t),localStorage.setItem(h,JSON.stringify(m))},p=n(184),m=JSON.parse(localStorage.getItem(h))||[],y={offsetLeft:0,offsetTop:0,scrollX:0,scrollY:0,canvasWidth:0,canvasHeight:0,draggingElement:null},w=(0,a.memo)((function(){var e=(0,a.useRef)(null),t=(0,a.useRef)(null),n=(0,a.useRef)(null),c=(0,a.useRef)(null),s=(0,a.useState)(""),u=(0,i.Z)(s,2),h=u[0],x=u[1];(0,a.useEffect)((function(){var i=function(e){var t=e.getContext("2d");e.width=r*window.devicePixelRatio,e.height=o*window.devicePixelRatio,t.scale(window.devicePixelRatio,window.devicePixelRatio)},a=e.current,r=a.offsetWidth,o=a.offsetHeight;i(a),i(n.current);var l=a.getBoundingClientRect(),c=l.x,s=l.y;y.offsetLeft=c,y.offsetTop=s,y.canvasWidth=r,y.canvasHeight=o,v(n.current,y);var u=t.current,d=function(e){e.preventDefault()};return u.addEventListener("wheel",d,{passive:!1}),function(){u.removeEventListener("wheel",d)}}),[]);return(0,p.jsxs)("div",{className:"create-text",children:[(0,p.jsxs)("div",{className:"container wrap",ref:t,children:[(0,p.jsx)("canvas",{ref:n,className:"canvas",children:"\u9759\u6001canvas"}),(0,p.jsx)("canvas",{ref:e,className:"canvas draw",onDoubleClick:function(e){e.preventDefault(),e.stopPropagation();var t=(0,r.dE)(e,y),n=t.x,i=t.y,a=d({x:n,y:i,strokeColor:(0,r.B8)(),backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid",text:"",fontSize:20,fontFamily:"Virgil",textAlign:"left",verticalAlign:"top"});y.draggingElement=a;var o=c.current;o.focus();var l={font:f(a),left:"".concat(n,"px"),top:"".concat(i,"px"),opacity:1,color:a.strokeColor,fontSize:a.fontSize};Object.assign(o.style,l);var s=document.getElementById("copyText");Object.assign(s.style,l);var u=y.canvasWidth-n;o.style.maxWidth="".concat(u,"px"),o.style.width="".concat(a.fontSize,"px"),o.style.height="".concat(1.2*a.fontSize,"px")},children:"\u52a8\u6001canvas"}),(0,p.jsx)("textarea",{onChange:function(e){var t=e.target.value,n=c.current,i=parseFloat(n.style.maxWidth),a=document.getElementById("copyText");a.innerText=t;var r=a.getBoundingClientRect().width;if(r>i)if(r-i<30)console.log("\u6b63\u5e38\u7684\u8f93\u5165"),t=a.innerText=t.slice(0,t.length-1)+"\n"+t.slice(t.length-1);else{console.log("\u7c98\u8d34\u8fdb\u6765\u7684\u6587\u672c");var o=t.split("\n"),l=[];o.forEach((function(e){if(a.innerText=e,a.getBoundingClientRect().width<=i)l.push(e);else for(var t=0,n=1;n<e.length;n++){var r=e.slice(t,n);a.innerText=r,a.getBoundingClientRect().width>i?(l.push(e.slice(t,n-1)),t=n-1):n===e.length-1&&l.push(e.slice(t,n))}})),console.log("splitResult..",l),t=l.join("\n"),a.innerText=t}x(t);var s=a.getBoundingClientRect(),u=s.width,d=s.height;n.style.width="".concat(u+30,"px"),n.style.height="".concat(d,"px"),y.draggingElement.text=t},onBlur:function(){var e=y.draggingElement,t=c.current,i=document.getElementById("copyText");e.text&&(e.width=i.offsetWidth,e.height=i.offsetHeight,function(e){g.delete(e)}(y.draggingElement),m.push(y.draggingElement),v(n.current,y),setTimeout((function(){i.innerText="",x("")}),200)),Object.assign(t.style,{left:"0px",top:"0px",width:"20px",height:"30px",opacity:0})},value:h,className:"textarea",ref:c})]}),(0,p.jsx)("div",{id:"offscreen"}),(0,p.jsx)(o.Z,{src:l}),(0,p.jsx)("div",{style:{background:"grey"},id:"copyText",contentEditable:!0,className:"textarea textarea_copy"})]})}))},84:function(e,t,n){n.d(t,{$9:function(){return s},B8:function(){return c},KP:function(){return f},TE:function(){return g},dE:function(){return l},kb:function(){return v},mO:function(){return p},qf:function(){return h}});var i=n(9439),a=n(7762),r=n(3433),o=n(4164),l=function(e,t){var n=e.clientX,i=e.clientY,a=t.zoom,r=t.offsetLeft,o=t.offsetTop,l=t.scrollX,c=t.scrollY,s=a?a.value:1;return{x:(n-r)/s-l,y:(i-o)/s-c}},c=function(){var e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),n=Math.floor(256*Math.random());return"rgb(".concat(e,",").concat(t,",").concat(n,")")},s=function(e){return function(e,t){var n=null,i=null,a=null,o=function t(o){n=window.requestAnimationFrame((function(){n=null,e.apply(void 0,(0,r.Z)(o)),i=null,a&&(i=a,a=null,t(i))}))},l=function(){for(var e=arguments.length,r=new Array(e),l=0;l<e;l++)r[l]=arguments[l];i=r,null===n?o(i):null!==t&&void 0!==t&&t.trailing&&(a=r)};return l.flush=function(){null!==n&&(cancelAnimationFrame(n),n=null),i&&(e.apply(void 0,(0,r.Z)(a||i)),i=a=null)},l.cancel=function(){i=a=null,null!==n&&(cancelAnimationFrame(n),n=null)},l}((function(t){(0,o.unstable_batchedUpdates)(e,t)}))},u=function(e){var t=1/0,n=1/0,r=-1/0,o=-1/0,l=e.points;"freedraw"===e.type&&(l=e.points.map((function(t){return[t[0]-e.x,t[1]-e.y]})));var c,s=(0,a.Z)(l);try{for(s.s();!(c=s.n()).done;){var u=(0,i.Z)(c.value,2),d=u[0],f=u[1];t=Math.min(t,d),n=Math.min(n,f),r=Math.max(r,d),o=Math.max(o,f)}}catch(h){s.e(h)}finally{s.f()}return[t,n,r,o]},d=function(e,t,n,i,a){return[(e-n)*Math.cos(a)-(t-i)*Math.sin(a)+n,(e-n)*Math.sin(a)+(t-i)*Math.cos(a)+i]},f=function(e){if(!e.length)return[0,0,0,0];var t=1/0,n=-1/0,a=1/0,r=-1/0;return e.forEach((function(e){var o=function(e){var t=h(e),n=(0,i.Z)(t,6),a=n[0],r=n[1],o=n[2],l=n[3],c=n[4],s=n[5];if("freedraw"===e.type){var f=u(e),g=(0,i.Z)(f,4),x=g[0],v=g[1],p=g[2],m=g[3];return[x+e.x,v+e.y,p+e.x,m+e.y]}var y=d(a,r,c,s,e.angle),w=(0,i.Z)(y,2),k=w[0],M=w[1],S=d(a,l,c,s,e.angle),Z=(0,i.Z)(S,2),E=Z[0],C=Z[1],R=d(o,l,c,s,e.angle),b=(0,i.Z)(R,2),P=b[0],j=b[1],T=d(o,r,c,s,e.angle),N=(0,i.Z)(T,2),W=N[0],A=N[1];return[Math.min(k,E,P,W),Math.min(M,C,j,A),Math.max(k,E,P,W),Math.max(M,C,j,A)]}(e),l=(0,i.Z)(o,4),c=l[0],s=l[1],f=l[2],g=l[3];t=Math.min(t,c),a=Math.min(a,s),n=Math.max(n,f),r=Math.max(r,g)})),[t,a,n,r]},h=function(e){if("freedraw"===e.type){var t=u(e),n=(0,i.Z)(t,4),a=n[0],r=n[1],o=n[2],l=n[3],c=a+e.x,s=r+e.y,d=o+e.x,f=l+e.y;return[c,s,d,f,(c+d)/2,(s+f)/2]}return[e.x,e.y,e.x+e.width,e.y+e.height,e.x+e.width/2,e.y+e.height/2]},g=function(e,t){return Math.abs(e-t)},x=0,v=function(){return"id".concat(x++)};window.__generateExcalidrawElements=function(){return(JSON.parse(localStorage.getItem("free-draw-elements"))||[]).map((function(e){var t=e.points.map((function(t){return[t[0]-e.x,t[1]-e.y]})),n=function(e){var t=e.map((function(e){return e[0]})),n=e.map((function(e){return e[1]}));return{width:Math.max.apply(Math,(0,r.Z)(t))-Math.min.apply(Math,(0,r.Z)(t)),height:Math.max.apply(Math,(0,r.Z)(n))-Math.min.apply(Math,(0,r.Z)(n))}}(t),i=n.width,a=n.height;return{id:v(),type:"freedraw",x:e.x,y:e.y,width:i,height:a,angle:0,strokeColor:e.strokeStyle,backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid",roughness:1,opacity:100,groupIds:[],roundness:null,seed:Math.floor(Math.random()*Math.pow(2,31)),version:1,versionNonce:0,isDeleted:!1,boundElements:null,updated:Date.now(),link:null,locked:!1,points:t,pressures:[],simulatePressure:!0,lastCommittedPoint:t[t.length-1]}}))};var p=function(e){var t=e.fontSize,n=e.fontFamily;return"".concat(t,"px ").concat(n,", Segoe UI Emoji")}},6818:function(e,t,n){e.exports=n.p+"static/media/\u70b9\u7a00\u91ca.31d6cfe0d16ae931b73c.md"}}]);
//# sourceMappingURL=CreateText.ec4ce246.chunk.js.map