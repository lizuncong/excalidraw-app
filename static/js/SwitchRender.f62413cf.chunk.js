"use strict";(this.webpackChunkexcalidraw_app=this.webpackChunkexcalidraw_app||[]).push([[358],{2456:function(e,t,n){n.r(t),n.d(t,{appState:function(){return de},default:function(){return ve}});var o,r,i,a=n(3433),l=n(1413),c=n(9439),s=n(4519),u=n(5204),d=n(4975),f=n(4925),v=["type","x","y","strokeColor","backgroundColor","fillStyle","strokeWidth","strokeStyle","width","height","angle","points"],h=function(e){var t=e.type,n=e.x,o=e.y,r=e.strokeColor,i=e.backgroundColor,a=e.fillStyle,c=e.strokeWidth,s=void 0===c?3:c,d=e.strokeStyle,h=e.width,g=void 0===h?0:h,m=e.height,p=void 0===m?0:m,x=e.angle,w=void 0===x?0:x,y=e.points,C=void 0===y?[]:y,k=(0,f.Z)(e,v);return(0,l.Z)({id:(0,u.kb)(),type:t,x:n,y:o,width:g,height:p,strokeColor:r,backgroundColor:i,fillStyle:a,strokeWidth:s,strokeStyle:d,angle:w,isDeleted:!1,points:C},k)},g=function(e){var t=e.elementType,n=e.pointerDownState,o=e.appState;return h("freedraw"===t?{type:t,x:n.origin.x,y:n.origin.y,points:[[n.origin.x,n.origin.y]],strokeColor:o.currentItemStrokeColor,backgroundColor:o.currentItemBackgroundColor,fillStyle:o.currentItemFillStyle,strokeWidth:o.currentItemStrokeWidth,strokeStyle:(0,u.B8)()}:{type:t,x:n.origin.x,y:n.origin.y,strokeColor:o.currentItemStrokeColor,backgroundColor:o.currentItemBackgroundColor,fillStyle:o.currentItemFillStyle,strokeWidth:o.currentItemStrokeWidth,strokeStyle:(0,u.B8)()})},m=function(e){return h((0,l.Z)({type:"text",text:e.text,fontSize:e.fontSize,fontFamily:e.fontFamily,textAlign:e.textAlign,verticalAlign:e.verticalAlign,originalText:e.text},e))},p=function(e,t){return Number((Math.random()*(t-e)+e).toFixed(5))},x=function(e,t,n){for(var o,r=[],i=0;i<e;i++){var a=p(-n.scrollX,n.canvasWidth-n.scrollX),l=p(-n.scrollY,n.canvasHeight-n.scrollY);if(o=g({elementType:t,pointerDownState:{origin:{x:a,y:l}},appState:n}),"rectangle"===t){var c=Math.abs(p(-n.scrollX-a,n.canvasWidth-n.scrollX-a))+2,s=Math.abs(p(-n.scrollY-l,n.canvasHeight-n.scrollY-l))+2;o.width=c,o.height=s}else if("freedraw"===t)for(var d=p(20,100),f=0;f<d;f++)a=p(a,a+10),l=p(l,l+10),o.points.push([a,l]);else if("text"===t){var v="".concat(a,", ").concat(l);o=m({x:a,y:l,strokeColor:(0,u.B8)(),backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid",text:v,width:20*v.length,height:25,fontSize:20,fontFamily:"Virgil",textAlign:"left",verticalAlign:"top"})}r.push(o)}return r},w={},y=n(2121),C="http://www.w3.org/2000/svg",k=function(e){var t=e.elements,n=e.appState,a=(e.scale,e.svg),l=e.renderConfig,s=e.isTransform,u=l.accelerate,d="\n    transform: translateX(".concat(n.scrollX*n.zoom.value,"px) translateY(").concat(n.scrollY*n.zoom.value,"px) scale(").concat(n.zoom.value,");\n    width: ").concat(30,"px;\n    height: ").concat(30,"px;\n    transform-origin: left top;\n    ").concat(u?"will-change: transform;":"","\n  ");if(a.setAttribute("style",d.replace(/\s+/g," ")),!s){var f=(0,y.Sp)(t,10),v=(0,c.Z)(f,4),h=v[0],g=v[1],m=v[2],p=v[3];o||((o=document.createElementNS(C,"svg")).style.position="absolute",o.style.background="transparent",o.setAttribute("xmlns","http://www.w3.org/2000/svg"),o.setAttribute("version","1.1"),a.appendChild(o)),o.setAttribute("width",m),o.setAttribute("height",p),o.style.left="".concat(h,"px"),o.style.top="".concat(g,"px"),t.map((function(e,t){return function(e,t,n,o){var r,i=o.minX,a=o.minY,l=o.svg;if(o.originChange||!w[e.id]||e===n.draggingElement){switch(e.type){case"rectangle":var c=e.x-i,s=e.y-a;(r=w[e.id]||document.createElementNS(C,"rect")).setAttribute("id",e.id),r.setAttribute("x",c),r.setAttribute("y",s),r.setAttribute("width",e.width),r.setAttribute("height",e.height),r.setAttribute("fill","none"),r.setAttribute("stroke-width",e.strokeWidth),r.setAttribute("stroke",e.strokeStyle),r.__x=c,r.__y=s,r.__width=e.width,r.__height=e.height;break;case"freedraw":var u=e.points.map((function(t){return[t[0]-i+Math.ceil(e.strokeWidth/2),t[1]-a+Math.ceil(e.strokeWidth/2)]}));(r=w[e.id]||document.createElementNS(C,"polyline")).setAttribute("id",e.id),r.setAttribute("points",u.join(" ")),r.setAttribute("fill","none"),r.setAttribute("stroke-width",e.strokeWidth),r.setAttribute("stroke",e.strokeStyle)}return w[e.id]||(w[e.id]=r,l.appendChild(r)),r}}(e,0,n,{minX:h,minY:g,svg:o,originChange:r!==h||i!==g})})),r=h,i=g}};window.__svg2img=function(e){var t=(new XMLSerializer).serializeToString(e),n="data:image/svg+xml;base64,"+btoa(t),o=document.createElement("img");return o.src=n,document.body.appendChild(o),n};var E=new WeakMap,S=function(e,t){var n=E.get(e);if(console.log("\u751f\u6210\u79bb\u5c4fcanvas"),n&&!t.notUseCache)return n;var o=T(e,t.zoom,t);return t.notUseCache||E.set(e,o),o},b=document.getElementById("placeholder"),j=null,T=function(e,t,n){var o=document.createElement("canvas"),r=o.getContext("2d"),i=Z(e);b||(b=document.getElementById("placeholder")),j&&b.removeChild(j),j=o,b.appendChild(j);if("freedraw"===e.type){var a,l,s=(0,u.qf)(e),d=(0,c.Z)(s,4),f=d[0],v=d[1],h=d[2],g=d[3];o.width=(0,u.TE)(f,h)*window.devicePixelRatio*t.value+i*t.value*2,o.height=(0,u.TE)(v,g)*window.devicePixelRatio*t.value+i*t.value*2,a=e.x>f?(0,u.TE)(e.x,f)*window.devicePixelRatio*t.value:0,l=e.y>v?(0,u.TE)(e.y,v)*t.value*window.devicePixelRatio:0,r.translate(a,l)}else o.width=e.width*window.devicePixelRatio*t.value+i*t.value*2,o.height=e.height*window.devicePixelRatio*t.value+i*t.value*2;return r.save(),r.translate(i*t.value,i*t.value),r.scale(window.devicePixelRatio*t.value,window.devicePixelRatio*t.value),z(e,r,n),r.restore(),{element:e,canvas:o,theme:n.theme,canvasZoom:t,canvasOffsetX:0,canvasOffsetY:0}},z=function(e,t,n){switch(t.globalAlpha=e.opacity/100,e.type){case"rectangle":t.lineJoin="round",t.lineCap="round",t.lineWidth=e.strokeWidth,t.strokeStyle="black",t.strokeRect(0,0,e.width,e.height);break;case"text":t.font=(0,u.mO)(e),t.fillStyle=e.strokeColor,t.textAlign=e.textAlign;var o=e.text.split("\n"),r=o.length?e.height/o.length:18;t.textBaseline="bottom";for(var i=0;i<o.length;i++)t.fillText(o[i],0,(i+1)*r);break;case"freedraw":t.save(),t.lineWidth=e.strokeWidth,t.strokeStyle="black",e.points.forEach((function(n,o){var r=(0,c.Z)(n,2),i=r[0],a=r[1];i-=e.x,a-=e.y,o?t.lineTo(i,a):t.moveTo(i,a)})),t.stroke(),t.restore()}t.globalAlpha=1},Z=function(e){return"freedraw"===e.type?12*e.strokeWidth:20},X=function(e,t,n){var o=e.element,r=Z(o),i=(0,u.qf)(o),a=(0,c.Z)(i,4),l=a[0],s=a[1],d=a[2],f=a[3];if("freedraw"===o.type){var v=(0,u.qf)(o),h=(0,c.Z)(v,4);l=h[0],s=h[1],d=h[2],f=h[3]}var g=((l+d)/2+n.scrollX)*window.devicePixelRatio,m=((s+f)/2+n.scrollY)*window.devicePixelRatio;t.save(),t.scale(1/window.devicePixelRatio,1/window.devicePixelRatio),t.translate(g,m),t.drawImage(e.canvas,-(d-l)/2*window.devicePixelRatio-r*e.canvasZoom.value/e.canvasZoom.value,-(f-s)/2*window.devicePixelRatio-r*e.canvasZoom.value/e.canvasZoom.value,e.canvas.width/e.canvasZoom.value,e.canvas.height/e.canvasZoom.value),t.restore()},Y=function(e){var t=e.elements,n=e.appState,o=e.scale,r=e.canvas,i=e.renderConfig,a=r.getContext("2d");a.setTransform(1,0,0,1,0,0),a.save(),a.scale(o,o);var l=r.width/o,s=r.height/o;a.clearRect(0,0,l,s),a.save(),a.scale(i.zoom.value,i.zoom.value),function(e,t){var n=t.scrollX,o=t.scrollY,r=t.zoom;e.save();var i=100,a=100,l=e.canvas;e.strokeStyle="red",e.fillStyle="red",e.beginPath(),e.lineWidth=2,e.textBaseline="middle",e.save(),e.translate(0,o);for(var c=0;c<o/i;c++)e.moveTo(0,-c*i),e.lineTo(8,-c*i),e.font="10px Arial",e.fillText(-c,0,-c*i+10);for(var s=1;s<(l.height-o*r.value)/(i*r.value);s++)e.moveTo(0,s*i),e.lineTo(8,s*i),e.font="10px Arial",e.fillText(s,0,s*i+10);e.restore(),e.save(),e.translate(n,0);for(var u=0;u<n/a;u++)e.moveTo(-u*a,0),e.lineTo(-u*a,8),e.font="10px Arial",e.fillText(-u,-u*a+5,5);for(var d=1;d<(l.width-n*r.value)/(a*r.value);d++)e.moveTo(d*a,0),e.lineTo(d*a,8),e.font="10px Arial",e.fillText(d,d*a+5,5);e.restore(),e.stroke(),e.restore()}(a,i);var d=t.filter((function(e){return function(e,t,n,o){var r=(0,u.Pi)(e),i=(0,c.Z)(r,4),a=i[0],l=i[1],s=i[2],d=i[3],f=(0,u.dE)({clientX:o.offsetLeft,clientY:o.offsetTop},o),v=(0,u.dE)({clientX:o.offsetLeft+t,clientY:o.offsetTop+n},o);return f.x<=s&&f.y<=d&&v.x>=a&&v.y>=l}(e,l,s,{zoom:i.zoom,offsetLeft:n.offsetLeft,offsetTop:n.offsetTop,scrollX:i.scrollX,scrollY:i.scrollY})}));document.getElementById("canvas-total").innerText="\u603b\u5143\u7d20\u6570\uff1a".concat(t.length,"   \u5b9e\u9645\u7ed8\u5236\u5143\u7d20\u603b\u6570\uff1a").concat(d.length),d.forEach((function(e){!function(e,t,n,o){var r=S(e,n);X(r,t,n)}(e,a,i)})),a.restore(),a.restore(),localStorage.setItem("elements",JSON.stringify(t)),localStorage.setItem("appState",JSON.stringify(n))},M=function(e){console.log("renderScene...",e.renderEngine),"svg"===e.renderEngine?k(e):Y(e)},A=function(e){!function(e){E.delete(e)}(e)},R=n(5909),_={pointers:new Map,lastCenter:null,initialDistance:null,initialScale:null},P=function(e,t){(0,s.useEffect)((function(){var t=e.current,n=function(e){e.touches.length||_.pointers.clear()};return t.addEventListener("touchend",n),function(){t.removeEventListener("touchend",n)}}),[e]);return{gesture:_,removePointer:function(e){_.pointers.delete(e.pointerId)},updateGestureOnPointerDown:function(e){_.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY}),2===_.pointers.size&&(_.lastCenter=(0,R.q)(_.pointers),_.initialScale=t.zoom.value,_.initialDistance=(0,R.S)(Array.from(_.pointers.values())))},handleCanvasPointerMove:function(e,n){_.pointers.has(e.pointerId)&&_.pointers.set(e.pointerId,{x:e.clientX,y:e.clientY});var o=_.initialScale;if(2===_.pointers.size&&_.lastCenter&&o&&_.initialDistance){var r=(0,R.q)(_.pointers),i=r.x-_.lastCenter.x,a=r.y-_.lastCenter.y;_.lastCenter=r;var l=(0,R.S)(Array.from(_.pointers.values()))/_.initialDistance,c=l?(0,d.j)(o*l):t.zoom.value,s=(0,d.E)({viewportX:r.x,viewportY:r.y,nextZoom:c},t);Object.assign(t,{zoom:s.zoom,scrollX:s.scrollX+i/c,scrollY:s.scrollY+a/c}),n()}else _.lastCenter=_.initialDistance=_.initialScale=null}}},I={tools:"index_tools__22e8h",item:"index_item__o-hUS",selected:"index_selected__3WGnX"},W=n(2556),D=["width","height","mirror","style"],L=function(e,t){var n="number"===typeof t?{width:t}:t,o=n.width,r=void 0===o?512:o,i=n.height,a=void 0===i?r:i,c=(n.mirror,n.style),s=(0,f.Z)(n,D);return(0,W.jsx)("svg",(0,l.Z)((0,l.Z)({"aria-hidden":"true",focusable:"false",role:"img",viewBox:"0 0 ".concat(r," ").concat(a),style:c},s),{},{children:"string"===typeof e?(0,W.jsx)("path",{fill:"currentColor",d:e}):e}))},B=L((0,W.jsxs)("g",{strokeWidth:"1.5",children:[(0,W.jsx)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),(0,W.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2"})]}),{width:24,height:24,fill:"none",strokeWidth:2,stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),N=L((0,W.jsxs)("g",{strokeWidth:"1.25",children:[(0,W.jsx)("path",{clipRule:"evenodd",d:"m7.643 15.69 7.774-7.773a2.357 2.357 0 1 0-3.334-3.334L4.31 12.357a3.333 3.333 0 0 0-.977 2.357v1.953h1.953c.884 0 1.732-.352 2.357-.977Z"}),(0,W.jsx)("path",{d:"m11.25 5.417 3.333 3.333"})]}),{width:20,height:20,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),F=L((0,W.jsxs)("g",{strokeWidth:"1.25",children:[(0,W.jsx)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),(0,W.jsx)("path",{d:"M15 8h.01"}),(0,W.jsx)("path",{d:"M12 20h-5a3 3 0 0 1 -3 -3v-10a3 3 0 0 1 3 -3h10a3 3 0 0 1 3 3v5"}),(0,W.jsx)("path",{d:"M4 15l4 -4c.928 -.893 2.072 -.893 3 0l4 4"}),(0,W.jsx)("path",{d:"M14 14l1 -1c.617 -.593 1.328 -.793 2.009 -.598"}),(0,W.jsx)("path",{d:"M19 16v6"}),(0,W.jsx)("path",{d:"M22 19l-3 3l-3 -3"})]}),{width:24,height:24,fill:"none",strokeWidth:2,stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),O={width:20,height:20,fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"},U=L((0,W.jsx)("path",{strokeWidth:"1.25",d:"M10 4.167v11.666M4.167 10h11.666"}),O),q=L((0,W.jsx)("path",{d:"M5 10h10",strokeWidth:"1.25"}),O),H=n(5671),J=n(3144),K=function(){function e(){(0,H.Z)(this,e);var t=JSON.parse(localStorage.getItem("elements"));this.elements=t||[]}return(0,J.Z)(e,[{key:"getElementsIncludingDeleted",value:function(){return this.elements}},{key:"replaceAllElements",value:function(e){this.elements=e}}]),e}(),G=new K,V=[{type:"rectangle",icon:B},{type:"freedraw",icon:N}],$=(0,s.memo)((function(e){var t=e.activeTool,n=e.onActiveToolChange;return(0,W.jsxs)("div",{className:I.tools,children:[(0,W.jsx)("span",{className:[I.item].join(" "),onClick:function(){(0,y.aF)({renderScene:M,elements:G.getElementsIncludingDeleted(),appState:de})},children:F}),V.map((function(e){var o=t.type===e.type;return(0,W.jsx)("span",{className:[I.item,o&&I.selected].join(" "),onClick:function(){return n({type:o?"":e.type})},children:e.icon},e.type)}))]})})),Q={scale:"index_scale__-Xme5",item:"index_item__JKmav",value:"index_value__f1Juj"},ee=(0,s.memo)((function(e){var t=e.appState,n=e.onZoomChange,o="".concat((100*t.zoom.value).toFixed(0),"%");return(0,W.jsxs)("div",{className:Q.scale,children:[(0,W.jsx)("span",{className:[Q.item].join(" "),onClick:function(){return n((0,d.j)(t.zoom.value-.1))},children:q}),(0,W.jsx)("span",{className:Q.value,onClick:function(){return n((0,d.j)(1))},children:o}),(0,W.jsx)("span",{className:[Q.item].join(" "),onClick:function(){return n((0,d.j)(t.zoom.value+.1))},children:U})]})})),te=ee,ne="index_layer__wGOXl",oe="index_ball_red__OOExQ",re="index_boundceBall__F5vh4",ie="index_shadowball__g4a+F",ae=(0,s.memo)((function(e){var t=e.activeTool,n=e.onActiveToolChange,o=e.appState,r=e.onZoomChange;return(0,W.jsxs)("div",{className:ne,children:[(0,W.jsx)(te,{appState:o,onZoomChange:r}),(0,W.jsx)($,{activeTool:t,onActiveToolChange:n}),(0,W.jsxs)("div",{className:re,children:[(0,W.jsx)("div",{className:oe}),(0,W.jsx)("div",{className:ie})]})]})})),le=ae,ce={textarea:"index_textarea__GZm7+",textarea_copy:"index_textarea_copy__Jw9TD"},se=(0,s.forwardRef)((function(e,t){var n=e.staticCanvasRef,o=(0,s.useRef)(null),r=(0,s.useState)(""),i=(0,c.Z)(r,2),l=i[0],d=i[1];return(0,s.useImperativeHandle)(t,(function(){return{startEditText:function(e){e.preventDefault(),e.stopPropagation();var t=(0,u.dE)(e,de),n=t.x,r=t.y,i=m({x:n,y:r,strokeColor:(0,u.B8)(),backgroundColor:"transparent",fillStyle:"hachure",strokeWidth:1,strokeStyle:"solid",text:"",fontSize:20,fontFamily:"Virgil",textAlign:"left",verticalAlign:"top"});de.draggingElement=i;var a=o.current;a.focus();var l=e.clientX-de.offsetLeft,c=e.clientY-de.offsetTop,s={font:(0,u.mO)(i),left:"".concat(l,"px"),top:"".concat(c,"px"),opacity:1,color:i.strokeColor,fontSize:i.fontSize};Object.assign(a.style,s);var d=document.getElementById("copyText");Object.assign(d.style,s);var f=de.canvasWidth-l;Object.assign(a.style,{zIndex:1,maxWidth:"".concat(f,"px"),width:"".concat(i.fontSize,"px"),height:"".concat(1.2*i.fontSize,"px")})}}})),(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("textarea",{onChange:function(e){var t=e.target.value,n=o.current,r=parseFloat(n.style.maxWidth),i=document.getElementById("copyText");i.innerText=t;var a=i.getBoundingClientRect().width;if(a>r)if(a-r<30)t=i.innerText=t.slice(0,t.length-1)+"\n"+t.slice(t.length-1);else{var l=t.split("\n"),c=[];l.forEach((function(e){if(i.innerText=e,i.getBoundingClientRect().width<=r)c.push(e);else for(var t=0,n=1;n<e.length;n++){var o=e.slice(t,n);i.innerText=o,i.getBoundingClientRect().width>r?(c.push(e.slice(t,n-1)),t=n-1):n===e.length-1&&c.push(e.slice(t,n))}})),t=c.join("\n"),i.innerText=t}d(t);var s=i.getBoundingClientRect(),u=s.width,f=s.height;n.style.width="".concat(u+30,"px"),n.style.height="".concat(f,"px"),de.draggingElement.text=t},onBlur:function(){var e=de.draggingElement,t=o.current,r=document.getElementById("copyText");e.text&&(e.width=r.offsetWidth,e.height=r.offsetHeight,A(de.draggingElement),G.replaceAllElements([].concat((0,a.Z)(G.getElementsIncludingDeleted()),[de.draggingElement])),M({elements:G.getElementsIncludingDeleted(),appState:de,scale:window.devicePixelRatio,canvas:n.current,renderConfig:{selectionColor:"#6965db",scrollX:de.scrollX,scrollY:de.scrollY,viewBackgroundColor:"#ffffff",zoom:de.zoom}}),setTimeout((function(){r.innerText="",d("")}),200)),Object.assign(t.style,{left:"0px",top:"0px",zIndex:-1,opacity:0})},value:l,className:ce.textarea,ref:o}),(0,W.jsx)("div",{style:{background:"grey"},id:"copyText",contentEditable:!0,className:[ce.textarea,ce.textarea_copy].join(" ")})]})})),ue=(0,s.memo)(se),de=JSON.parse(localStorage.getItem("appState"))||{zoom:{value:1},scrollX:0,scrollY:0,offsetLeft:0,offsetTop:0,draggingElement:null,canvasWidth:0,canvasHeight:0},fe=(0,s.memo)((function(){var e=(0,s.useRef)(null),t=(0,s.useRef)(null),n=(0,s.useRef)(null),o=(0,s.useRef)({}),r=(0,s.useRef)(null),i=(0,s.useRef)(null),f=(0,s.useRef)({}),v=(0,s.useState)(!1),h=(0,c.Z)(v,2),m=h[0],w=h[1],y=(0,s.useState)({type:""}),C=(0,c.Z)(y,2),k=C[0],E=C[1],S=(0,s.useState)({count:"",type:"rectangle"}),b=(0,c.Z)(S,2),j=b[0],T=b[1],z=(0,s.useState)(!1),Z=(0,c.Z)(z,2),X=Z[0],Y=Z[1],R=(0,s.useRef)(!0),_=(0,s.useState)("canvas"),I=(0,c.Z)(_,2),D=I[0],L=I[1],B=(0,s.useRef)(),N=function(){w(!m)};(0,s.useEffect)((function(){var e=t.current,o=e.offsetWidth,r=e.offsetHeight;!function(e){e.width=o*window.devicePixelRatio,e.height=r*window.devicePixelRatio}(t.current);var i=e.getBoundingClientRect(),a=i.x,l=i.y;de.offsetLeft=a,de.offsetTop=l,de.canvasWidth=o,de.canvasHeight=r,M({elements:G.getElementsIncludingDeleted(),appState:de,renderEngine:D,scale:window.devicePixelRatio,canvas:t.current,svg:n.current,renderConfig:{selectionColor:"#6965db",scrollX:de.scrollX,scrollY:de.scrollY,viewBackgroundColor:"#ffffff",zoom:de.zoom,accelerate:R.current}})}),[D]),(0,s.useEffect)((function(){var n=e.current,r=function(e){e.preventDefault()};n.addEventListener("wheel",r,{passive:!1});var i=function(e){o.current={cursorX:e.clientX,cursorY:e.clientY}},a=function(e){e.preventDefault()},l=t.current;return l.addEventListener("touchstart",a),document.addEventListener("mousemove",i),function(){l.removeEventListener("touchstart",a),n.removeEventListener("wheel",r),document.removeEventListener("mousemove",i)}}),[]),(0,s.useEffect)((function(){var e=0,t=Date.now();!function n(){var o=Date.now();if(e++,o>1e3+t){var r=Math.round(1e3*e/(o-t));i.current.innerText="FPS\uff1a".concat(r),e=0,t=o}requestAnimationFrame(n)}()}),[]);var F=P(t,de),O=F.updateGestureOnPointerDown,U=F.handleCanvasPointerMove,q=F.removePointer,H=F.gesture,J=function(){M({elements:G.getElementsIncludingDeleted(),appState:de,scale:window.devicePixelRatio,canvas:t.current,renderEngine:D,svg:n.current,isTransform:!0,renderConfig:{selectionColor:"#6965db",scrollX:de.scrollX,scrollY:de.scrollY,viewBackgroundColor:"#ffffff",zoom:de.zoom,accelerate:R.current}}),f.current.zoomTimerId&&clearTimeout(f.current.zoomTimerId),f.current.zoomTimerId=setTimeout((function(){M({elements:G.getElementsIncludingDeleted(),appState:de,scale:window.devicePixelRatio,canvas:t.current,renderEngine:D,svg:n.current,isTransform:!0,renderConfig:{selectionColor:"#6965db",scrollX:de.scrollX,scrollY:de.scrollY,viewBackgroundColor:"#ffffff",zoom:de.zoom,accelerate:R.current}})}),300)},K=function(e){return(0,u.$9)((function(o){var r=(0,u.dE)(o,de);if(e.lastCoords.x=r.x,e.lastCoords.y=r.y,"freedraw"===k.type)de.draggingElement.points.push([r.x,r.y]);else{var i=e.lastCoords,a=e.origin.x,l=e.origin.y,c=i.x,s=i.y,d=(0,u.TE)(e.origin.x,i.x),f=(0,u.TE)(e.origin.y,i.y),v=c<a?a-d:a,h=s<l?l-f:l;de.draggingElement.x=v,de.draggingElement.y=h,de.draggingElement.width=d,de.draggingElement.height=f}A(de.draggingElement),M({elements:G.getElementsIncludingDeleted(),appState:de,scale:window.devicePixelRatio,canvas:t.current,renderEngine:D,svg:n.current,renderConfig:{selectionColor:"#6965db",scrollX:de.scrollX,scrollY:de.scrollY,viewBackgroundColor:"#ffffff",zoom:de.zoom,accelerate:R.current}})}))},V=function(e){return function(o){q(o),M({elements:G.getElementsIncludingDeleted(),appState:de,scale:window.devicePixelRatio,canvas:t.current,svg:n.current,renderEngine:D,renderConfig:{selectionColor:"#6965db",scrollX:de.scrollX,scrollY:de.scrollY,viewBackgroundColor:"#ffffff",zoom:de.zoom,accelerate:R.current}}),window.removeEventListener("pointermove",e.eventListeners.onMove),window.removeEventListener("pointerup",e.eventListeners.onUp)}},$=function(e){var t=(0,u.dE)(e,de);return{origin:t,lastCoords:(0,l.Z)({},t),eventListeners:{onMove:null,onUp:null,onKeyUp:null,onKeyDown:null}}};return(0,W.jsxs)("div",{className:"svg-base",ref:e,children:[(0,W.jsxs)("div",{className:"container wrap",children:[(0,W.jsx)("div",{className:"svg-container",ref:n}),(0,W.jsx)("canvas",{ref:t,className:"canvas",onWheel:function(e){var r=e.deltaX,i=e.deltaY;if(e.metaKey||e.ctrlKey){var a=Math.sign(i),c=Math.abs(i),s=i;c>10&&(s=10*a);var u=de.zoom.value-s/100;u+=Math.log10(Math.max(1,de.zoom.value))*-a*Math.min(1,c/20);var f=(0,d.j)(u);return Object.assign(de,(0,l.Z)({},(0,d.E)({viewportX:o.current.cursorX,viewportY:o.current.cursorY,nextZoom:f},de))),N(),void J()}de.scrollX=de.scrollX-r/de.zoom.value,de.scrollY=de.scrollY-i/de.zoom.value,M({elements:G.getElementsIncludingDeleted(),isTransform:!0,appState:de,scale:window.devicePixelRatio,canvas:t.current,renderEngine:D,svg:n.current,renderConfig:{selectionColor:"#6965db",scrollX:de.scrollX,scrollY:de.scrollY,viewBackgroundColor:"#ffffff",zoom:de.zoom,accelerate:R.current}})},onPointerDown:function(e){if(!(H.pointers.size>1))if(k.type){var t=$(e),n=g({elementType:k.type,pointerDownState:t,appState:de});de.draggingElement=n,A(n),G.replaceAllElements([].concat((0,a.Z)(G.getElementsIncludingDeleted()),[de.draggingElement]));var o=K(t),r=V(t);window.addEventListener("pointermove",o),window.addEventListener("pointerup",r),t.eventListeners.onMove=o,t.eventListeners.onUp=r}else O(e)},onDoubleClick:function(e){k.type||r.current.startEditText(e)},onPointerCancel:q,onPointerMove:function(e){U(e,(function(){N(),J()}))},children:"\u9759\u6001canvas"}),(0,W.jsx)(le,{activeTool:k,onZoomChange:function(e){de.zoom.value!==e&&(Object.assign(de,(0,l.Z)({},(0,d.E)({viewportX:de.canvasWidth/2+de.offsetLeft,viewportY:de.canvasHeight/2+de.offsetTop,nextZoom:e},de))),N(),J())},appState:(0,l.Z)({},de),onActiveToolChange:function(e){E(e)}}),(0,W.jsx)(ue,{ref:r,staticCanvasRef:t})]}),(0,W.jsxs)("div",{children:[(0,W.jsx)("span",{ref:i,children:"FPS\uff1a--"}),(0,W.jsx)("span",{className:"total",id:"canvas-total"}),(0,W.jsxs)("span",{className:"render-engine",children:[(0,W.jsx)("input",{type:"checkbox",checked:"svg"===D,onChange:function(e){"canvas"===D&&(t.current.getContext("2d").clearRect(0,0,t.current.width,t.current.height),n.current.style.display="block",L("svg"),M({elements:G.getElementsIncludingDeleted(),appState:de,scale:window.devicePixelRatio,canvas:t.current,svg:n.current,renderEngine:"svg",renderConfig:{selectionColor:"#6965db",scrollX:de.scrollX,scrollY:de.scrollY,viewBackgroundColor:"#ffffff",zoom:de.zoom,accelerate:R.current}}))}}),"SVG\u6e32\u67d3\u5f15\u64ce",(0,W.jsx)("input",{type:"checkbox",checked:"canvas"===D,onChange:function(e){"svg"===D&&(n.current.style.display="none",L("canvas"),M({elements:G.getElementsIncludingDeleted(),appState:de,scale:window.devicePixelRatio,canvas:t.current,svg:n.current,renderEngine:"canvas",renderConfig:{selectionColor:"#6965db",scrollX:de.scrollX,scrollY:de.scrollY,viewBackgroundColor:"#ffffff",zoom:de.zoom,accelerate:R.current}}))}}),"Canvas\u6e32\u67d3\u5f15\u64ce"]})]}),(0,W.jsxs)("div",{className:"row",children:[(0,W.jsx)("input",{type:"number",value:j.count,onChange:function(e){return T((0,l.Z)((0,l.Z)({},j),{},{count:e.target.value}))}}),(0,W.jsxs)("select",{value:j.type,onChange:function(e){return T((0,l.Z)((0,l.Z)({},j),{},{type:e.target.value}))},children:[(0,W.jsx)("option",{value:"freedraw",children:"freedraw"}),(0,W.jsx)("option",{value:"rectangle",children:"rectangle"}),(0,W.jsx)("option",{value:"text",children:"text"})]}),(0,W.jsx)("button",{onClick:function(){var e=x(Number(j.count),j.type,de);G.replaceAllElements([].concat((0,a.Z)(G.getElementsIncludingDeleted()),(0,a.Z)(e))),M({elements:G.getElementsIncludingDeleted(),appState:de,scale:window.devicePixelRatio,canvas:t.current,svg:n.current,renderEngine:D,renderConfig:{selectionColor:"#6965db",scrollX:de.scrollX,scrollY:de.scrollY,viewBackgroundColor:"#ffffff",zoom:de.zoom,accelerate:R.current}})},children:"\u751f\u6210"}),(0,W.jsx)("button",{onClick:function(){if(Y(!X),B.current&&cancelAnimationFrame(B.current),!X){var e=Date.now();B.current=requestAnimationFrame((function o(){var r=Date.now();if(r-e>=100){e=r;var i=function(e,t){return e.forEach((function(e){var n=p(-t.scrollX,t.canvasWidth-t.scrollX),o=p(-t.scrollY,t.canvasHeight-t.scrollY);e.x=n,e.y=o})),e}(G.getElementsIncludingDeleted(),de);M({elements:i,appState:de,scale:window.devicePixelRatio,canvas:t.current,svg:n.current,renderEngine:D,renderConfig:{selectionColor:"#6965db",scrollX:de.scrollX,scrollY:de.scrollY,viewBackgroundColor:"#ffffff",zoom:de.zoom,accelerate:R.current}})}B.current=requestAnimationFrame(o)}))}},children:X?"\u505c\u6b62\u52a8\u753b":"\u52a8\u753b"})]}),(0,W.jsx)("div",{id:"placeholder"})]})})),ve=fe},2121:function(e,t,n){n.d(t,{Sp:function(){return a},aF:function(){return l}});var o=n(1413),r=n(9439),i=n(5204),a=function(e,t){var n=(0,i.KP)(e),o=(0,r.Z)(n,4),a=o[0],l=o[1],c=o[2],s=o[3];return[a,l,(0,i.TE)(a,c)+2*t,(0,i.TE)(l,s)+t+t]},l=function(e){var t=e.renderScene,n=e.isExport,i=void 0===n||n,l=e.notUseCache,c=function(e){var t=e.renderScene,n=e.isExport,i=e.notUseCache,l=e.elements,c=e.appState,s=a(l,10),u=(0,r.Z)(s,4),d=u[0],f=u[1],v=u[2],h=u[3],g=document.createElement("canvas");return g.width=v*window.devicePixelRatio,g.height=h*window.devicePixelRatio,t({elements:l,appState:(0,o.Z)((0,o.Z)({},c),{},{scrollX:10-d,scrollY:10-f}),scale:window.devicePixelRatio,canvas:g,renderConfig:{selectionColor:"#6965db",scrollX:10-d,scrollY:10-f,viewBackgroundColor:"#ffffff",zoom:{value:1},isExport:n,notUseCache:i}}),g.toDataURL()}({renderScene:t,isExport:i,notUseCache:void 0===l||l,elements:e.elements,appState:e.appState}),s=document.createElement("a");s.href=c,s.download="canvas.png",s.click()}},5909:function(e,t,n){n.d(t,{S:function(){return i},q:function(){return r}});var o=n(9439),r=function(e){var t=Array.from(e.values());return{x:a(t,(function(e){return e.x}))/t.length,y:a(t,(function(e){return e.y}))/t.length}},i=function(e){var t=(0,o.Z)(e,2),n=t[0],r=t[1];return Math.hypot(n.x-r.x,n.y-r.y)},a=function(e,t){return e.reduce((function(e,n){return e+t(n)}),0)}},5204:function(e,t,n){n.d(t,{$9:function(){return s},B8:function(){return c},KP:function(){return v},Pi:function(){return f},TE:function(){return g},dE:function(){return l},kb:function(){return p},mO:function(){return x},qf:function(){return h}});var o=n(9439),r=n(7762),i=n(3433),a=n(4453),l=function(e,t){var n=e.clientX,o=e.clientY,r=t.zoom,i=t.offsetLeft,a=t.offsetTop,l=t.scrollX,c=t.scrollY,s=r?r.value:1;return{x:(n-i)/s-l,y:(o-a)/s-c}},c=function(){var e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),n=Math.floor(256*Math.random());return"rgb(".concat(e,",").concat(t,",").concat(n,")")},s=function(e){return function(e,t){var n=null,o=null,r=null,a=function t(a){n=window.requestAnimationFrame((function(){n=null,e.apply(void 0,(0,i.Z)(a)),o=null,r&&(o=r,r=null,t(o))}))},l=function(){for(var e=arguments.length,i=new Array(e),l=0;l<e;l++)i[l]=arguments[l];o=i,null===n?a(o):null!==t&&void 0!==t&&t.trailing&&(r=i)};return l.flush=function(){null!==n&&(cancelAnimationFrame(n),n=null),o&&(e.apply(void 0,(0,i.Z)(r||o)),o=r=null)},l.cancel=function(){o=r=null,null!==n&&(cancelAnimationFrame(n),n=null)},l}((function(t){(0,a.unstable_batchedUpdates)(e,t)}))},u=function(e){var t=1/0,n=1/0,i=-1/0,a=-1/0,l=e.points;"freedraw"===e.type&&(l=e.points.map((function(t){return[t[0]-e.x,t[1]-e.y]})));var c,s=(0,r.Z)(l);try{for(s.s();!(c=s.n()).done;){var u=(0,o.Z)(c.value,2),d=u[0],f=u[1];t=Math.min(t,d),n=Math.min(n,f),i=Math.max(i,d),a=Math.max(a,f)}}catch(v){s.e(v)}finally{s.f()}return[t,n,i,a]},d=function(e,t,n,o,r){return[(e-n)*Math.cos(r)-(t-o)*Math.sin(r)+n,(e-n)*Math.sin(r)+(t-o)*Math.cos(r)+o]},f=function(e){var t=h(e),n=(0,o.Z)(t,6),r=n[0],i=n[1],a=n[2],l=n[3],c=n[4],s=n[5];if("freedraw"===e.type){var f=u(e),v=(0,o.Z)(f,4),g=v[0],m=v[1],p=v[2],x=v[3];return[g+e.x,m+e.y,p+e.x,x+e.y]}var w=d(r,i,c,s,e.angle),y=(0,o.Z)(w,2),C=y[0],k=y[1],E=d(r,l,c,s,e.angle),S=(0,o.Z)(E,2),b=S[0],j=S[1],T=d(a,l,c,s,e.angle),z=(0,o.Z)(T,2),Z=z[0],X=z[1],Y=d(a,i,c,s,e.angle),M=(0,o.Z)(Y,2),A=M[0],R=M[1];return[Math.min(C,b,Z,A),Math.min(k,j,X,R),Math.max(C,b,Z,A),Math.max(k,j,X,R)]},v=function(e){if(!e.length)return[0,0,0,0];var t=1/0,n=-1/0,r=1/0,i=-1/0;return e.forEach((function(e){var a=f(e),l=(0,o.Z)(a,4),c=l[0],s=l[1],u=l[2],d=l[3];t=Math.min(t,c),r=Math.min(r,s),n=Math.max(n,u),i=Math.max(i,d)})),[t,r,n,i]},h=function(e){if("freedraw"===e.type){var t=u(e),n=(0,o.Z)(t,4),r=n[0],i=n[1],a=n[2],l=n[3],c=r+e.x,s=i+e.y,d=a+e.x,f=l+e.y;return[c,s,d,f,(c+d)/2,(s+f)/2]}return[e.x,e.y,e.x+e.width,e.y+e.height,e.x+e.width/2,e.y+e.height/2]},g=function(e,t){return Math.abs(e-t)},m=0,p=function(){return"id".concat(m++)},x=function(e){var t=e.fontSize,n=e.fontFamily;return"".concat(t,"px ").concat(n,", Segoe UI Emoji")}},4975:function(e,t,n){n.d(t,{E:function(){return r},j:function(){return o}});var o=function(e){return Math.max(.1,Math.min(e,30))},r=function(e,t){var n=e.viewportX,o=e.viewportY,r=e.nextZoom,i=n-t.offsetLeft,a=o-t.offsetTop,l=t.zoom.value;return{scrollX:t.scrollX+i/r-i/l,scrollY:t.scrollY+a/r-a/l,zoom:{value:r}}}}}]);
//# sourceMappingURL=SwitchRender.f62413cf.chunk.js.map